    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard - Vietnam Travel</title>
        <script src="https://lib.youware.com/youware-lib-editor.1756814202.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1756814202.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1756814202.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1756814202.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1756814202.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1756814202.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1754557047.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1754557047.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1754557047.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1754557047.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1754557047.js" id="yourware-lib"></script><script src="https://lib.youware.com/youware-lib-editor.1754557047.js" id="yourware-lib"></script>
        <script src="https://cdn.tailwindcss.com/3.4.16"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <link rel="stylesheet" href="https://public.youware.com/users-website-assets/prod/0aebb26b-6df2-4a65-b76c-5567b44e6aa6/e06f1a84e783465fb2c3cbe5c8a497d9.css">
        <link rel="stylesheet" href="assets/css/style.css">
        <link rel="stylesheet" href="assets/css/tour-history.css">
        <!-- Performance Optimizer -->
        <script src="assets/js/performance-optimizer.js" defer></script>
        
        <!-- Core Libraries - Lazy Loaded -->
        <script src="assets/js/libs/youware-lib.js" defer></script>
        <script src="assets/js/libs/script-local.js" defer></script>
        <script src="assets/js/libs/user_interface_config.js" defer></script>
        <script src="https://public.youware.com/users-website-assets/prod/0aebb26b-6df2-4a65-b76c-5567b44e6aa6/6cea07a83bb94affa00dceba42423cad.js" defer></script>
    </head>

    <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
        <!-- Enhanced Header -->
        <header class="glass-card border-b backdrop-blur-lg sticky top-0 z-40">
            <div class="container mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <div
                            class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-plane text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent"
                                data-en="Vietnam Travel Dashboard" data-vi="Bảng Điều Khiển Du Lịch Việt Nam">Vietnam Travel
                                Dashboard</h1>
                            <p class="text-xs text-gray-500" data-en="Your personalized travel companion"
                                data-vi="Người bạn đồng hành du lịch cá nhân">Your personalized travel companion</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4">
                        <!-- Website Setup Toggle -->
                        <div class="relative">
                            <button id="websiteSetupBtn"
                                class="bg-white/80 backdrop-blur-sm text-blue-600 px-4 py-2 rounded-xl hover:bg-white/90 transition duration-300 flex items-center shadow-sm">
                                <i class="fas fa-cog mr-2"></i>
                                <span data-en="Setup" data-vi="Cài đặt">Setup</span>
                                <i class="fas fa-chevron-down text-xs ml-2"></i>
                            </button>

                            <!-- Website Setup Dropdown -->
                            <div id="websiteSetupDropdown"
                                class="absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-xl border border-white/20 hidden z-50 backdrop-blur-lg">
                                <div class="p-4">
                                    <!-- Header -->
                                    <div class="border-b border-gray-100 pb-3 mb-4">
                                        <h3 class="font-bold text-gray-800 text-lg mb-1" data-en="Website Settings"
                                            data-vi="Cài đặt Trang web">Website Settings</h3>
                                        <p class="text-xs text-gray-500" data-en="Customize your experience"
                                            data-vi="Tùy chỉnh trải nghiệm của bạn">Customize your experience</p>
                                    </div>
                                    
                                    <!-- Language Section -->
                                    <div class="border-b border-gray-100 pb-4 mb-4">
                                        <h4 class="font-semibold text-gray-700 text-sm mb-3 flex items-center">
                                            <i class="fas fa-language mr-2 text-blue-500"></i>
                                            <span data-en="Language" data-vi="Ngôn ngữ">Language</span>
                                        </h4>
                                        <div class="space-y-2">
                                            <button
                                                class="language-option w-full text-left px-3 py-2 hover:bg-blue-50 rounded-lg text-sm transition duration-200 flex items-center justify-between group"
                                                data-lang="en">
                                                <span>English</span>
                                                <span id="currentLanguageIndicator" class="text-blue-600 font-medium hidden">✓</span>
                                            </button>
                                            <button
                                                class="language-option w-full text-left px-3 py-2 hover:bg-blue-50 rounded-lg text-sm transition duration-200 flex items-center justify-between group"
                                                data-lang="vi">
                                                <span>Tiếng Việt</span>
                                                <span class="text-blue-600 font-medium hidden">✓</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Currency Section -->
                                    <div class="border-b border-gray-100 pb-4 mb-4">
                                        <h4 class="font-semibold text-gray-700 text-sm mb-3 flex items-center">
                                            <i class="fas fa-dollar-sign mr-2 text-green-500"></i>
                                            <span data-en="Currency" data-vi="Tiền tệ">Currency</span>
                                        </h4>
                                        <div class="space-y-2">
                                            <button
                                                class="currency-option w-full text-left px-3 py-2 hover:bg-blue-50 rounded-lg text-sm transition duration-200 flex items-center justify-between group"
                                                data-currency="USD">
                                                <span>USD ($)</span>
                                                <span id="currentCurrencyIndicator" class="text-green-600 font-medium hidden">✓</span>
                                            </button>
                                            <button
                                                class="currency-option w-full text-left px-3 py-2 hover:bg-blue-50 rounded-lg text-sm transition duration-200 flex items-center justify-between group"
                                                data-currency="VND">
                                                <span>VND (₫)</span>
                                                <span class="text-green-600 font-medium hidden">✓</span>
                                            </button>
                                            <button
                                                class="currency-option w-full text-left px-3 py-2 hover:bg-blue-50 rounded-lg text-sm transition duration-200 flex items-center justify-between group"
                                                data-currency="EUR">
                                                <span>EUR (€)</span>
                                                <span class="text-green-600 font-medium hidden">✓</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Theme Section -->
                                    <div class="mb-4">
                                        <h4 class="font-semibold text-gray-700 text-sm mb-3 flex items-center">
                                            <i class="fas fa-palette mr-2 text-purple-500"></i>
                                            <span data-en="Theme" data-vi="Giao diện">Theme</span>
                                            <span class="text-xs text-orange-500 ml-2" data-en="(requires refresh)" 
                                                data-vi="(cần tải lại)">(requires refresh)</span>
                                        </h4>
                                        <div class="space-y-2">
                                            <button id="themeDefault"
                                                class="theme-option w-full text-left px-3 py-2 hover:bg-blue-50 rounded-lg text-sm transition duration-200 flex items-center justify-between group"
                                                data-theme="sunset">
                                                <div class="flex items-center">
                                                    <i class="fas fa-sun mr-2 text-amber-500"></i>
                                                    <span data-en="Default" data-vi="Mặc định">Default</span>
                                                </div>
                                                <span id="currentThemeDefault" class="text-purple-600 font-medium hidden">✓</span>
                                            </button>
                                            <button id="themeArctic"
                                                class="theme-option w-full text-left px-3 py-2 hover:bg-blue-50 rounded-lg text-sm transition duration-200 flex items-center justify-between group"
                                                data-theme="arctic">
                                                <div class="flex items-center">
                                                    <i class="fas fa-snowflake mr-2 text-blue-500"></i>
                                                    <span data-en="Arctic Snow" data-vi="Tuyết Bắc Cực">Arctic Snow</span>
                                                </div>
                                                <span id="currentThemeArctic" class="text-purple-600 font-medium hidden">✓</span>
                                            </button>
                                            <button id="themeCosmic"
                                                class="theme-option w-full text-left px-3 py-2 hover:bg-blue-50 rounded-lg text-sm transition duration-200 flex items-center justify-between group"
                                                data-theme="cosmic">
                                                <div class="flex items-center">
                                                    <i class="fas fa-moon mr-2 text-purple-500"></i>
                                                    <span data-en="Cosmic" data-vi="Vũ trụ">Cosmic</span>
                                                </div>
                                                <span id="currentThemeCosmic" class="text-purple-600 font-medium hidden">✓</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="flex space-x-2 pt-3 border-t border-gray-100">
                                        <button id="applyChangesBtn"
                                            class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition duration-200">
                                            <i class="fas fa-check mr-1"></i>
                                            <span data-en="Apply Changes" data-vi="Áp dụng">Apply Changes</span>
                                        </button>
                                        <button id="cancelChangesBtn"
                                            class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg text-sm font-medium hover:bg-gray-200 transition duration-200">
                                            <i class="fas fa-times mr-1"></i>
                                            <span data-en="Cancel" data-vi="Hủy">Cancel</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Admin Panel Button (Only visible for admins) -->
                        <button id="adminPanelBtn"
                            class="admin-only bg-purple-500 text-white px-4 py-2 rounded-xl hover:bg-purple-600 transition duration-300 flex items-center shadow-sm hidden"
                            style="display: none;">
                            <i class="fas fa-cogs mr-2"></i>
                            <span data-en="Admin Panel" data-vi="Bảng Điều Khiển Admin">Admin Panel</span>
                        </button>

                        <!-- User Profile -->
                        <div
                            class="flex items-center space-x-3 bg-white/80 backdrop-blur-sm rounded-xl px-4 py-2 shadow-sm">
                            <div
                                class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                                T
                            </div>
                            <div>
                                <p id="currentUserName" class="text-sm font-medium text-gray-700" data-en="Loading..." 
                                    data-vi="Đang tải...">Loading...</p>
                                <p id="currentUserEmail" class="text-xs text-gray-500">Loading...</p>
                            </div>
                        </div>

                        <!-- Logout Button -->
                        <button id="logoutBtn"
                            class="bg-red-500 text-white px-4 py-2 rounded-xl hover:bg-red-600 transition duration-300 flex items-center shadow-sm">
                            <i class="fas fa-sign-out-alt mr-2"></i>
                            <span data-en="Logout" data-vi="Đăng Xuất">Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-6 py-8">
            <!-- Welcome Section with Stats -->
            <div class="mb-8">
                <div class="glass-card rounded-2xl p-8 mb-6">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                        <div>
                            <h2 id="welcomeMessage" class="text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent mb-2"
                                data-en="Welcome back!" data-vi="Chào mừng trở lại!">Welcome back!</h2>
                            <p class="text-gray-600" data-en="Ready to plan your next amazing adventure in Vietnam?"
                                data-vi="Sẵn sàng lên kế hoạch cho cuộc phiêu lưu tuyệt vời tiếp theo tại Việt Nam?">Ready
                                to plan your next amazing adventure in Vietnam?</p>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Travel Planning Section -->
            <div class="mb-8">
                <!-- Enhanced Search Form Card -->
                <div class="glass-card rounded-2xl p-8 search-form-card">
                    <!-- Tab Navigation -->
                    <div class="flex flex-wrap justify-between border-b border-gray-200 mb-8">
                        <button class="tab-button tab-inactive flex items-center font-medium" data-tab="travel">
                            <i class="fas fa-car mr-2"></i>
                            <span data-en="Personalized Travel tour" data-vi="Tour du lịch cá nhân">Personalized Travel
                                tour</span>
                        </button>
                        <button class="tab-button tab-active flex items-center font-medium" data-tab="hotel">
                            <i class="fas fa-building mr-2"></i>
                            <span data-en="Hotel" data-vi="Khách sạn">Hotel</span>
                        </button>
                        <button class="tab-button tab-inactive flex items-center font-medium" data-tab="airline">
                            <i class="fas fa-plane mr-2 text-orange-500"></i>
                            <span data-en="Airlines tickets" data-vi="Vé máy bay">Airlines tickets</span>
                        </button>
                        <button class="tab-button tab-inactive flex items-center font-medium" data-tab="package">
                            <i class="fas fa-magic mr-2"></i>
                            <span data-en="Personalized Tour V2" data-vi="Tour Cá Nhân V2">Personalized Tour V2</span>
                        </button>
                        <button class="tab-button tab-inactive flex items-center font-medium" data-tab="restaurant">
                            <i class="fas fa-utensils mr-2"></i>
                            <span data-en="Restaurants" data-vi="Nhà hàng">Restaurants</span>
                        </button>
                    </div>

                    <!-- Travel Tour Tab -->
                    <div id="travel-tab" class="tab-content hidden">
                        <div class="travel-form-container">
                            <!-- Step 1: Basic Travel Information -->
                            <div id="travel-step-1" class="travel-step">
                                <div class="space-y-6">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2" data-en="Departure"
                                                data-vi="Điểm khởi hành">Departure</label>
                                            <div class="relative">
                                                <input type="text" class="form-control w-full p-3 bg-white" id="departure"
                                                    name="departure" autocomplete="off" placeholder="Enter departure city">
                                                <div id="departureAutocomplete" class="absolute z-10 bg-white shadow-lg rounded-lg border border-gray-200 w-full mt-1 max-h-60 overflow-y-auto hidden"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2" data-en="Destination"
                                                data-vi="Điểm đến">Destination</label>
                                            <div class="relative">
                                                <input type="text" class="form-control w-full p-3 bg-white" id="destination"
                                                    name="destination" autocomplete="off" placeholder="Enter destination city">
                                                <div id="destinationAutocomplete" class="absolute z-10 bg-white shadow-lg rounded-lg border border-gray-200 w-full mt-1 max-h-60 overflow-y-auto hidden"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">
                                                <span data-en="Departure time" data-vi="Giờ khởi hành">Departure time</span>
                                                <span class="text-red-500">*</span>
                                            </label>
                                            <div class="relative">
                                                <input type="time" class="form-control w-full p-3 bg-white" name="departureTime" id="departureTime"
                                                    required style="color-scheme: light;">
                                                <i class="fas fa-clock absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none" data-original-color="rgb(156, 163, 175)" style="color: rgb(14, 165, 233);"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">
                                                <span data-en="Departure date" data-vi="Ngày khởi hành">Departure date</span>
                                                <span class="text-red-500">*</span>
                                            </label>
                                            <div class="relative">
                                                <input type="date" class="form-control w-full p-3 bg-white" name="departureDate" id="departureDate"
                                                    required min="2025-07-01" style="color-scheme: light;">
                                                <i class="fas fa-calendar absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none" data-original-color="rgb(156, 163, 175)" style="color: rgb(14, 165, 233);"></i>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2">
                                            <span data-en="Means Of Transport" data-vi="Phương tiện di chuyển">Means Of
                                                Transport</span>
                                            <span class="text-red-500">*</span>
                                        </label>
                                        <div class="relative">
                                            <select class="form-control w-full p-3 bg-white appearance-none" id="transport"
                                                name="transport" required>
                                                <option data-en="Select Means Of Transport" data-vi="Chọn phương tiện">Select
                                                    Means Of Transport</option>
                                                <option data-en="Plane" data-vi="Máy bay">Plane</option>
                                                <option data-en="Tourist Bus" data-vi="Xe du lịch">Tourist Bus</option>
                                                <option data-en="Car" data-vi="Ô tô">Car</option>
                                            </select>
                                            <i class="fas fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400" data-original-color="rgb(156, 163, 175)" style="color: rgb(14, 165, 233);"></i>
                                        </div>
                                    </div>

                                    <!-- Continue Button for Step 1 -->
                                    <div class="flex justify-end mt-6">
                                        <button id="continue-to-step-2" class="btn-search px-8 py-3 text-white font-medium rounded-lg" disabled>
                                            <span data-en="Continue" data-vi="Tiếp tục">Continue</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2: Trip Information at Destination -->
                            <div id="travel-step-2" class="travel-step hidden">
                                <form id="travelTourSearchForm">
                                    <div class="trip-info-section p-6">
                                        <h3 class="text-xl font-bold text-gray-800 mb-6" data-en="Trip Information at Destination"
                                            data-vi="Thông tin chuyến đi tại điểm đến">Trip Information at Destination</h3>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                            <div>
                                                <label class="block text-gray-700 font-medium mb-2" data-en="Hotels"
                                                    data-vi="Khách sạn">Hotels</label>
                                                <div class="relative">
                                                    <input type="text" class="form-control w-full p-3 bg-white" id="hotels"
                                                        name="hotels" autocomplete="off" placeholder="Search hotels">
                                                    <div id="hotelsAutocomplete" class="absolute z-10 bg-white shadow-lg rounded-lg border border-gray-200 w-full mt-1 max-h-60 overflow-y-auto hidden"></div>
                                                </div>
                                                <div id="selectedHotels" class="mt-2 flex flex-wrap gap-2"></div>
                                                <input type="hidden" id="hotelIds" name="hotelIds">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 font-medium mb-2" data-en="Restaurants"
                                                    data-vi="Nhà hàng">Restaurants</label>
                                                <div class="relative">
                                                    <input type="text" class="form-control w-full p-3 bg-white" id="restaurants"
                                                        name="restaurants" autocomplete="off" placeholder="Search restaurants">
                                                    <div id="restaurantsAutocomplete" class="absolute z-10 bg-white shadow-lg rounded-lg border border-gray-200 w-full mt-1 max-h-60 overflow-y-auto hidden"></div>
                                                </div>
                                                <div id="selectedRestaurants" class="mt-2 flex flex-wrap gap-2"></div>
                                                <input type="hidden" id="restaurantIds" name="restaurantIds">
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                            <div>
                                                <label class="block text-gray-700 font-medium mb-2" data-en="Recreation Places"
                                                    data-vi="Địa điểm giải trí">Recreation Places</label>
                                                <div id="activitiesList" class="border border-gray-200 rounded-lg p-4 max-h-48 overflow-y-auto">
                                                    <div class="text-gray-500 text-sm text-center" id="activitiesLoading">
                                                        <i class="fas fa-spinner fa-spin mr-2"></i> Loading activities...
                                                    </div>
                                                    <div id="activitiesContent" class="space-y-2"></div>
                                                </div>
                                                <input type="hidden" id="activityIds" name="activityIds">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 font-medium mb-2">
                                                    <span data-en="Number of Guests" data-vi="Số khách">Number of Guests</span>
                                                    <span class="text-red-500">*</span>
                                                </label>
                                                <input type="number" class="form-control w-full p-3 bg-white" placeholder="2"
                                                    min="1" id="guestCount" name="guestCount" required>
                                                    
                                                <label class="block text-gray-700 font-medium mb-2 mt-4">
                                                    <span data-en="Number of Days" data-vi="Số ngày">Number of Days</span>
                                                    <span class="text-red-500">*</span>
                                                </label>
                                                <input type="number" class="form-control w-full p-3 bg-white" placeholder="3"
                                                    min="1" id="durationDays" name="durationDays" required>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                            <div>
                                                <label class="block text-gray-700 font-medium mb-2">
                                                    <span data-en="Budget (USD)" data-vi="Ngân sách (USD)">Budget (USD)</span>
                                                    <span class="text-red-500">*</span>
                                                </label>
                                                <input type="number" class="form-control w-full p-3 bg-white" placeholder="500"
                                                    min="0" id="targetBudget" name="targetBudget" required>
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 font-medium mb-2"
                                                    data-en="Local Means Of Transportation"
                                                    data-vi="Phương tiện giao thông địa phương">Local Means Of Transportation</label>
                                                <div id="transportsList" class="border border-gray-200 rounded-lg p-4 max-h-48 overflow-y-auto">
                                                    <div class="text-gray-500 text-sm text-center" id="transportsLoading">
                                                        <i class="fas fa-spinner fa-spin mr-2"></i> Loading transports...
                                                    </div>
                                                    <div id="transportsContent" class="space-y-2"></div>
                                                </div>
                                                <input type="hidden" id="transportIds" name="transportIds">
                                            </div>
                                        </div>

                                        <!-- Navigation Buttons for Step 2 -->
                                        <div class="flex justify-between">
                                            <button type="button" id="back-to-step-1" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                                                <span data-en="Previous" data-vi="Quay lại">Previous</span>
                                            </button>
                                            <button type="button" id="generate-tour-btn" class="btn-search w-auto px-8 py-3 text-white font-medium rounded-lg">
                                                <span data-en="Generate Tour" data-vi="Tạo tour">Generate Tour</span>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Tour Search Results Section -->
                        <div id="tourResults" class="tour-results-container hidden mt-8">
                            <div class="flex h-screen">
                                <!-- 30% Left: Flight Section -->
                                <div class="w-1/3 pr-4">
                                    <div class="bg-white rounded-xl shadow-lg h-full">
                                        <div class="p-6 border-b">
                                            <h3 class="text-xl font-bold text-gray-800" data-en="Flight Options" data-vi="Lựa chọn chuyến bay">Flight Options</h3>
                                            <p class="text-sm text-gray-600 mt-2" data-en="Suitable flights for your tour" data-vi="Các chuyến bay phù hợp cho tour của bạn">Suitable flights for your tour</p>
                                        </div>
                                        <div class="p-6">
                                            <div class="text-center py-12">
                                                <i class="fas fa-plane-departure text-4xl text-gray-400 mb-4"></i>
                                                <h4 class="text-lg font-semibold text-gray-600 mb-2" data-en="No Suitable Flights Found" data-vi="Không tìm thấy chuyến bay phù hợp">No Suitable Flights Found</h4>
                                                <p class="text-gray-500 text-sm" data-en="Flight search feature is coming soon" data-vi="Tính năng tìm kiếm chuyến bay sắp ra mắt">Flight search feature is coming soon</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 70% Right: Tour Results -->
                                <div class="w-2/3 pl-4">
                                    <div class="bg-white rounded-xl shadow-lg h-full flex flex-col">
                                        <div class="p-6 border-b">
                                            <h3 class="text-2xl font-bold text-gray-800" data-en="Generated Tours" data-vi="Các tour đã tạo">Generated Tours</h3>
                                            <p class="text-sm text-gray-600 mt-2" data-en="Your personalized tour recommendations" data-vi="Các gợi ý tour cá nhân của bạn">Your personalized tour recommendations</p>
                                        </div>
                                        <div class="flex-1 overflow-y-auto p-6">
                                            <div id="tourResultsGrid" class="grid grid-cols-1 gap-6">
                                                <!-- Tour cards will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Loading State for Tour Search -->
                        <div id="tourLoading" class="hidden text-center py-12">
                            <div class="loading-spinner mx-auto mb-4"></div>
                            <p class="text-gray-600" data-en="Generating your personalized tour..." data-vi="Đang tạo tour cá nhân của bạn...">Generating your personalized tour...</p>
                        </div>
                    </div>

                    <!-- Hotel Tab -->
                    <div id="hotel-tab" class="tab-content">
                        <!-- AJAX Search Field với Autocomplete -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Search Hotels" data-vi="Tìm Khách Sạn">Search Hotels</span>
                                <span class="text-sm text-gray-500 ml-2" data-en="(Type hotel name, city or country)" data-vi="(Gõ tên khách sạn, thành phố hoặc quốc gia)"></span>
                            </label>
                            <div class="relative">
                                <input 
                                    type="text" 
                                    id="hotelSearchInput" 
                                    class="form-control w-full p-3 bg-white pr-10" 
                                    placeholder="Nhập tên khách sạn, thành phố..."
                                    data-en-placeholder="Type hotel name, city or country..."
                                    data-vi-placeholder="Nhập tên khách sạn, thành phố..."
                                    autocomplete="off"
                                >
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                    <i class="fas fa-search text-gray-400"></i>
                                    <div id="searchSpinner" class="hidden ml-2">
                                        <i class="fas fa-spinner fa-spin text-blue-500"></i>
                                    </div>
                                </div>
                                
                                <!-- Autocomplete Dropdown -->
                                <div id="autocompleteDropdown" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-80 overflow-y-auto hidden">
                                    <div id="autocompleteResults" class="py-2">
                                        <!-- Suggestions will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <form id="hotelSearchForm">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">
                                        <span data-en="Country" data-vi="Quốc gia">Country</span>
                                        <span class="text-gray-500 text-sm" data-en="(Optional)" data-vi="(Tùy chọn)">(Optional)</span>
                                    </label>
                                    <div class="relative">
                                        <input 
                                            type="text" 
                                            id="hotelCountryInput" 
                                            class="form-control w-full p-3 bg-white" 
                                            placeholder="Type country name..."
                                            data-en-placeholder="Type country name..."
                                            data-vi-placeholder="Gõ tên quốc gia..."
                                            name="country"
                                            autocomplete="off"
                                        >
                                        <i class="fas fa-globe absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                        
                                        <!-- Country Autocomplete Dropdown -->
                                        <div id="hotelCountryAutocomplete" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto hidden">
                                            <div id="hotelCountryResults" class="py-2">
                                                <!-- Country suggestions will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">
                                        <span data-en="City/Province" data-vi="Thành phố/Tỉnh">City/Province</span>
                                        <span class="text-gray-500 text-sm" data-en="(Optional)" data-vi="(Tùy chọn)">(Optional)</span>
                                    </label>
                                    <div class="relative">
                                        <input 
                                            type="text" 
                                            id="hotelCityInput" 
                                            class="form-control w-full p-3 bg-white" 
                                            placeholder="Type city name..."
                                            data-en-placeholder="Type city name..."
                                            data-vi-placeholder="Gõ tên thành phố..."
                                            name="city"
                                            autocomplete="off"
                                        >
                                        <i class="fas fa-map-marker-alt absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                        
                                        <!-- City Autocomplete Dropdown -->
                                        <div id="hotelCityAutocomplete" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto hidden">
                                            <div id="hotelCityResults" class="py-2">
                                                <!-- City suggestions will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2" data-en="Check In" data-vi="Ngày nhận phòng">Check In</label>
                                    <div class="relative">
                                        <input type="date" class="form-control w-full p-3 bg-white" name="checkin" required min="2025-06-01" style="color-scheme: light;">
                                        <i class="fas fa-calendar absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2" data-en="Check out" data-vi="Ngày trả phòng">Check out</label>
                                    <div class="relative">
                                        <input type="date" class="form-control w-full p-3 bg-white" name="checkout" required min="2025-06-01" style="color-scheme: light;">
                                        <i class="fas fa-calendar absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="flex justify-between">
                                <div class="flex-1 text-right">
                                    <button type="submit" class="btn-search px-8 py-3 text-white font-medium rounded-lg">
                                        <span data-en="Search Hotels" data-vi="Tìm Khách Sạn">Search Hotels</span>
                                    </button>
                                </div>
                                <!-- Admin Only Add Hotel Button -->
                                <div>
                                    <button type="button" id="addHotelBtn" class="admin-only bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition duration-300 flex items-center font-medium hidden" style="display: none;">
                                        <i class="fas fa-plus mr-2"></i>
                                        <span data-en="Add Hotel" data-vi="Thêm Khách Sạn">Add Hotel</span>
                                    </button>
                                </div>
                            </div>
                        </form>

                        <!-- Hotels Results Section -->
                        <div id="hotelResults" class="hotel-list-container hidden mt-8">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-800" data-en="Search Results" data-vi="Kết Quả Tìm Kiếm">Search Results</h3>
                                <div class="flex items-center space-x-4">
                                    <span id="hotelCount" class="text-gray-600"></span>
                                    <!-- Pagination Controls -->
                                    <div id="hotelPagination" class="pagination-controls hidden">
                                        <button id="prevHotelPage" class="pagination-btn" disabled>
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <span id="hotelPageInfo" class="pagination-info">1 / 1</span>
                                        <button id="nextHotelPage" class="pagination-btn" disabled>
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                    <button id="minimizeHotelResults" class="minimize-btn bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition-colors duration-200">
                                        <i class="fas fa-minus text-gray-600"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="hotelList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Hotel items will be populated here -->
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div id="hotelLoading" class="hidden text-center py-12">
                            <div class="loading-spinner mx-auto mb-4"></div>
                            <p class="text-gray-600" data-en="Searching for hotels..." data-vi="Đang tìm kiếm khách sạn...">Searching for hotels...</p>
                        </div>

                        <!-- No Results State -->
                        <div id="hotelNoResults" class="hidden text-center py-12">
                            <i class="fas fa-hotel text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2" data-en="No Hotels Found" data-vi="Không Tìm Thấy Khách Sạn">No Hotels Found</h3>
                            <p class="text-gray-500" data-en="Try adjusting your search criteria" data-vi="Thử điều chỉnh tiêu chí tìm kiếm">Try adjusting your search criteria</p>
                        </div>
                    </div>

                    <!-- Airlines Tab -->
                    <div id="airline-tab" class="tab-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2" data-en="Departure"
                                    data-vi="Điểm khởi hành">Departure</label>
                                <div class="relative">
                                    <select class="form-control w-full p-3 bg-white appearance-none"
                                        name="airlineDeparture">
                                        <option data-en="Select Province" data-vi="Chọn tỉnh thành">Select Province</option>
                                        <option data-en="Other province" data-vi="Tỉnh thành khác">Other province</option>
                                        <option data-en="Ha Noi" data-vi="Hà Nội">Ha Noi</option>
                                        <option data-en="Ho Chi Minh" data-vi="Hồ Chí Minh">Ho Chi Minh</option>
                                        <option data-en="Da Nang" data-vi="Đà Nẵng">Da Nang</option>
                                        <option data-en="Phu Quoc" data-vi="Phú Quốc">Phu Quoc</option>
                                        <option data-en="Nha Trang" data-vi="Nha Trang">Nha Trang</option>
                                    </select>
                                    <i
                                        class="fas fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2" data-en="Destination"
                                    data-vi="Điểm đến">Destination</label>
                                <div class="relative">
                                    <select class="form-control w-full p-3 bg-white appearance-none"
                                        name="airlineDestination">
                                        <option data-en="Select Province" data-vi="Chọn tỉnh thành">Select Province</option>
                                        <option data-en="Other province" data-vi="Tỉnh thành khác">Other province</option>
                                        <option data-en="Ha Noi" data-vi="Hà Nội">Ha Noi</option>
                                        <option data-en="Ho Chi Minh" data-vi="Hồ Chí Minh">Ho Chi Minh</option>
                                        <option data-en="Da Nang" data-vi="Đà Nẵng">Da Nang</option>
                                        <option data-en="Phu Quoc" data-vi="Phú Quốc">Phu Quoc</option>
                                        <option data-en="Nha Trang" data-vi="Nha Trang">Nha Trang</option>
                                    </select>
                                    <i
                                        class="fas fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2" data-en="Departure Time"
                                    data-vi="Giờ khởi hành">Departure Time</label>
                                <div class="relative">
                                    <input type="time" class="form-control w-full p-3 bg-white" name="airlineTime"
                                        style="color-scheme: light;">
                                    <i
                                        class="fas fa-clock absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                </div>
                            </div>
                            <div class="flex flex-col">
                                <label class="block text-gray-700 font-medium mb-2" data-en="Departure Day"
                                    data-vi="Ngày khởi hành">Departure Day</label>
                                <div class="relative mb-auto">
                                    <input type="date" class="form-control w-full p-3 bg-white" name="airlineDate"
                                        min="2025-07-01" style="color-scheme: light;">
                                    <i
                                        class="fas fa-calendar absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                </div>
                                <button class="btn-search px-8 py-3 text-white font-medium rounded-lg mt-4">
                                    <span data-en="Search" data-vi="Tìm kiếm">Search</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Personalized Tour V2 Tab -->
                    <div id="package-tab" class="tab-content hidden">
                        <div class="personalized-tour-v2-container">
                            <!-- Enhanced Form Header with Gradient Background -->
                            <div class="mb-8 p-6 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-2xl border border-blue-100 shadow-sm">
                                <div class="flex items-center mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg mr-4">
                                        <i class="fas fa-magic text-white text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-1" 
                                            data-en="Advanced Personalized Tour Planning" 
                                            data-vi="Lập Kế Hoạch Tour Cá Nhân Nâng Cao">Advanced Personalized Tour Planning</h3>
                                        <p class="text-gray-600 text-lg" data-en="Tell us your preferences and we'll create the perfect itinerary for you"
                                            data-vi="Cho chúng tôi biết sở thích của bạn và chúng tôi sẽ tạo lịch trình hoàn hảo">Tell us your preferences and we'll create the perfect itinerary for you</p>
                                    </div>
                                </div>
                                
                                <!-- Progress Steps -->
                                <div class="flex items-center justify-between bg-white rounded-xl p-4 shadow-sm">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">1</div>
                                        <span class="text-blue-600 font-medium" data-en="Basic Information" data-vi="Thông Tin Cơ Bản">Basic Information</span>
                                    </div>
                                    <div class="flex-1 h-0.5 bg-gray-200 mx-4"></div>
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm font-bold mr-3">2</div>
                                        <span class="text-gray-500 font-medium" data-en="Flight Booking" data-vi="Đặt Vé Máy Bay">Flight Booking</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Form Container -->
                            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8">
                                <div class="space-y-8">
                                <!-- Enhanced Departure and Destination Section -->
                                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100">
                                    <div class="flex items-center mb-4">
                                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3">
                                            <i class="fas fa-route text-white"></i>
                                        </div>
                                        <h4 class="text-xl font-bold text-gray-800" data-en="Travel Route" data-vi="Tuyến Đường Du Lịch">Travel Route</h4>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <!-- Departure City Dropdown -->
                                        <div>
                                            <label class="block text-gray-700 font-semibold mb-3 flex items-center">
                                                <i class="fas fa-plane-departure text-blue-500 mr-2"></i>
                                                <span data-en="Departure City" data-vi="Thành Phố Khởi Hành">Departure City</span>
                                                <span class="text-red-500 ml-1">*</span>
                                            </label>
                                            <div class="relative">
                                                <button type="button" id="departureDropdownBtn" 
                                                    class="w-full p-4 bg-white border-2 border-blue-200 rounded-xl text-left flex items-center justify-between hover:border-blue-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 transition duration-300 shadow-sm hover:shadow-md">
                                                    <div class="flex items-center">
                                                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                                            <i class="fas fa-map-marker-alt text-blue-600 text-sm"></i>
                                                        </div>
                                                        <span id="departureSelected" class="text-gray-500 font-medium" data-en="Select Departure City" data-vi="Chọn Thành Phố Khởi Hành">Select Departure City</span>
                                                    </div>
                                                    <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                                                </button>
                                            
                                                <!-- Enhanced Departure Dropdown Menu -->
                                                <div id="departureDropdownMenu" class="absolute z-20 w-full mt-2 bg-white border border-blue-200 rounded-xl shadow-xl hidden overflow-hidden">
                                                    <!-- Search Box -->
                                                    <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-100">
                                                        <div class="relative">
                                                            <input type="text" id="departureSearch" 
                                                                class="w-full p-3 pl-10 border border-blue-200 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 transition duration-200"
                                                                placeholder="Search cities..." data-en-placeholder="Search cities..." data-vi-placeholder="Tìm kiếm thành phố...">
                                                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-blue-500"></i>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Cities List -->
                                                    <div id="departureCitiesList" class="max-h-60 overflow-y-auto">
                                                        <div class="p-4 text-center text-gray-500">
                                                            <div class="inline-flex items-center px-4 py-2 bg-blue-50 rounded-lg">
                                                                <i class="fas fa-spinner fa-spin mr-2 text-blue-500"></i>
                                                                <span data-en="Loading cities..." data-vi="Đang tải thành phố...">Loading cities...</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Destination City Dropdown -->
                                        <div>
                                            <label class="block text-gray-700 font-semibold mb-3 flex items-center">
                                                <i class="fas fa-plane-arrival text-purple-500 mr-2"></i>
                                                <span data-en="Destination City" data-vi="Thành Phố Đích">Destination City</span>
                                                <span class="text-red-500 ml-1">*</span>
                                            </label>
                                            <div class="relative">
                                                <button type="button" id="destinationDropdownBtn" 
                                                    class="w-full p-4 bg-white border-2 border-purple-200 rounded-xl text-left flex items-center justify-between hover:border-purple-400 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-200 transition duration-300 shadow-sm hover:shadow-md">
                                                    <div class="flex items-center">
                                                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                                            <i class="fas fa-map-marker-alt text-purple-600 text-sm"></i>
                                                        </div>
                                                        <span id="destinationSelected" class="text-gray-500 font-medium" data-en="Select Destination City" data-vi="Chọn Thành Phố Đích">Select Destination City</span>
                                                    </div>
                                                    <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                                                </button>
                                            
                                                <!-- Enhanced Destination Dropdown Menu -->
                                                <div id="destinationDropdownMenu" class="absolute z-20 w-full mt-2 bg-white border border-purple-200 rounded-xl shadow-xl hidden overflow-hidden">
                                                    <!-- Search Box -->
                                                    <div class="p-4 bg-gradient-to-r from-purple-50 to-pink-50 border-b border-purple-100">
                                                        <div class="relative">
                                                            <input type="text" id="destinationSearch" 
                                                                class="w-full p-3 pl-10 border border-purple-200 rounded-lg focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-200 transition duration-200"
                                                                placeholder="Search cities..." data-en-placeholder="Search cities..." data-vi-placeholder="Tìm kiếm thành phố...">
                                                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-purple-500"></i>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Cities List -->
                                                    <div id="destinationCitiesList" class="max-h-60 overflow-y-auto">
                                                        <div class="p-4 text-center text-gray-500">
                                                            <div class="inline-flex items-center px-4 py-2 bg-purple-50 rounded-lg">
                                                                <i class="fas fa-spinner fa-spin mr-2 text-purple-500"></i>
                                                                <span data-en="Loading cities..." data-vi="Đang tải thành phố...">Loading cities...</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Enhanced Date Range Picker -->
                                <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-100">
                                    <div class="flex items-center mb-4">
                                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center mr-3">
                                            <i class="fas fa-calendar-alt text-white"></i>
                                        </div>
                                        <h4 class="text-xl font-bold text-gray-800" data-en="Travel Dates" data-vi="Ngày Du Lịch">Travel Dates</h4>
                                    </div>
                                    
                                    <label class="block text-gray-700 font-semibold mb-3 flex items-center">
                                        <i class="fas fa-clock text-green-500 mr-2"></i>
                                        <span data-en="Select Your Journey Dates" data-vi="Chọn Ngày Hành Trình">Select Your Journey Dates</span>
                                        <span class="text-red-500 ml-1">*</span>
                                    </label>
                                    <div class="relative">
                                        <button type="button" id="dateRangeBtn" 
                                            class="w-full p-4 bg-white border-2 border-green-200 rounded-xl text-left flex items-center justify-between hover:border-green-400 focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-200 transition duration-300 shadow-sm hover:shadow-md">
                                            <div class="flex items-center">
                                                <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                                    <i class="fas fa-calendar text-green-600 text-sm"></i>
                                                </div>
                                                <span id="dateRangeDisplay" class="text-gray-500 font-medium" data-en="Departure date - Arrival date" data-vi="Ngày đi - Ngày về">Departure date - Arrival date</span>
                                            </div>
                                            <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                                        </button>
                                        
                                        <!-- Enhanced Date Range Calendar -->
                                        <div id="dateRangeCalendar" class="absolute z-30 w-80 mt-2 bg-white border border-green-200 rounded-xl shadow-xl hidden overflow-hidden">
                                            <div class="p-3">
                                                <!-- Calendar Header -->
                                                <div class="flex items-center justify-between mb-3">
                                                    <button type="button" id="prevMonthBtn" class="p-1 hover:bg-gray-100 rounded">
                                                        <i class="fas fa-chevron-left text-gray-600 text-xs"></i>
                                                    </button>
                                                    <div class="flex items-center space-x-2">
                                                        <h3 id="currentMonthYear" class="font-semibold text-gray-800 text-sm"></h3>
                                                    </div>
                                                    <button type="button" id="nextMonthBtn" class="p-1 hover:bg-gray-100 rounded">
                                                        <i class="fas fa-chevron-right text-gray-600 text-xs"></i>
                                                    </button>
                                                </div>
                                                
                                                <!-- Days of Week -->
                                                <div class="grid grid-cols-7 gap-1 mb-2">
                                                    <div class="text-center text-xs font-medium text-gray-600 py-1" data-en="Sun" data-vi="CN">Sun</div>
                                                    <div class="text-center text-xs font-medium text-gray-600 py-1" data-en="Mon" data-vi="T2">Mon</div>
                                                    <div class="text-center text-xs font-medium text-gray-600 py-1" data-en="Tue" data-vi="T3">Tue</div>
                                                    <div class="text-center text-xs font-medium text-gray-600 py-1" data-en="Wed" data-vi="T4">Wed</div>
                                                    <div class="text-center text-xs font-medium text-gray-600 py-1" data-en="Thu" data-vi="T5">Thu</div>
                                                    <div class="text-center text-xs font-medium text-gray-600 py-1" data-en="Fri" data-vi="T6">Fri</div>
                                                    <div class="text-center text-xs font-medium text-gray-600 py-1" data-en="Sat" data-vi="T7">Sat</div>
                                                </div>
                                                
                                                <!-- Calendar Days -->
                                                <div id="calendarDays" class="grid grid-cols-7 gap-1 mb-3">
                                                    <!-- Days will be generated by JavaScript -->
                                                </div>
                                                
                                                <!-- Calendar Footer -->
                                                <div class="flex items-center justify-between pt-2 border-t border-gray-100">
                                                    <button type="button" id="clearDatesBtn" class="text-xs text-gray-500 hover:text-gray-700">
                                                        <span data-en="Clear" data-vi="Xóa">Clear</span>
                                                    </button>
                                                    <button type="button" id="applyDatesBtn" class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 transition duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                                        <span data-en="Apply" data-vi="Áp dụng">Apply</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Hidden inputs for form submission -->
                                        <input type="hidden" id="v2DepartureDate" name="departureDate">
                                        <input type="hidden" id="v2ArrivalDate" name="arrivalDate">
                                    </div>
                                </div>

                                <!-- Enhanced Passengers and Budget Row -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Enhanced Passengers Section -->
                                    <div class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-6 border border-orange-100">
                                        <div class="flex items-center mb-4">
                                            <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-amber-600 rounded-lg flex items-center justify-center mr-3">
                                                <i class="fas fa-users text-white"></i>
                                            </div>
                                            <h4 class="text-xl font-bold text-gray-800" data-en="Travelers" data-vi="Hành Khách">Travelers</h4>
                                        </div>
                                        
                                        <label class="block text-gray-700 font-semibold mb-3 flex items-center">
                                            <i class="fas fa-user-friends text-orange-500 mr-2"></i>
                                            <span data-en="Number of Passengers" data-vi="Số Lượng Hành Khách">Number of Passengers</span>
                                            <span class="text-red-500 ml-1">*</span>
                                        </label>
                                        <div class="relative">
                                            <button type="button" id="passengersDropdownBtn" 
                                                class="w-full p-4 bg-white border-2 border-orange-200 rounded-xl text-left flex items-center justify-between hover:border-orange-400 focus:border-orange-500 focus:outline-none focus:ring-2 focus:ring-orange-200 transition duration-300 shadow-sm hover:shadow-md">
                                                <div class="flex items-center">
                                                    <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                                                        <i class="fas fa-user text-orange-600 text-sm"></i>
                                                    </div>
                                                    <span id="passengersSelected" class="text-gray-700 font-medium">0 Passengers</span>
                                                </div>
                                                <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                                            </button>
                                            
                                            <!-- Enhanced Passengers Dropdown Menu -->
                                            <div id="passengersDropdownMenu" class="absolute z-20 w-full mt-2 bg-white border border-orange-200 rounded-xl shadow-xl hidden overflow-hidden">
                                                <div class="p-6 space-y-6 max-h-80 overflow-y-auto scrollbar-thin scrollbar-thumb-orange-300 scrollbar-track-orange-100">
                                                    <!-- Adults -->
                                                    <div class="flex items-center justify-between">
                                                        <div>
                                                            <div class="font-medium text-gray-700" data-en="Adults" data-vi="Người Lớn">Adults</div>
                                                            <div class="text-sm text-gray-500" data-en="12+ years" data-vi="Từ 12 tuổi trở lên">12+ years</div>
                                                        </div>
                                                        <div class="flex items-center space-x-3">
                                                            <button type="button" class="passenger-btn-minus w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50" data-type="adults">
                                                                <i class="fas fa-minus text-sm text-gray-600"></i>
                                                            </button>
                                                            <span id="adultsCount" class="w-8 text-center font-medium">0</span>
                                                            <button type="button" class="passenger-btn-plus w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50" data-type="adults">
                                                                <i class="fas fa-plus text-sm text-gray-600"></i>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <!-- Children -->
                                                    <div class="flex items-center justify-between">
                                                        <div>
                                                            <div class="font-medium text-gray-700" data-en="Children" data-vi="Trẻ Em">Children</div>
                                                            <div class="text-sm text-gray-500" data-en="2-11 years" data-vi="Từ 2-11 tuổi">2-11 years</div>
                                                        </div>
                                                        <div class="flex items-center space-x-3">
                                                            <button type="button" class="passenger-btn-minus w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50" data-type="children">
                                                                <i class="fas fa-minus text-sm text-gray-600"></i>
                                                            </button>
                                                            <span id="childrenCount" class="w-8 text-center font-medium">0</span>
                                                            <button type="button" class="passenger-btn-plus w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50" data-type="children">
                                                                <i class="fas fa-plus text-sm text-gray-600"></i>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <!-- Infants -->
                                                    <div class="flex items-center justify-between">
                                                        <div>
                                                            <div class="font-medium text-gray-700" data-en="Infants" data-vi="Em Bé">Infants</div>
                                                            <div class="text-sm text-gray-500" data-en="Under 2 years" data-vi="Dưới 2 tuổi">Under 2 years</div>
                                                        </div>
                                                        <div class="flex items-center space-x-3">
                                                            <button type="button" class="passenger-btn-minus w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50" data-type="infants">
                                                                <i class="fas fa-minus text-sm text-gray-600"></i>
                                                            </button>
                                                            <span id="infantsCount" class="w-8 text-center font-medium">0</span>
                                                            <button type="button" class="passenger-btn-plus w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50" data-type="infants">
                                                                <i class="fas fa-plus text-sm text-gray-600"></i>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <!-- Enhanced Done Button -->
                                                    <div class="pt-4 border-t border-orange-100">
                                                        <button type="button" id="passengersDoneBtn" 
                                                            class="w-full bg-gradient-to-r from-orange-500 to-amber-600 text-white py-3 rounded-xl hover:from-orange-600 hover:to-amber-700 transition duration-300 font-semibold shadow-lg hover:shadow-xl">
                                                            <span data-en="Done" data-vi="Xong">Done</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Enhanced Budget Section -->
                                    <div class="bg-gradient-to-r from-pink-50 to-rose-50 rounded-xl p-6 border border-pink-100">
                                        <div class="flex items-center mb-4">
                                            <div class="w-10 h-10 bg-gradient-to-br from-pink-500 to-rose-600 rounded-lg flex items-center justify-center mr-3">
                                                <i class="fas fa-wallet text-white"></i>
                                            </div>
                                            <h4 class="text-xl font-bold text-gray-800" data-en="Budget Planning" data-vi="Kế Hoạch Ngân Sách">Budget Planning</h4>
                                        </div>
                                        
                                        <label class="block text-gray-700 font-semibold mb-3 flex items-center">
                                            <i class="fas fa-dollar-sign text-pink-500 mr-2"></i>
                                            <span data-en="Total Budget (USD)" data-vi="Tổng Ngân Sách (USD)">Total Budget (USD)</span>
                                            <span class="text-red-500 ml-1">*</span>
                                        </label>
                                        <div class="relative">
                                            <input type="number" id="v2Budget" 
                                                class="w-full p-4 pl-12 bg-white border-2 border-pink-200 rounded-xl focus:border-pink-500 focus:outline-none focus:ring-2 focus:ring-pink-200 transition duration-300 font-medium text-lg shadow-sm hover:shadow-md"
                                                placeholder="Enter your budget" data-en-placeholder="Enter your budget" data-vi-placeholder="Nhập ngân sách của bạn"
                                                min="100" step="50">
                                            <div class="absolute left-4 top-1/2 transform -translate-y-1/2">
                                                <i class="fas fa-dollar-sign text-pink-500"></i>
                                            </div>
                                            <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-sm text-gray-500">
                                                USD
                                            </div>
                                        </div>
                                        <!-- Budget suggestions -->
                                        <div class="mt-3 flex flex-wrap gap-2">
                                            <button type="button" class="budget-suggestion px-3 py-1 bg-pink-100 hover:bg-pink-200 text-pink-700 rounded-lg text-sm font-medium transition duration-200" data-amount="500">$500</button>
                                            <button type="button" class="budget-suggestion px-3 py-1 bg-pink-100 hover:bg-pink-200 text-pink-700 rounded-lg text-sm font-medium transition duration-200" data-amount="1000">$1,000</button>
                                            <button type="button" class="budget-suggestion px-3 py-1 bg-pink-100 hover:bg-pink-200 text-pink-700 rounded-lg text-sm font-medium transition duration-200" data-amount="2000">$2,000</button>
                                            <button type="button" class="budget-suggestion px-3 py-1 bg-pink-100 hover:bg-pink-200 text-pink-700 rounded-lg text-sm font-medium transition duration-200" data-amount="5000">$5,000</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Enhanced Continue Button -->
                                <div class="pt-8">
                                    <button type="button" id="continueToStep2Btn" 
                                        class="w-full bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 text-white py-5 rounded-2xl hover:from-blue-700 hover:via-purple-700 hover:to-indigo-700 transition duration-300 font-bold text-xl shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.98]">
                                        <div class="flex items-center justify-center">
                                            <div class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3">
                                                <i class="fas fa-plane text-white"></i>
                                            </div>
                                            <span data-en="Continue to Flight Booking" data-vi="Tiếp Tục Đặt Vé Máy Bay">Continue to Flight Booking</span>
                                            <i class="fas fa-arrow-right ml-3"></i>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>

                            <!-- Enhanced Flight Booking Section (Hidden initially) -->
                            <div id="flightBookingSection" class="hidden mt-12">
                                <!-- Flight Section Header -->
                                <div class="bg-gradient-to-r from-sky-50 via-blue-50 to-indigo-50 rounded-2xl p-8 mb-8 border border-sky-100 shadow-sm">
                                    <div class="flex items-center mb-6">
                                        <div class="w-16 h-16 bg-gradient-to-br from-sky-500 via-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg mr-6">
                                            <i class="fas fa-plane text-white text-2xl"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-4xl font-bold bg-gradient-to-r from-sky-600 via-blue-600 to-indigo-600 bg-clip-text text-transparent mb-2" 
                                                data-en="Flight Booking" data-vi="Đặt Vé Máy Bay">Flight Booking</h3>
                                            <p class="text-gray-600 text-lg" data-en="Select your flights for the perfect journey" 
                                                data-vi="Chọn chuyến bay hoàn hảo cho hành trình của bạn">Select your flights for the perfect journey</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Updated Progress Steps -->
                                    <div class="flex items-center justify-between bg-white rounded-xl p-4 shadow-sm">
                                        <div class="flex items-center opacity-60">
                                            <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">
                                                <i class="fas fa-check text-xs"></i>
                                            </div>
                                            <span class="text-green-600 font-medium" data-en="Basic Information" data-vi="Thông Tin Cơ Bản">Basic Information</span>
                                        </div>
                                        <div class="flex-1 h-0.5 bg-blue-200 mx-4"></div>
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">2</div>
                                            <span class="text-blue-600 font-medium" data-en="Flight Booking" data-vi="Đặt Vé Máy Bay">Flight Booking</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex gap-8">
                                    <!-- Left Column - Flight Selection -->
                                    <div class="flex-1">

                                        <!-- Enhanced Departure Flight Section -->
                                        <div class="mb-8">
                                            <button aria-label="Xem thêm" class="collapse-preview__header pointer collapse-list-flight w-full mb-6 p-6 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl shadow-lg border-2 border-emerald-200 hover:shadow-xl hover:border-emerald-300 transition-all duration-300">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center">
                                                        <div class="w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center mr-4 shadow-md">
                                                            <i class="fas fa-plane-departure text-white text-lg"></i>
                                                        </div>
                                                        <div class="collapse--header-title">
                                                            <span class="text-sm font-medium text-emerald-600 mb-1 block" data-en="Departure Flight" data-vi="Chuyến bay đi">Departure Flight</span>
                                                            <p id="departureFlightRoute" class="font-bold text-xl text-gray-800">TP HCM (SGN) → Hà Nội (HAN)</p>
                                                        </div>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <div class="text-right mr-4">
                                                            <p class="text-sm text-gray-500" data-en="Select flight" data-vi="Chọn chuyến bay">Select flight</p>
                                                            <p class="text-lg font-bold text-emerald-600">3-5 options</p>
                                                        </div>
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" class="departure-chevron transition-transform text-emerald-600">
                                                            <path fill="currentColor" fill-rule="evenodd" d="M17.586 14.469a.75.75 0 0 1-1.054.117L12 10.96l-4.532 3.626a.75.75 0 0 1-.937-1.172l5-4a.75.75 0 0 1 .938 0l5 4a.75.75 0 0 1 .117 1.055" clip-rule="evenodd"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </button>

                                            <!-- Departure Flights List -->
                                            <div id="departureFlightsList" class="space-y-4 hidden">
                                                <!-- Flight cards will be generated here -->
                                            </div>
                                        </div>

                                        <!-- Enhanced Return Flight Section -->
                                        <div class="mb-8">
                                            <button aria-label="Xem thêm" class="collapse-preview__header pointer collapse-list-flight w-full mb-6 p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl shadow-lg border-2 border-amber-200 hover:shadow-xl hover:border-amber-300 transition-all duration-300">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center">
                                                        <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center mr-4 shadow-md">
                                                            <i class="fas fa-plane-arrival text-white text-lg"></i>
                                                        </div>
                                                        <div class="collapse--header-title">
                                                            <span class="text-sm font-medium text-amber-600 mb-1 block" data-en="Return Flight" data-vi="Chuyến bay về">Return Flight</span>
                                                            <p id="returnFlightRoute" class="font-bold text-xl text-gray-800">Hà Nội (HAN) → TP HCM (SGN)</p>
                                                        </div>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <div class="text-right mr-4">
                                                            <p class="text-sm text-gray-500" data-en="Select flight" data-vi="Chọn chuyến bay">Select flight</p>
                                                            <p class="text-lg font-bold text-amber-600">3-5 options</p>
                                                        </div>
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" class="return-chevron transition-transform text-amber-600">
                                                            <path fill="currentColor" fill-rule="evenodd" d="M17.586 14.469a.75.75 0 0 1-1.054.117L12 10.96l-4.532 3.626a.75.75 0 0 1-.937-1.172l5-4a.75.75 0 0 1 .938 0l5 4a.75.75 0 0 1 .117 1.055" clip-rule="evenodd"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </button>

                                            <!-- Return Flights List -->
                                            <div id="returnFlightsList" class="space-y-4 hidden">
                                                <!-- Flight cards will be generated here -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Enhanced Right Column - Order Summary -->
                                    <div class="w-96">
                                        <div class="preview-booking-card__content bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl shadow-xl border-2 border-indigo-200 sticky top-4 overflow-hidden">
                                            <div class="preview-booking-card--header p-6 bg-gradient-to-r from-indigo-500 to-purple-600 text-white">
                                                <div class="flex items-center">
                                                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3">
                                                        <i class="fas fa-receipt text-white"></i>
                                                    </div>
                                                    <div>
                                                        <h4 class="font-bold text-white text-xl" data-en="Booking Summary" data-vi="Tóm tắt đặt vé">Booking Summary</h4>
                                                        <p class="text-indigo-100 text-sm" data-en="Your selected flights" data-vi="Các chuyến bay đã chọn">Your selected flights</p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="preview-booking-card--body p-6">
                                                <div class="preview-booking-card--body__flights mb-8">
                                                    <div class="collapse-preview">
                                                        <button aria-label="Xem thêm" class="collapse-preview__header pointer w-full p-4 bg-white bg-opacity-80 rounded-xl hover:bg-opacity-100 transition-all duration-300 shadow-sm hover:shadow-md border border-indigo-200">
                                                            <div class="flex items-center justify-between">
                                                                <div class="flex items-center">
                                                                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center mr-3 shadow-md">
                                                                        <i class="fas fa-plane text-white"></i>
                                                                    </div>
                                                                    <div class="collapse--header-title">
                                                                        <p class="font-bold text-gray-800 text-lg" data-en="Your Selected Flights" data-vi="Chuyến bay đã chọn">Your Selected Flights</p>
                                                                        <p class="text-sm text-gray-500" data-en="Review your selections" data-vi="Xem lại lựa chọn">Review your selections</p>
                                                                    </div>
                                                                </div>
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" class="summary-chevron transition-transform text-indigo-600">
                                                                    <path fill="currentColor" fill-rule="evenodd" d="M6.414 9.532a.75.75 0 0 1 1.055-.118L12 13.04l4.532-3.626a.75.75 0 1 1 .936 1.172l-5 4a.75.75 0 0 1-.937 0l-5-4a.75.75 0 0 1-.117-1.054" clip-rule="evenodd"></path>
                                                                </svg>
                                                            </div>
                                                        </button>
                                                        
                                                        <div class="collapse-preview__content animated-animation animate__slideInDown hidden">
                                                            <div class="collapse-preview__content--divider border-t border-gray-200 mt-3"></div>
                                                            
                                                            <!-- Selected Departure Flight -->
                                                            <div id="selectedDepartureFlight" class="flight-preview-booking hidden">
                                                                <div class="flight-preview-booking__header py-3">
                                                                    <div class="flight-preview-booking__line h-0.5 bg-blue-200 mb-2"></div>
                                                                    <div class="flight-preview-booking__content">
                                                                        <div class="flight-preview-booking__content--number">
                                                                            <p class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-medium">1</p>
                                                                        </div>
                                                                        <div class="flight-preview-booking__content--info ml-3">
                                                                            <span class="text-sm text-gray-600" id="departureFlightDate" data-en="Friday, 29/08/2025" data-vi="Thứ sáu, 29/08/2025">Friday, 29/08/2025</span>
                                                                            <div class="flex items-center mt-1">
                                                                                <p class="text-sm font-medium" id="departureFlightAirline">Vietnam Airlines</p>
                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" class="mx-2">
                                                                                    <path fill="#000" d="M16.434 12.5c.29-.266.32-.898.03-1.164L12.509 7.7a.79.79 0 0 0-1.049 0 .644.644 0 0 0 0 .964l2.69 2.472H4.074c-.41 0-.742.306-.742.682s.332.682.742.682z"></path>
                                                                                </svg>
                                                                                <p class="text-sm font-medium" id="departureFlightTime">08:45 - 11:00</p>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Selected Return Flight -->
                                                            <div id="selectedReturnFlight" class="flight-preview-booking hidden">
                                                                <div class="flight-preview-booking__header py-3">
                                                                    <div class="flight-preview-booking__line h-0.5 bg-blue-200 mb-2"></div>
                                                                    <div class="flight-preview-booking__content">
                                                                        <div class="flight-preview-booking__content--number">
                                                                            <p class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-medium">2</p>
                                                                        </div>
                                                                        <div class="flight-preview-booking__content--info ml-3">
                                                                            <span class="text-sm text-gray-600" id="returnFlightDate" data-en="Wednesday, 10/09/2025" data-vi="Thứ Tư, 10/09/2025">Wednesday, 10/09/2025</span>
                                                                            <div class="flex items-center mt-1">
                                                                                <p class="text-sm font-medium" id="returnFlightAirline">Vietjet Air</p>
                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" class="mx-2">
                                                                                    <path fill="#000" d="M16.434 12.5c.29-.266.32-.898.03-1.164L12.509 7.7a.79.79 0 0 0-1.049 0 .644.644 0 0 0 0 .964l2.69 2.472H4.074c-.41 0-.742.306-.742.682s.332.682.742.682z"></path>
                                                                                </svg>
                                                                                <p class="text-sm font-medium" id="returnFlightTime">06:15 - 08:30</p>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Enhanced Total Price Section -->
                                                <div class="preview-booking-card--body__total bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-6 mt-6 border border-purple-200">
                                                    <div class="preview-booking-card--body__total--label flex justify-between items-center mb-6">
                                                        <div class="flex items-center">
                                                            <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3">
                                                                <i class="fas fa-calculator text-white text-sm"></i>
                                                            </div>
                                                            <p class="font-bold text-xl text-gray-800" data-en="Total Price:" data-vi="Tổng Tiền:">Total Price:</p>
                                                        </div>
                                                        <span id="totalFlightPrice" class="font-bold text-2xl bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">$1,580</span>
                                                    </div>
                                                    
                                                    <!-- Price breakdown -->
                                                    <div class="space-y-2 mb-6 text-sm">
                                                        <div class="flex justify-between text-gray-600">
                                                            <span data-en="Departure flight" data-vi="Chuyến bay đi">Departure flight</span>
                                                            <span id="departureFlightPriceDisplay">$790</span>
                                                        </div>
                                                        <div class="flex justify-between text-gray-600">
                                                            <span data-en="Return flight" data-vi="Chuyến bay về">Return flight</span>
                                                            <span id="returnFlightPriceDisplay">$790</span>
                                                        </div>
                                                        <div class="border-t border-purple-200 pt-2 flex justify-between font-semibold text-gray-800">
                                                            <span data-en="Total" data-vi="Tổng cộng">Total</span>
                                                            <span id="totalPriceDisplay">$1,580</span>
                                                        </div>
                                                    </div>
                                                    
                                                    <button id="confirmFlightBookingBtn" aria-label="Select Flights" class="btn-confirm-pick btn-primary w-full py-4 bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:bg-gray-400 disabled:bg-none" disabled>
                                                        <div class="flex items-center justify-center">
                                                            <i class="fas fa-check-circle mr-2"></i>
                                                            <span data-en="Confirm Flight Selection" data-vi="Xác Nhận Chọn Vé">Confirm Flight Selection</span>
                                                        </div>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Restaurant Tab -->
                    <div id="restaurant-tab" class="tab-content hidden">
                        <!-- AJAX Search Field với Autocomplete -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Search Restaurants" data-vi="Tìm Nhà Hàng">Search Restaurants</span>
                                <span class="text-sm text-gray-500 ml-2" data-en="(Type restaurant name, city or country)" data-vi="(Gõ tên nhà hàng, thành phố hoặc quốc gia)"></span>
                            </label>
                            <div class="relative">
                                <input 
                                    type="text" 
                                    id="restaurantSearchInput" 
                                    class="form-control w-full p-3 bg-white pr-10" 
                                    placeholder="Nhập tên nhà hàng, thành phố..."
                                    data-en-placeholder="Type restaurant name, city or country..."
                                    data-vi-placeholder="Nhập tên nhà hàng, thành phố..."
                                    autocomplete="off"
                                >
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                    <i class="fas fa-search text-gray-400"></i>
                                    <div id="restaurantSearchSpinner" class="hidden ml-2">
                                        <i class="fas fa-spinner fa-spin text-blue-500"></i>
                                    </div>
                                </div>
                                
                                <!-- Autocomplete Dropdown -->
                                <div id="restaurantAutocompleteDropdown" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-80 overflow-y-auto hidden">
                                    <div id="restaurantAutocompleteResults" class="py-2">
                                        <!-- Suggestions will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <form id="restaurantSearchForm">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">
                                        <span data-en="Country" data-vi="Quốc gia">Country</span>
                                        <span class="text-gray-500 text-sm" data-en="(Optional)" data-vi="(Tùy chọn)">(Optional)</span>
                                    </label>
                                    <div class="relative">
                                        <input 
                                            type="text" 
                                            id="restaurantCountryInput" 
                                            class="form-control w-full p-3 bg-white" 
                                            placeholder="Type country name..."
                                            data-en-placeholder="Type country name..."
                                            data-vi-placeholder="Gõ tên quốc gia..."
                                            name="country"
                                            autocomplete="off"
                                        >
                                        <i class="fas fa-globe absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                        
                                        <!-- Country Autocomplete Dropdown -->
                                        <div id="restaurantCountryAutocomplete" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto hidden">
                                            <div id="restaurantCountryResults" class="py-2">
                                                <!-- Country suggestions will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">
                                        <span data-en="City/Province" data-vi="Thành phố/Tỉnh">City/Province</span>
                                        <span class="text-gray-500 text-sm" data-en="(Optional)" data-vi="(Tùy chọn)">(Optional)</span>
                                    </label>
                                    <div class="relative">
                                        <input 
                                            type="text" 
                                            id="restaurantCityInput" 
                                            class="form-control w-full p-3 bg-white" 
                                            placeholder="Type city name..."
                                            data-en-placeholder="Type city name..."
                                            data-vi-placeholder="Gõ tên thành phố..."
                                            name="city"
                                            autocomplete="off"
                                        >
                                        <i class="fas fa-map-marker-alt absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                        
                                        <!-- City Autocomplete Dropdown -->
                                        <div id="restaurantCityAutocomplete" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto hidden">
                                            <div id="restaurantCityResults" class="py-2">
                                                <!-- City suggestions will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">
                                        <span data-en="Cuisine Type" data-vi="Loại Ẩm Thực">Cuisine Type</span>
                                        <span class="text-gray-500 text-sm" data-en="(Optional)" data-vi="(Tùy chọn)">(Optional)</span>
                                    </label>
                                    <div class="relative">
                                        <select id="restaurantCuisineSelect" class="form-control w-full p-3 bg-white appearance-none" name="cuisine_type">
                                            <option value="" data-en="All Cuisines" data-vi="Tất cả ẩm thực">All Cuisines</option>
                                            <!-- Cuisine options will be loaded from API -->
                                        </select>
                                        <i class="fas fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    </div>
                                </div>
                                <div class="flex flex-col">
                                    <div class="mb-auto"></div> <!-- Spacer để align button xuống dưới -->
                                    <div class="flex gap-3 mt-auto">
                                        <button type="submit" class="btn-search px-8 py-3 text-white font-medium rounded-lg flex-1">
                                            <span data-en="Search Restaurants" data-vi="Tìm Nhà Hàng">Search Restaurants</span>
                                        </button>
                                        <!-- Admin Only Add Restaurant Button -->
                                        <button type="button" id="addRestaurantBtn" class="admin-only bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition duration-300 flex items-center font-medium hidden" style="display: none;">
                                            <i class="fas fa-plus mr-2"></i>
                                            <span data-en="Add Restaurant" data-vi="Thêm Nhà Hàng">Add Restaurant</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <!-- Restaurants Results Section -->
                        <div id="restaurantResults" class="restaurant-list-container hidden mt-8">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-800" data-en="Search Results" data-vi="Kết Quả Tìm Kiếm">Search Results</h3>
                                <div class="flex items-center space-x-4">
                                    <span id="restaurantCount" class="text-gray-600"></span>
                                    <!-- Pagination Controls -->
                                    <div id="restaurantPagination" class="pagination-controls hidden">
                                        <button id="prevRestaurantPage" class="pagination-btn" disabled>
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <span id="restaurantPageInfo" class="pagination-info">1 / 1</span>
                                        <button id="nextRestaurantPage" class="pagination-btn" disabled>
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                    <button id="minimizeRestaurantResults" class="minimize-btn bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition-colors duration-200">
                                        <i class="fas fa-minus text-gray-600"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Restaurant Results Wrapper with detail view -->
                            <div id="restaurantResultsWrapper" class="restaurant-results-wrapper">
                                <!-- Restaurant List (left side when detail is shown) -->
                                <div id="restaurantList" class="restaurant-list grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    <!-- Restaurant items will be populated here -->
                                </div>
                                
                                <!-- Restaurant Detail Panel (right side) -->
                                <div id="restaurantDetailPanel" class="restaurant-detail-panel" style="display: none;">
                                    <!-- Detail Header Enhanced -->
                                    <div class="detail-header-enhanced">
                                        <div class="header-background"></div>
                                        <div class="header-content">
                                            <button id="closeDetailBtn" class="close-btn-enhanced">
                                                <i class="fas fa-times"></i>
                                            </button>
                                            <div class="header-text">
                                                <h2 class="header-title" data-en="Restaurant Details" data-vi="Chi Tiết Nhà Hàng">Restaurant Details</h2>
                                                <p class="header-subtitle" data-en="Detailed information & description" data-vi="Thông tin chi tiết & mô tả">Detailed information & description</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Detail Content Enhanced -->
                                    <div class="detail-content-enhanced">
                                        <!-- Restaurant Info Cards -->
                                        <div id="restaurantDetailContent" class="restaurant-detail-cards">
                                            <!-- Restaurant details will be populated here -->
                                        </div>
                                        
                                        <!-- Description Section Enhanced -->
                                        <div class="description-section-enhanced">
                                            <div class="description-header">
                                                <div class="description-icon">
                                                    <i class="fas fa-align-left"></i>
                                                </div>
                                                <h3 class="description-title" data-en="About This Restaurant" data-vi="Về Nhà Hàng Này">About This Restaurant</h3>
                                            </div>
                                            <div id="restaurantDescription" class="description-content">
                                                <!-- Description will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div id="restaurantLoading" class="hidden text-center py-12">
                            <div class="loading-spinner mx-auto mb-4"></div>
                            <p class="text-gray-600" data-en="Searching for restaurants..." data-vi="Đang tìm kiếm nhà hàng...">Searching for restaurants...</p>
                        </div>

                        <!-- No Results State -->
                        <div id="restaurantNoResults" class="hidden text-center py-12">
                            <i class="fas fa-utensils text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2" data-en="No Restaurants Found" data-vi="Không Tìm Thấy Nhà Hàng">No Restaurants Found</h3>
                            <p class="text-gray-500" data-en="Try adjusting your search criteria" data-vi="Thử điều chỉnh tiêu chí tìm kiếm">Try adjusting your search criteria</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Search History Section -->
            <div class="glass-card rounded-2xl p-8">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h3 class="text-2xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent"
                            data-en="Tour Search History" data-vi="Lịch Sử Tìm Kiếm Tour">Tour Search History</h3>
                        <p class="text-gray-500 mt-1" data-en="Your recent travel searches and bookings"
                            data-vi="Các tìm kiếm và đặt chỗ du lịch gần đây">Your recent travel searches and bookings</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="prevPageBtn" 
                            class="bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition duration-300 text-sm font-medium flex items-center"
                            data-en="Previous" data-vi="Trước">
                            <i class="fas fa-chevron-left mr-1"></i>
                            <span>Previous</span>
                        </button>
                        <button id="nextPageBtn"
                            class="bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition duration-300 text-sm font-medium flex items-center"
                            data-en="Next" data-vi="Tiếp">
                            <span>Next</span>
                            <i class="fas fa-chevron-right ml-1"></i>
                        </button>
                        <button id="viewAllHistoryBtn"
                            class="bg-blue-500 text-white px-6 py-2 rounded-xl hover:bg-blue-600 transition duration-300 text-sm font-medium flex items-center"
                            data-en="View All" data-vi="Xem Tất Cả">
                            <span>View All</span>
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- History Loading State -->
                <div id="historyLoading" class="text-center py-12 hidden">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-600" data-en="Loading tour history..." data-vi="Đang tải lịch sử tour...">Loading tour history...</p>
                </div>

                <!-- History Content -->
                <div id="historyContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- History items will be populated here -->
                </div>

                <!-- No History State -->
                <div id="noHistoryState" class="text-center py-12 hidden">
                    <i class="fas fa-history text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2" data-en="No Tour History Yet" data-vi="Chưa Có Lịch Sử Tour">No Tour History Yet</h3>
                    <p class="text-gray-500" data-en="Start planning your first trip!" data-vi="Hãy bắt đầu lên kế hoạch cho chuyến đi đầu tiên!">Start planning your first trip!</p>
                </div>
            </div>

            <!-- Tour History Detail Modal -->
            <div id="tourHistoryDetailModal" class="tour-detail-modal" style="display: none;">
                <div class="modal-backdrop" onclick="closeTourDetailModal()"></div>
                <div class="modal-content-split">
                    <!-- Modal Header -->
                    <div class="modal-header-split">
                        <div class="header-content">
                            <div class="header-icon">
                                <i class="fas fa-route"></i>
                            </div>
                            <div class="header-text">
                                <h2 class="header-title" data-en="Tour Details" data-vi="Chi Tiết Tour">Tour Details</h2>
                                <p class="header-subtitle" data-en="Complete journey information" data-vi="Thông tin hành trình đầy đủ">Complete journey information</p>
                            </div>
                        </div>
                        <button class="close-btn" onclick="closeTourDetailModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <!-- Modal Body Split Layout -->
                    <div class="modal-body-split">
                        <!-- Left Side - Images (40%) -->
                        <div class="tour-images-section">
                            <div id="tourImagesContent" class="tour-images-container">
                                <!-- Tour images will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Right Side - Details (60%) -->
                        <div class="tour-details-section">
                            <div class="h-full flex flex-col">
                                <!-- Tab Navigation -->
                                <div class="flex border-b sticky top-0 bg-white z-10">
                                    <button id="scheduleTabBtn" class="flex-1 py-4 px-6 font-medium text-center text-gray-500 hover:bg-gray-50 border-b-2 border-blue-500 text-blue-600 bg-blue-50">
                                        <i class="fas fa-calendar-alt mr-2"></i>
                                        <span data-en="Schedule" data-vi="Lịch trình">Schedule</span>
                                    </button>
                                    <button id="costTabBtn" class="flex-1 py-4 px-6 font-medium text-center text-gray-500 hover:bg-gray-50">
                                        <i class="fas fa-chart-pie mr-2"></i>
                                        <span data-en="Overall Estimated Cost" data-vi="Chi phí ước tính tổng thể">Overall Estimated Cost</span>
                                    </button>
                                </div>
                                
                                <!-- Tab Content -->
                                <div class="p-6 overflow-auto flex-grow">
                                    <!-- Schedule Tab (visible by default) -->
                                    <div id="scheduleTabContent" class="schedule-content">
                                        <div id="tourScheduleContent">
                                            <!-- Schedule content will be populated here -->
                                            <div class="space-y-6">
                                                <!-- Placeholder for days content -->
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Cost Tab (hidden by default) -->
                                    <div id="costTabContent" class="cost-content hidden">
                                        <div id="tourCostContent">
                                            <!-- Cost content will be populated here -->
                                            <div class="space-y-6">
                                                <!-- Enhanced Total Estimated Cost Display -->
                                                <div class="estimated-cost-container">
                                                    <div class="estimated-cost-header">
                                                        <div class="estimated-cost-title">
                                                            <i class="fas fa-receipt mr-2"></i>
                                                            <span data-en="Total Estimated Cost" data-vi="Tổng Chi Phí Ước Tính">Total Estimated Cost</span>
                                                        </div>
                                                        <div class="estimated-cost-currency"></div>
                                                    </div>
                                                    <div class="estimated-cost-value">0</div>
                                                    <div class="estimated-cost-details">
                                                        <div class="tour-option-id"></div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Budget Overview -->
                                                <div class="budget-comparison">
                                                    <div class="budget-info">
                                                        <div>
                                                            <i class="fas fa-bullseye text-blue-500 mr-2"></i>
                                                            <span data-en="Target Budget" data-vi="Ngân sách mục tiêu">Target Budget:</span>
                                                        </div>
                                                        <div class="font-semibold" id="targetBudget">0</div>
                                                    </div>
                                                    
                                                    <div class="budget-info">
                                                        <div>
                                                            <i class="fas fa-calculator text-purple-500 mr-2"></i>
                                                            <span data-en="Estimated Cost" data-vi="Chi phí ước tính">Estimated Cost:</span>
                                                        </div>
                                                        <div class="font-semibold" id="estimatedCost">0</div>
                                                    </div>
                                                    
                                                    <div class="budget-info">
                                                        <div>
                                                            <i class="fas fa-piggy-bank text-green-500 mr-2" id="remainingBudgetIcon"></i>
                                                            <span data-en="Remaining Budget" data-vi="Ngân sách còn lại" id="remainingBudgetLabel">Remaining Budget:</span>
                                                        </div>
                                                        <div class="font-semibold text-green-600" id="remainingBudget">0</div>
                                                    </div>
                                                    
                                                    <div class="mt-4 budget-progress-container">
                                                        <div class="budget-progress-bar">
                                                            <div class="budget-progress bg-green-500" id="budgetProgress" style="width: 0%"></div>
                                                        </div>
                                                        <div class="budget-labels">
                                                            <div class="budget-spent" id="budgetPercentUsed">0% Used</div>
                                                            <div class="budget-remaining" id="budgetPercentAvailable">100% Available</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Cost Breakdown -->
                                                <div class="cost-breakdown">
                                                    <h3 class="text-lg font-semibold mb-4">
                                                        <i class="fas fa-chart-pie text-blue-500 mr-2"></i>
                                                        <span data-en="Cost Breakdown" data-vi="Phân tích chi phí">Cost Breakdown</span>
                                                    </h3>
                                                    
                                                    <div class="space-y-4" id="costBreakdown">
                                                        <!-- Cost breakdown content will be populated here -->
                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                            <!-- Cost categories will be displayed here -->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="modal-footer-split">
                        <button class="btn-secondary" onclick="closeTourDetailModal()" data-en="Close" data-vi="Đóng">Close</button>
                        <button id="searchAgainBtn" class="btn-primary" data-en="Search Again" data-vi="Tìm Lại">Search Again</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Hotel Information Panel (Center Modal) -->
        <div id="hotelInfoPanel" class="info-panel-modal" style="display: none;">
            <div class="info-panel-backdrop" onclick="closeHotelInfoPanel()"></div>
            <div class="info-panel-content">
                <div class="info-panel-header">
                    <h2 class="info-panel-title" data-en="Hotel Information" data-vi="Thông Tin Khách Sạn">Hotel Information</h2>
                    <button class="info-panel-close" onclick="closeHotelInfoPanel()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="info-panel-body">
                    <div id="hotelInfoContent">
                        <!-- Hotel details will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Restaurant Information Panel (Center Modal) -->
        <div id="restaurantInfoPanel" class="info-panel-modal" style="display: none;">
            <div class="info-panel-backdrop" onclick="closeRestaurantInfoPanel()"></div>
            <div class="info-panel-content">
                <div class="info-panel-header">
                    <h2 class="info-panel-title" data-en="Restaurant Information" data-vi="Thông Tin Nhà Hàng">Restaurant Information</h2>
                    <button class="info-panel-close" onclick="closeRestaurantInfoPanel()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="info-panel-body">
                    <div id="restaurantInfoContent">
                        <!-- Restaurant details will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Restaurant Modal -->
        <div id="editRestaurantModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <!-- Modal Header -->
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" data-en="Edit Restaurant" data-vi="Chỉnh Sửa Nhà Hàng">Edit Restaurant</h2>
                        <p class="text-gray-600 mt-1" data-en="Update restaurant information" data-vi="Cập nhật thông tin nhà hàng">Update restaurant information</p>
                    </div>
                    <button id="closeEditRestaurantModal" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Edit Form -->
                <form id="editRestaurantForm" class="space-y-6">
                    <input type="hidden" id="edit_restaurant_id" name="restaurant_id">
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">
                            <span data-en="Restaurant Name" data-vi="Tên Nhà Hàng">Restaurant Name</span>
                            <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="edit_name" name="name" class="form-control w-full p-3 bg-white" placeholder="Restaurant Name" maxlength="200" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="City ID" data-vi="Mã Thành Phố">City ID</span>
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="edit_city_id" name="city_id" class="form-control w-full p-3 bg-white" placeholder="1" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="City" data-vi="Thành Phố">City</span>
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="edit_city" name="city" class="form-control w-full p-3 bg-white" placeholder="City" maxlength="100" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Country" data-vi="Quốc Gia">Country</span>
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="edit_country" name="country" class="form-control w-full p-3 bg-white" placeholder="Country" maxlength="100" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Average Price" data-vi="Giá Trung Bình">Average Price</span>
                            </label>
                            <input type="number" id="edit_price_avg" name="price_avg" class="form-control w-full p-3 bg-white" placeholder="150000" step="0.01">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Cuisine Type" data-vi="Loại Ẩm Thực">Cuisine Type</span>
                            </label>
                            <input type="text" id="edit_cuisine_type" name="cuisine_type" class="form-control w-full p-3 bg-white" placeholder="Cuisine Type" maxlength="100">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Rating" data-vi="Đánh Giá">Rating</span>
                            </label>
                            <input type="number" id="edit_rating" name="rating" class="form-control w-full p-3 bg-white" placeholder="4.5" step="0.01" min="0" max="5">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Latitude" data-vi="Vĩ Độ">Latitude</span>
                            </label>
                            <input type="number" id="edit_latitude" name="latitude" class="form-control w-full p-3 bg-white" placeholder="21.0285" step="0.00000001">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Longitude" data-vi="Kinh Độ">Longitude</span>
                            </label>
                            <input type="number" id="edit_longitude" name="longitude" class="form-control w-full p-3 bg-white" placeholder="105.8542" step="0.00000001">
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">
                            <span data-en="Description" data-vi="Mô Tả">Description</span>
                        </label>
                        <textarea id="edit_description" name="description" class="form-control w-full p-3 bg-white" rows="3" placeholder="Description..."></textarea>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex justify-end pt-6 border-t">
                        <button type="button" id="cancelEditBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors mr-3">
                            <span data-en="Cancel" data-vi="Hủy">Cancel</span>
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-save mr-2"></i>
                            <span data-en="Save Changes" data-vi="Lưu Thay Đổi">Save Changes</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Edit Hotel Modal -->
        <div id="editHotelModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <!-- Modal Header -->
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" data-en="Edit Hotel" data-vi="Chỉnh Sửa Khách Sạn">Edit Hotel</h2>
                        <p class="text-gray-600 mt-1" data-en="Update hotel information" data-vi="Cập nhật thông tin khách sạn">Update hotel information</p>
                    </div>
                    <button id="closeEditHotelModal" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Edit Form -->
                <form id="editHotelForm" class="space-y-6">
                    <input type="hidden" id="edit_hotel_id" name="hotel_id">
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">
                            <span data-en="Hotel Name" data-vi="Tên Khách Sạn">Hotel Name</span>
                            <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="edit_hotel_name" name="name" class="form-control w-full p-3 bg-white" placeholder="Hotel Name" maxlength="200" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="City ID" data-vi="Mã Thành Phố">City ID</span>
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="edit_hotel_city_id" name="city_id" class="form-control w-full p-3 bg-white" placeholder="1" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="City" data-vi="Thành Phố">City</span>
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="edit_hotel_city" name="city" class="form-control w-full p-3 bg-white" placeholder="City" maxlength="100" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Country" data-vi="Quốc Gia">Country</span>
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="edit_hotel_country" name="country" class="form-control w-full p-3 bg-white" placeholder="Country" maxlength="100" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Stars" data-vi="Số sao">Stars</span>
                            </label>
                            <input type="number" id="edit_hotel_stars" name="stars" class="form-control w-full p-3 bg-white" placeholder="4" step="1" min="1" max="5">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Price Per Night" data-vi="Giá Một Đêm">Price Per Night</span>
                            </label>
                            <input type="number" id="edit_hotel_price_per_night" name="price_per_night" class="form-control w-full p-3 bg-white" placeholder="150.00" step="0.01">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Rating" data-vi="Đánh Giá">Rating</span>
                            </label>
                            <input type="number" id="edit_hotel_rating" name="rating" class="form-control w-full p-3 bg-white" placeholder="7.5" step="0.1" min="0" max="10">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Latitude" data-vi="Vĩ Độ">Latitude</span>
                            </label>
                            <input type="number" id="edit_hotel_latitude" name="latitude" class="form-control w-full p-3 bg-white" placeholder="21.0285" step="0.00000001">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Longitude" data-vi="Kinh Độ">Longitude</span>
                            </label>
                            <input type="number" id="edit_hotel_longitude" name="longitude" class="form-control w-full p-3 bg-white" placeholder="105.8542" step="0.00000001">
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">
                            <span data-en="Description" data-vi="Mô Tả">Description</span>
                        </label>
                        <textarea id="edit_hotel_description" name="description" class="form-control w-full p-3 bg-white" rows="3" placeholder="Description..."></textarea>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex justify-end pt-6 border-t">
                        <button type="button" id="cancelEditHotelBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors mr-3">
                            <span data-en="Cancel" data-vi="Hủy">Cancel</span>
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-save mr-2"></i>
                            <span data-en="Save Changes" data-vi="Lưu Thay Đổi">Save Changes</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="deleteConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-2xl text-red-500"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800 mb-2" data-en="Confirm Delete" data-vi="Xác Nhận Xóa">Confirm Delete</h2>
                    <p id="deleteConfirmMessage" class="text-gray-600" data-en="Are you sure you want to delete this restaurant? This action cannot be undone." data-vi="Bạn có chắc chắn muốn xóa nhà hàng này? Hành động này không thể hoàn tác.">
                        Are you sure you want to delete this restaurant? This action cannot be undone.
                    </p>
                </div>
                
                <div class="flex justify-center space-x-4">
                    <button id="cancelDeleteBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                        <span data-en="Cancel" data-vi="Hủy">Cancel</span>
                    </button>
                    <button id="confirmDeleteBtn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                        <i class="fas fa-trash-alt mr-2"></i>
                        <span data-en="Delete" data-vi="Xóa">Delete</span>
                    </button>
                </div>
                <input type="hidden" id="deleteItemType" value="">
                <input type="hidden" id="deleteItemId" value="">
            </div>
        </div>

        <!-- Add Restaurant Modal -->
        <div id="addRestaurantModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <!-- Modal Header -->
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" data-en="Add New Restaurant" data-vi="Thêm Nhà Hàng Mới">Add New Restaurant</h2>
                        <p class="text-gray-600 mt-1" data-en="Choose how you want to add restaurant data" data-vi="Chọn cách bạn muốn thêm dữ liệu nhà hàng">Choose how you want to add restaurant data</p>
                    </div>
                    <button id="closeAddRestaurantModal" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Modal Content - Choice Options -->
                <div id="addRestaurantChoice" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Manual Add Option -->
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 border-2 border-transparent hover:border-blue-300 transition-all cursor-pointer" id="manualAddOption">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-edit text-white text-2xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2" data-en="Manual Entry" data-vi="Nhập Thủ Công">Manual Entry</h3>
                                <p class="text-gray-600 text-sm" data-en="Fill out the restaurant information form manually" data-vi="Điền thông tin nhà hàng bằng form thủ công">Fill out the restaurant information form manually</p>
                            </div>
                        </div>

                        <!-- Excel Upload Option -->
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border-2 border-transparent hover:border-green-300 transition-all cursor-pointer" id="excelUploadOption">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-file-excel text-white text-2xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2" data-en="Excel Upload" data-vi="Upload Excel">Excel Upload</h3>
                                <p class="text-gray-600 text-sm" data-en="Upload an Excel file with restaurant data" data-vi="Upload file Excel với dữ liệu nhà hàng">Upload an Excel file with restaurant data</p>
                            </div>
                        </div>
                    </div>

                    <!-- Excel Format Info -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-6">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-yellow-600 mt-1 mr-3"></i>
                            <div>
                                <h4 class="font-semibold text-yellow-800 mb-2" data-en="Excel File Requirements" data-vi="Yêu Cầu File Excel">Excel File Requirements</h4>
                                <p class="text-yellow-700 text-sm mb-2" data-en="Your Excel file must have these columns:" data-vi="File Excel của bạn phải có các cột sau:">Your Excel file must have these columns:</p>
                                <div class="text-xs font-mono bg-yellow-100 p-2 rounded text-yellow-800">
                                    name | city | country | price_avg | cuisine_type | rating | description
                                </div>
                                <p class="text-yellow-700 text-sm mt-2" data-en="Restaurant ID will be auto-generated. City ID, latitude, and longitude will be filled automatically." data-vi="Mã nhà hàng sẽ được tạo tự động. City ID, vĩ độ và kinh độ sẽ được điền tự động.">Restaurant ID will be auto-generated. City ID, latitude, and longitude will be filled automatically.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manual Form Container (Hidden by default) -->
                <div id="manualFormContainer" class="hidden">
                    <form id="addRestaurantForm" class="space-y-6">
                        <!-- Restaurant ID is now auto-generated -->
                        <div class="grid grid-cols-1 md:grid-cols-1 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Restaurant Name" data-vi="Tên Nhà Hàng">Restaurant Name</span>
                                    <span class="text-red-500">*</span>
                                </label>
                                <input type="text" name="name" class="form-control w-full p-3 bg-white" placeholder="Phở Hà Nội" maxlength="200" required>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="hidden">
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="City ID" data-vi="Mã Thành Phố">City ID</span>
                                </label>
                                <input type="number" name="city_id" id="restaurant_city_id" class="form-control w-full p-3 bg-white" placeholder="1">
                                <!-- Thêm hidden input để đảm bảo city_id được submit mà không bắt buộc người dùng nhập -->
                                <input type="hidden" name="city_id_fallback" id="restaurant_city_id_fallback" value="0">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Country" data-vi="Quốc Gia">Country</span>
                                    <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <input 
                                        type="text" 
                                        name="country" 
                                        id="restaurant_country" 
                                        class="form-control w-full p-3 bg-white" 
                                        placeholder="Vietnam" 
                                        maxlength="100" 
                                        required
                                        autocomplete="off">
                                    <input type="text" id="country_ghost" class="absolute top-0 left-0 w-full p-3 text-gray-300 bg-transparent pointer-events-none" readonly>
                                    <div id="countryAutocomplete" class="absolute bg-white shadow-lg rounded-lg mt-1 w-full z-10 hidden"></div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="City" data-vi="Thành Phố">City</span>
                                    <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <input 
                                        type="text" 
                                        name="city" 
                                        id="restaurant_city" 
                                        class="form-control w-full p-3 bg-white" 
                                        placeholder="Hà Nội" 
                                        maxlength="100" 
                                        required
                                        autocomplete="off">
                                    <input type="text" id="city_ghost" class="absolute top-0 left-0 w-full p-3 text-gray-300 bg-transparent pointer-events-none" readonly>
                                    <div id="cityAutocomplete" class="absolute bg-white shadow-lg rounded-lg mt-1 w-full z-10 hidden"></div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Average Price" data-vi="Giá Trung Bình">Average Price</span>
                                </label>
                                <input type="number" name="price_avg" class="form-control w-full p-3 bg-white" placeholder="150000" step="0.01">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Cuisine Type" data-vi="Loại Ẩm Thực">Cuisine Type</span>
                                </label>
                                <div class="relative">
                                    <input type="text" id="cuisine_type_input" name="cuisine_type" class="form-control w-full p-3 bg-white" placeholder="Vietnamese" maxlength="100" autocomplete="off">
                                    <input type="text" id="cuisine_type_ghost" class="absolute top-0 left-0 w-full p-3 text-gray-300 bg-transparent pointer-events-none" readonly>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Rating" data-vi="Đánh Giá">Rating</span>
                                </label>
                                <input type="number" name="rating" class="form-control w-full p-3 bg-white" placeholder="4.5" step="0.01" min="0" max="5">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Address Search" data-vi="Tìm Kiếm Địa Chỉ">Address Search</span>
                                </label>
                                <div class="flex space-x-2">
                                    <div class="relative flex-grow">
                                        <input 
                                            type="text" 
                                            id="restaurant_address_search" 
                                            class="form-control w-full p-3 bg-white pr-10" 
                                            placeholder="Enter full address..." 
                                            data-en-placeholder="Enter full address..." 
                                            data-vi-placeholder="Nhập địa chỉ đầy đủ...">
                                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                            <i class="fas fa-map-marker-alt text-gray-400"></i>
                                        </div>
                                    </div>
                                    <button 
                                        type="button" 
                                        id="geocodeAddressBtn" 
                                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded transition-colors">
                                        <i class="fas fa-search mr-1"></i>
                                        <span data-en="Search" data-vi="Tìm">Search</span>
                                    </button>
                                </div>
                                <div id="map" class="w-full h-40 bg-gray-100 rounded-lg mt-3"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Latitude" data-vi="Vĩ Độ">Latitude</span>
                                </label>
                                <div class="relative">
                                    <input type="number" id="restaurant_latitude" name="latitude" class="form-control w-full p-3 bg-white" placeholder="21.0285" step="0.00000001">
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                        <div id="manualCoordToggle" class="text-blue-500 hover:text-blue-700 cursor-pointer" title="Chỉnh sửa thủ công">
                                            <i class="fas fa-pencil-alt"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Longitude" data-vi="Kinh Độ">Longitude</span>
                                </label>
                                <input type="number" id="restaurant_longitude" name="longitude" class="form-control w-full p-3 bg-white" placeholder="105.8542" step="0.00000001">
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Description" data-vi="Mô Tả">Description</span>
                            </label>
                            <textarea name="description" class="form-control w-full p-3 bg-white" rows="3" placeholder="Delicious Vietnamese restaurant..."></textarea>
                        </div>

                        <!-- Form Actions -->
                        <div class="flex justify-between pt-6 border-t">
                            <button type="button" id="backToChoice" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                <i class="fas fa-arrow-left mr-2"></i>
                                <span data-en="Back" data-vi="Quay Lại">Back</span>
                            </button>
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                                <i class="fas fa-save mr-2"></i>
                                <span data-en="Add Restaurant" data-vi="Thêm Nhà Hàng">Add Restaurant</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Excel Upload Container (Hidden by default) -->
                <div id="excelUploadContainer" class="hidden">
                    <div class="text-center">
                        <!-- Excel Guidance -->
                        <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                            <h4 class="text-blue-800 font-semibold mb-2" data-en="Note About Excel Format" data-vi="Lưu ý về định dạng Excel">Note About Excel Format</h4>
                            <p class="text-blue-700 text-sm" data-en="You don't need to provide city_id, latitude, and longitude in your Excel file. They will be automatically filled based on the city name." data-vi="Bạn không cần cung cấp city_id, latitude và longitude trong tệp Excel. Chúng sẽ được tự động điền dựa trên tên thành phố.">You don't need to provide city_id, latitude, and longitude in your Excel file. They will be automatically filled based on the city name.</p>
                        </div>

                        <!-- Drag & Drop Area -->
                        <div id="excelDropZone" class="border-2 border-dashed border-gray-300 rounded-xl p-12 transition-colors hover:border-blue-400 hover:bg-blue-50">
                            <div class="space-y-4">
                                <div class="text-6xl text-gray-400">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-700" data-en="Drag & Drop Excel File" data-vi="Kéo & Thả File Excel">Drag & Drop Excel File</h3>
                                    <p class="text-gray-500" data-en="or click to browse files" data-vi="hoặc click để chọn file">or click to browse files</p>
                                </div>
                                <div class="text-sm text-gray-400">
                                    <span data-en="Supported formats: .xlsx, .xls" data-vi="Định dạng hỗ trợ: .xlsx, .xls">Supported formats: .xlsx, .xls</span>
                                </div>
                            </div>
                            <input type="file" id="excelFileInput" class="hidden" accept=".xlsx,.xls">
                        </div>

                        <!-- Upload Progress -->
                        <div id="uploadProgress" class="hidden mt-6">
                            <div class="bg-gray-200 rounded-full h-3">
                                <div id="uploadProgressBar" class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p class="text-sm text-gray-600 mt-2" id="uploadProgressText">Uploading...</p>
                        </div>

                        <!-- Upload Actions -->
                        <div class="flex justify-between pt-6 mt-6 border-t">
                            <button type="button" id="backToChoiceFromExcel" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                <i class="fas fa-arrow-left mr-2"></i>
                                <span data-en="Back" data-vi="Quay Lại">Back</span>
                            </button>
                            <button type="button" id="uploadExcelBtn" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-upload mr-2"></i>
                                <span data-en="Upload Excel" data-vi="Upload Excel">Upload Excel</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Add Hotel Modal -->
        <div id="addHotelModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <!-- Modal Header -->
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" data-en="Add New Hotel" data-vi="Thêm Khách Sạn Mới">Add New Hotel</h2>
                        <p class="text-gray-600 mt-1" data-en="Choose how you want to add hotel data" data-vi="Chọn cách bạn muốn thêm dữ liệu khách sạn">Choose how you want to add hotel data</p>
                    </div>
                    <button id="closeAddHotelModal" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Modal Content - Choice Options -->
                <div id="addHotelChoice" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Manual Add Option -->
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 border-2 border-transparent hover:border-blue-300 transition-all cursor-pointer" id="manualAddHotelOption">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-edit text-white text-2xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2" data-en="Manual Entry" data-vi="Nhập Thủ Công">Manual Entry</h3>
                                <p class="text-gray-600 text-sm" data-en="Fill out the hotel information form manually" data-vi="Điền thông tin khách sạn bằng form thủ công">Fill out the hotel information form manually</p>
                            </div>
                        </div>

                        <!-- Excel Upload Option -->
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border-2 border-transparent hover:border-green-300 transition-all cursor-pointer" id="hotelExcelUploadOption">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-file-excel text-white text-2xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2" data-en="Excel Upload" data-vi="Upload Excel">Excel Upload</h3>
                                <p class="text-gray-600 text-sm" data-en="Upload an Excel file with hotel data" data-vi="Upload file Excel với dữ liệu khách sạn">Upload an Excel file with hotel data</p>
                            </div>
                        </div>
                    </div>

                    <!-- Excel Format Info -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-6">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-yellow-600 mt-1 mr-3"></i>
                            <div>
                                <h4 class="font-semibold text-yellow-800 mb-2" data-en="Excel File Requirements" data-vi="Yêu Cầu File Excel">Excel File Requirements</h4>
                                <p class="text-yellow-700 text-sm mb-2" data-en="Your Excel file must have these columns:" data-vi="File Excel của bạn phải có các cột sau:">Your Excel file must have these columns:</p>
                                <div class="text-xs font-mono bg-yellow-100 p-2 rounded text-yellow-800">
                                    name | city | country | stars | price_per_night | rating | description
                                </div>
                                <p class="text-yellow-700 text-sm mt-2" data-en="Hotel ID will be auto-generated. City ID, latitude, and longitude will be filled automatically." data-vi="Mã khách sạn sẽ được tạo tự động. City ID, vĩ độ và kinh độ sẽ được điền tự động.">Hotel ID will be auto-generated. City ID, latitude, and longitude will be filled automatically.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manual Form Container (Hidden by default) -->
                <div id="hotelManualFormContainer" class="hidden">
                    <form id="addHotelForm" class="space-y-6">
                        <!-- Hotel ID is now auto-generated -->
                        <div class="grid grid-cols-1 md:grid-cols-1 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Hotel Name" data-vi="Tên Khách Sạn">Hotel Name</span>
                                    <span class="text-red-500">*</span>
                                </label>
                                <input type="text" name="name" class="form-control w-full p-3 bg-white" placeholder="The Ritz-Carlton" maxlength="200" required>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="hidden">
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="City ID" data-vi="Mã Thành Phố">City ID</span>
                                </label>
                                <input type="number" name="city_id" id="hotel_city_id" class="form-control w-full p-3 bg-white" placeholder="1">
                                <!-- Thêm hidden input để đảm bảo city_id được submit mà không bắt buộc người dùng nhập -->
                                <input type="hidden" name="city_id_fallback" id="hotel_city_id_fallback" value="0">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Country" data-vi="Quốc Gia">Country</span>
                                    <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <input 
                                        type="text" 
                                        name="country" 
                                        id="hotel_country" 
                                        class="form-control w-full p-3 bg-white" 
                                        placeholder="Japan" 
                                        maxlength="100" 
                                        required
                                        autocomplete="off">
                                    <input type="text" id="country_ghost" class="absolute top-0 left-0 w-full p-3 text-gray-300 bg-transparent pointer-events-none" readonly>
                                    <div id="countryAutocomplete" class="absolute bg-white shadow-lg rounded-lg mt-1 w-full z-10 hidden"></div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="City" data-vi="Thành Phố">City</span>
                                    <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <input 
                                        type="text" 
                                        name="city" 
                                        id="hotel_city" 
                                        class="form-control w-full p-3 bg-white" 
                                        placeholder="Tokyo" 
                                        maxlength="100" 
                                        required
                                        autocomplete="off">
                                    <input type="text" id="city_ghost" class="absolute top-0 left-0 w-full p-3 text-gray-300 bg-transparent pointer-events-none" readonly>
                                    <div id="cityAutocomplete" class="absolute bg-white shadow-lg rounded-lg mt-1 w-full z-10 hidden"></div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Stars" data-vi="Số sao">Stars</span>
                                </label>
                                <input type="number" name="stars" class="form-control w-full p-3 bg-white" placeholder="4" min="1" max="5" step="1">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Price Per Night" data-vi="Giá Một Đêm">Price Per Night</span>
                                </label>
                                <input type="number" name="price_per_night" class="form-control w-full p-3 bg-white" placeholder="325.00" step="0.01">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Rating" data-vi="Đánh Giá">Rating</span>
                                </label>
                                <input type="number" name="rating" class="form-control w-full p-3 bg-white" placeholder="7.6" step="0.1" min="0" max="10">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Address Search" data-vi="Tìm Kiếm Địa Chỉ">Address Search</span>
                                </label>
                                <div class="flex space-x-2">
                                    <div class="relative flex-grow">
                                        <input 
                                            type="text" 
                                            id="hotel_address_search" 
                                            class="form-control w-full p-3 bg-white pr-10" 
                                            placeholder="Enter full address..." 
                                            data-en-placeholder="Enter full address..." 
                                            data-vi-placeholder="Nhập địa chỉ đầy đủ...">
                                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                            <i class="fas fa-map-marker-alt text-gray-400"></i>
                                        </div>
                                    </div>
                                    <button 
                                        type="button" 
                                        id="geocodeAddressBtn" 
                                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded transition-colors">
                                        <i class="fas fa-search mr-1"></i>
                                        <span data-en="Search" data-vi="Tìm">Search</span>
                                    </button>
                                </div>
                                <div id="map" class="w-full h-40 bg-gray-100 rounded-lg mt-3"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Latitude" data-vi="Vĩ Độ">Latitude</span>
                                </label>
                                <div class="relative">
                                    <input type="number" id="hotel_latitude" name="latitude" class="form-control w-full p-3 bg-white" placeholder="35.4073" step="0.00000001">
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                        <div id="hotelManualCoordToggle" class="text-blue-500 hover:text-blue-700 cursor-pointer" title="Chỉnh sửa thủ công">
                                            <i class="fas fa-pencil-alt"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <span data-en="Longitude" data-vi="Kinh Độ">Longitude</span>
                                </label>
                                <input type="number" id="hotel_longitude" name="longitude" class="form-control w-full p-3 bg-white" placeholder="139.8833" step="0.00000001">
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2">
                                <span data-en="Description" data-vi="Mô Tả">Description</span>
                            </label>
                            <textarea name="description" class="form-control w-full p-3 bg-white" rows="3" placeholder="Elegant hotel with excellent amenities..."></textarea>
                        </div>

                        <!-- Form Actions -->
                        <div class="flex justify-between pt-6 border-t">
                            <button type="button" id="backToHotelChoice" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                <i class="fas fa-arrow-left mr-2"></i>
                                <span data-en="Back" data-vi="Quay Lại">Back</span>
                            </button>
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                                <i class="fas fa-save mr-2"></i>
                                <span data-en="Add Hotel" data-vi="Thêm Khách Sạn">Add Hotel</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Excel Upload Container (Hidden by default) -->
                <div id="hotelExcelUploadContainer" class="hidden">
                    <div class="text-center">
                        <!-- Excel Guidance -->
                        <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                            <h4 class="text-blue-800 font-semibold mb-2" data-en="Note About Excel Format" data-vi="Lưu ý về định dạng Excel">Note About Excel Format</h4>
                            <p class="text-blue-700 text-sm" data-en="You don't need to provide city_id, latitude, and longitude in your Excel file. They will be automatically filled based on the city name." data-vi="Bạn không cần cung cấp city_id, latitude và longitude trong tệp Excel. Chúng sẽ được tự động điền dựa trên tên thành phố.">You don't need to provide city_id, latitude, and longitude in your Excel file. They will be automatically filled based on the city name.</p>
                        </div>

                        <!-- Drag & Drop Area -->
                        <div id="hotelExcelDropZone" class="border-2 border-dashed border-gray-300 rounded-xl p-12 transition-colors hover:border-blue-400 hover:bg-blue-50">
                            <div class="space-y-4">
                                <div class="text-6xl text-gray-400">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-700" data-en="Drag & Drop Excel File" data-vi="Kéo & Thả File Excel">Drag & Drop Excel File</h3>
                                    <p class="text-gray-500" data-en="or click to browse files" data-vi="hoặc click để chọn file">or click to browse files</p>
                                </div>
                                <div class="text-sm text-gray-400">
                                    <span data-en="Supported formats: .xlsx, .xls" data-vi="Định dạng hỗ trợ: .xlsx, .xls">Supported formats: .xlsx, .xls</span>
                                </div>
                            </div>
                            <input type="file" id="hotelExcelFileInput" class="hidden" accept=".xlsx,.xls">
                        </div>

                        <!-- Upload Progress -->
                        <div id="uploadProgress" class="hidden mt-6">
                            <div class="bg-gray-200 rounded-full h-3">
                                <div id="uploadProgressBar" class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p class="text-sm text-gray-600 mt-2" id="uploadProgressText">Uploading...</p>
                        </div>

                        <!-- Upload Actions -->
                        <div class="flex justify-between pt-6 mt-6 border-t">
                            <button type="button" id="backToHotelChoiceFromExcel" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                <i class="fas fa-arrow-left mr-2"></i>
                                <span data-en="Back" data-vi="Quay Lại">Back</span>
                            </button>
                            <button type="button" id="uploadHotelExcelBtn" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-upload mr-2"></i>
                                <span data-en="Upload Excel" data-vi="Upload Excel">Upload Excel</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Personalized Tour V2 JavaScript -->
        <script>
        // Personalized Tour V2 functionality
        class PersonalizedTourV2 {
            constructor() {
                this.selectedDepartureCity = null;
                this.selectedDestinationCity = null;
                this.passengerCounts = {
                    adults: 0,
                    children: 0,
                    infants: 0
                };
                this.citiesData = [];
                this.selectedDepartureFlight = null;
                this.selectedReturnFlight = null;
                this.flightData = {
                    departure: [],
                    return: []
                };
                this.airlineLogos = {
                    'Vietnam Airlines': 'https://upload.wikimedia.org/wikipedia/commons/6/6f/Vietnam_Airlines_Logo.svg',
                    'Vietjet Air': 'https://upload.wikimedia.org/wikipedia/commons/f/f3/VietJet_Air_logo.svg',
                    'Bamboo Airways': 'https://upload.wikimedia.org/wikipedia/commons/b/b1/Bamboo_Airways_logo.svg'
                };
                this.initializeEventListeners();
                this.loadCitiesData();
            }

            async loadCitiesData() {
                try {
                    // Show loading state
                    this.showCitiesLoading();
                    
                    // Fetch cities from API
                    const response = await fetch('/api/cities');
                    if (response.ok) {
                        this.citiesData = await response.json();
                        this.populateCitiesDropdowns();
                    } else {
                        console.error('Failed to load cities');
                        this.showCitiesError();
                    }
                } catch (error) {
                    console.error('Error loading cities:', error);
                    // Use mock data as fallback
                    this.citiesData = this.getMockCitiesData();
                    this.populateCitiesDropdowns();
                }
            }

            getMockCitiesData() {
                return [
                    { city_id: 1392685764, name: "Tokyo", country: "Japan" },
                    { city_id: 1580578845, name: "Ho Chi Minh", country: "Vietnam" },
                    { city_id: 1566083171, name: "Hanoi", country: "Vietnam" },
                    { city_id: 1702341327, name: "Singapore", country: "Singapore" },
                    { city_id: 1024949724, name: "Luanda", country: "Angola" },
                    { city_id: 1818253931, name: "Da Nang", country: "Vietnam" },
                    { city_id: 1124279679, name: "Bangkok", country: "Thailand" },
                    { city_id: 2147483647, name: "Seoul", country: "South Korea" },
                    { city_id: 1987654321, name: "New York", country: "USA" },
                    { city_id: 1234567890, name: "Paris", country: "France" }
                ];
            }

            showCitiesLoading() {
                const loadingHtml = `
                    <div class="p-4 text-center text-gray-500">
                        <i class="fas fa-spinner fa-spin mr-2"></i>
                        <span data-en="Loading cities..." data-vi="Đang tải thành phố...">Loading cities...</span>
                    </div>
                `;
                const departureList = document.getElementById('departureCitiesList');
                const destinationList = document.getElementById('destinationCitiesList');
                if (departureList) departureList.innerHTML = loadingHtml;
                if (destinationList) destinationList.innerHTML = loadingHtml;
            }

            showCitiesError() {
                const errorHtml = `
                    <div class="p-4 text-center text-red-500">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <span data-en="Failed to load cities" data-vi="Không thể tải thành phố">Failed to load cities</span>
                    </div>
                `;
                const departureList = document.getElementById('departureCitiesList');
                const destinationList = document.getElementById('destinationCitiesList');
                if (departureList) departureList.innerHTML = errorHtml;
                if (destinationList) destinationList.innerHTML = errorHtml;
            }

            populateCitiesDropdowns() {
                this.populateCitiesList('departure', this.citiesData);
                this.populateCitiesList('destination', this.citiesData);
            }

            populateCitiesList(type, cities) {
                const container = document.getElementById(`${type}CitiesList`);
                if (!container) return;
                
                const html = cities.map(city => `
                    <button type="button" class="city-option w-full text-left px-4 py-3 hover:bg-blue-50 transition duration-200 border-b border-gray-100 last:border-b-0" 
                            data-city-id="${city.city_id}" data-city-name="${city.name}" data-country="${city.country}" data-type="${type}">
                        <div class="font-medium text-gray-800">${city.name}</div>
                        <div class="text-sm text-gray-500">${city.country}</div>
                    </button>
                `).join('');
                
                container.innerHTML = html;
            }

            filterCities(query, type) {
                const filtered = this.citiesData.filter(city => 
                    city.name.toLowerCase().includes(query.toLowerCase()) ||
                    city.country.toLowerCase().includes(query.toLowerCase())
                );
                this.populateCitiesList(type, filtered);
            }

            initializeEventListeners() {
                // Departure dropdown
                const departureBtn = document.getElementById('departureDropdownBtn');
                if (departureBtn) {
                    departureBtn.addEventListener('click', () => {
                        this.toggleDropdown('departure');
                    });
                }

                // Destination dropdown
                const destinationBtn = document.getElementById('destinationDropdownBtn');
                if (destinationBtn) {
                    destinationBtn.addEventListener('click', () => {
                        this.toggleDropdown('destination');
                    });
                }

                // Passengers dropdown
                const passengersBtn = document.getElementById('passengersDropdownBtn');
                if (passengersBtn) {
                    passengersBtn.addEventListener('click', () => {
                        this.toggleDropdown('passengers');
                    });
                }

                // Search functionality
                const departureSearch = document.getElementById('departureSearch');
                if (departureSearch) {
                    departureSearch.addEventListener('input', (e) => {
                        this.filterCities(e.target.value, 'departure');
                    });
                }

                const destinationSearch = document.getElementById('destinationSearch');
                if (destinationSearch) {
                    destinationSearch.addEventListener('input', (e) => {
                        this.filterCities(e.target.value, 'destination');
                    });
                }

                // Passenger counter buttons
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.passenger-btn-plus')) {
                        const type = e.target.closest('.passenger-btn-plus').dataset.type;
                        this.updatePassengerCount(type, 1);
                    }
                    
                    if (e.target.closest('.passenger-btn-minus')) {
                        const type = e.target.closest('.passenger-btn-minus').dataset.type;
                        this.updatePassengerCount(type, -1);
                    }

                    if (e.target.closest('.city-option')) {
                        const cityBtn = e.target.closest('.city-option');
                        this.selectCity(cityBtn);
                    }
                });

                // Passengers Done button
                const passengersDoneBtn = document.getElementById('passengersDoneBtn');
                if (passengersDoneBtn) {
                    passengersDoneBtn.addEventListener('click', () => {
                        this.closeDropdown('passengers');
                    });
                }

                // Continue button
                const continueBtn = document.getElementById('continueToStep2Btn');
                if (continueBtn) {
                    continueBtn.addEventListener('click', () => {
                        this.validateAndContinue();
                    });
                }

                // Flight booking event listeners
                this.initializeFlightBookingListeners();

                // Close dropdowns when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.relative')) {
                        this.closeAllDropdowns();
                    }
                });

                // Initialize date range picker
                this.initializeDateRangePicker();
            }

            initializeDateRangePicker() {
                this.currentDate = new Date();
                this.selectedDepartureDate = null;
                this.selectedArrivalDate = null;
                this.isSelectingDeparture = true;
                
                // Event listeners
                const dateRangeBtn = document.getElementById('dateRangeBtn');
                const prevMonthBtn = document.getElementById('prevMonthBtn');
                const nextMonthBtn = document.getElementById('nextMonthBtn');
                const clearDatesBtn = document.getElementById('clearDatesBtn');
                const applyDatesBtn = document.getElementById('applyDatesBtn');
                
                if (dateRangeBtn) {
                    dateRangeBtn.addEventListener('click', () => {
                        this.toggleDateRangeCalendar();
                    });
                }
                
                if (prevMonthBtn) {
                    prevMonthBtn.addEventListener('click', () => {
                        this.navigateMonth(-1);
                    });
                }
                
                if (nextMonthBtn) {
                    nextMonthBtn.addEventListener('click', () => {
                        this.navigateMonth(1);
                    });
                }
                
                if (clearDatesBtn) {
                    clearDatesBtn.addEventListener('click', () => {
                        this.clearSelectedDates();
                    });
                }
                
                if (applyDatesBtn) {
                    applyDatesBtn.addEventListener('click', () => {
                        this.applySelectedDates();
                    });
                }
                
                // Close calendar when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#dateRangeBtn') && !e.target.closest('#dateRangeCalendar')) {
                        this.closeDateRangeCalendar();
                    }
                });
                
                // Initialize calendar
                this.renderCalendar();
            }
            
            toggleDateRangeCalendar() {
                const calendar = document.getElementById('dateRangeCalendar');
                if (calendar) {
                    calendar.classList.toggle('hidden');
                    if (!calendar.classList.contains('hidden')) {
                        this.renderCalendar();
                    }
                }
            }
            
            closeDateRangeCalendar() {
                const calendar = document.getElementById('dateRangeCalendar');
                if (calendar) {
                    calendar.classList.add('hidden');
                }
            }
            
            navigateMonth(direction) {
                this.currentDate.setMonth(this.currentDate.getMonth() + direction);
                this.renderCalendar();
            }
            
            renderCalendar() {
                const monthYearEl = document.getElementById('currentMonthYear');
                const calendarDays = document.getElementById('calendarDays');
                
                if (!monthYearEl || !calendarDays) return;
                
                // Update month/year display
                const months = [
                    'January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'
                ];
                monthYearEl.textContent = `${months[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;
                
                // Clear previous days
                calendarDays.innerHTML = '';
                
                // Get first day of month and number of days
                const firstDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1);
                const lastDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0);
                const today = new Date();
                
                // Add empty cells for days before first day of month
                for (let i = 0; i < firstDay.getDay(); i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'w-10 h-10';
                    calendarDays.appendChild(emptyDay);
                }
                
                // Add days of month
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const dayEl = document.createElement('button');
                    const currentDayDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), day);
                    
                    dayEl.type = 'button';
                    dayEl.className = 'w-8 h-8 rounded text-xs hover:bg-blue-100 transition-colors duration-200';
                    dayEl.textContent = day;
                    
                    // Disable past dates (create a proper comparison date)
                    const todayComparison = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                    if (currentDayDate < todayComparison) {
                        dayEl.disabled = true;
                        dayEl.className += ' text-gray-300 cursor-not-allowed';
                    } else {
                        dayEl.className += ' text-gray-700 hover:bg-blue-100';
                        
                        // Highlight selected dates
                        const dateStr = this.formatDate(currentDayDate);
                        if (this.selectedDepartureDate && dateStr === this.formatDate(this.selectedDepartureDate)) {
                            dayEl.className += ' bg-blue-600 text-white font-semibold';
                        } else if (this.selectedArrivalDate && dateStr === this.formatDate(this.selectedArrivalDate)) {
                            dayEl.className += ' bg-blue-600 text-white font-semibold';
                        } else if (this.selectedDepartureDate && this.selectedArrivalDate && 
                                 currentDayDate > this.selectedDepartureDate && currentDayDate < this.selectedArrivalDate) {
                            dayEl.className += ' bg-blue-100 text-blue-800';
                        }
                        
                        // Add click handler
                        dayEl.addEventListener('click', () => {
                            this.selectDate(currentDayDate);
                        });
                    }
                    
                    calendarDays.appendChild(dayEl);
                }
            }
            
            selectDate(date) {
                if (this.isSelectingDeparture || !this.selectedDepartureDate) {
                    // First click - select departure date
                    this.selectedDepartureDate = new Date(date);
                    this.selectedArrivalDate = null;
                    this.isSelectingDeparture = false;
                    
                    // Update display immediately for first date
                    this.updateDateDisplay();
                } else {
                    // Second click - select arrival date
                    if (date < this.selectedDepartureDate) {
                        // If selected date is before departure, make it new departure
                        this.selectedDepartureDate = new Date(date);
                        this.selectedArrivalDate = null;
                    } else if (date.getTime() === this.selectedDepartureDate.getTime()) {
                        // Same day selected - make it both departure and arrival (same day trip)
                        this.selectedArrivalDate = new Date(date);
                    } else {
                        // Valid arrival date
                        this.selectedArrivalDate = new Date(date);
                    }
                    
                    // Update display immediately for second date
                    this.updateDateDisplay();
                }
                
                // Update apply button state
                const applyBtn = document.getElementById('applyDatesBtn');
                if (applyBtn) {
                    applyBtn.disabled = !this.selectedDepartureDate || !this.selectedArrivalDate;
                }
                
                // Re-render calendar to show updated selection (do not auto-close)
                this.renderCalendar();
            }
            
            clearSelectedDates() {
                this.selectedDepartureDate = null;
                this.selectedArrivalDate = null;
                this.isSelectingDeparture = true;
                
                // Update apply button state
                const applyBtn = document.getElementById('applyDatesBtn');
                if (applyBtn) {
                    applyBtn.disabled = true;
                }
                
                // Update display using the new method
                this.updateDateDisplay();
                
                // Clear hidden inputs
                const departureInput = document.getElementById('v2DepartureDate');
                const arrivalInput = document.getElementById('v2ArrivalDate');
                if (departureInput) departureInput.value = '';
                if (arrivalInput) arrivalInput.value = '';
                
                this.renderCalendar();
            }
            
            applySelectedDates() {
                if (!this.selectedDepartureDate || !this.selectedArrivalDate) return;
                
                // Update hidden inputs
                const departureInput = document.getElementById('v2DepartureDate');
                const arrivalInput = document.getElementById('v2ArrivalDate');
                
                if (departureInput) {
                    departureInput.value = this.formatDateForInput(this.selectedDepartureDate);
                }
                if (arrivalInput) {
                    arrivalInput.value = this.formatDateForInput(this.selectedArrivalDate);
                }
                
                // Update display using the new method
                this.updateDateDisplay();
                
                // Close calendar
                this.closeDateRangeCalendar();
            }
            
            formatDate(date) {
                return date.getFullYear() + '-' + 
                       String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                       String(date.getDate()).padStart(2, '0');
            }
            
            formatDateForInput(date) {
                return this.formatDate(date);
            }
            
            formatDateForDisplay(date) {
                return String(date.getMonth() + 1).padStart(2, '0') + '/' + 
                       String(date.getDate()).padStart(2, '0') + '/' + 
                       date.getFullYear();
            }
            
            updateDateDisplay() {
                const display = document.getElementById('dateRangeDisplay');
                if (!display) return;
                
                if (this.selectedDepartureDate && this.selectedArrivalDate) {
                    // Both dates selected - show range
                    const departureStr = this.formatDateForDisplay(this.selectedDepartureDate);
                    const arrivalStr = this.formatDateForDisplay(this.selectedArrivalDate);
                    display.textContent = `${departureStr} - ${arrivalStr}`;
                    display.className = 'text-gray-900 font-medium';
                } else if (this.selectedDepartureDate) {
                    // Only departure selected - show departure date + hint
                    const departureStr = this.formatDateForDisplay(this.selectedDepartureDate);
                    const currentLang = document.documentElement.lang === 'vi' ? 'vi' : 'en';
                    const arrivalHint = currentLang === 'vi' ? 'Chọn ngày về' : 'Select return date';
                    display.textContent = `${departureStr} - ${arrivalHint}`;
                    display.className = 'text-gray-700';
                } else {
                    // No dates selected - show placeholder
                    const currentLang = document.documentElement.lang === 'vi' ? 'vi' : 'en';
                    const placeholderText = currentLang === 'vi' ? 'Ngày đi - Ngày về' : 'Departure date - Arrival date';
                    display.textContent = placeholderText;
                    display.className = 'text-gray-500';
                }
            }

            toggleDropdown(type) {
                this.closeAllDropdowns();
                const menu = document.getElementById(`${type}DropdownMenu`);
                if (menu) {
                    menu.classList.toggle('hidden');
                    
                    if (type === 'departure' || type === 'destination') {
                        const search = document.getElementById(`${type}Search`);
                        if (search) {
                            setTimeout(() => search.focus(), 100);
                        }
                    }
                }
            }

            closeDropdown(type) {
                const menu = document.getElementById(`${type}DropdownMenu`);
                if (menu) {
                    menu.classList.add('hidden');
                }
            }

            closeAllDropdowns() {
                ['departure', 'destination', 'passengers'].forEach(type => {
                    this.closeDropdown(type);
                });
            }

            selectCity(cityBtn) {
                const cityId = cityBtn.dataset.cityId;
                const cityName = cityBtn.dataset.cityName;
                const country = cityBtn.dataset.country;
                const type = cityBtn.dataset.type;

                if (type === 'departure') {
                    this.selectedDepartureCity = { city_id: cityId, name: cityName, country: country };
                    const selectedSpan = document.getElementById('departureSelected');
                    if (selectedSpan) {
                        selectedSpan.textContent = `${cityName}, ${country}`;
                        selectedSpan.classList.remove('text-gray-500');
                        selectedSpan.classList.add('text-gray-800');
                    }
                } else if (type === 'destination') {
                    this.selectedDestinationCity = { city_id: cityId, name: cityName, country: country };
                    const selectedSpan = document.getElementById('destinationSelected');
                    if (selectedSpan) {
                        selectedSpan.textContent = `${cityName}, ${country}`;
                        selectedSpan.classList.remove('text-gray-500');
                        selectedSpan.classList.add('text-gray-800');
                        // Store country for daily preferences
                        selectedSpan.setAttribute('data-country', country);
                    }
                }

                this.closeDropdown(type);
            }

            updatePassengerCount(type, delta) {
                const currentCount = this.passengerCounts[type];
                const newCount = Math.max(0, currentCount + delta);
                
                // Set maximum limits
                const maxLimits = { adults: 9, children: 9, infants: 9 };
                if (newCount <= maxLimits[type]) {
                    this.passengerCounts[type] = newCount;
                    const countSpan = document.getElementById(`${type}Count`);
                    if (countSpan) {
                        countSpan.textContent = newCount;
                    }
                    this.updatePassengersSummary();
                }
            }

            updatePassengersSummary() {
                const { adults, children, infants } = this.passengerCounts;
                let summary = '';
                
                if (adults > 0) summary += `${adults} Adult${adults > 1 ? 's' : ''}`;
                if (children > 0) summary += `${summary ? ', ' : ''}${children} Child${children > 1 ? 'ren' : ''}`;
                if (infants > 0) summary += `${summary ? ', ' : ''}${infants} Infant${infants > 1 ? 's' : ''}`;
                
                // If no passengers selected, show default text
                if (adults === 0 && children === 0 && infants === 0) {
                    summary = '0 Passengers';
                }
                
                const selectedSpan = document.getElementById('passengersSelected');
                if (selectedSpan) {
                    selectedSpan.textContent = summary;
                }
            }

            validateAndContinue() {
                const errors = [];

                // Check required fields
                if (!this.selectedDepartureCity) {
                    errors.push('Please select a departure city');
                }
                
                if (!this.selectedDestinationCity) {
                    errors.push('Please select a destination city');
                }
                
                // Check date range selection
                if (!this.selectedDepartureDate || !this.selectedArrivalDate) {
                    errors.push('Please select travel dates (departure and arrival)');
                }
                
                const budget = document.getElementById('v2Budget');
                if (!budget || !budget.value || budget.value < 100) {
                    errors.push('Please enter a budget (minimum $100)');
                }

                if (errors.length > 0) {
                    alert('Please fix the following errors:\\n' + errors.join('\\n'));
                    return;
                }

                // Store form data globally for later use
                window.tourFormData = {
                    departure: this.selectedDepartureCity,
                    destination: this.selectedDestinationCity,
                    departureDate: this.selectedDepartureDate ? this.formatDateForInput(this.selectedDepartureDate) : null,
                    arrivalDate: this.selectedArrivalDate ? this.formatDateForInput(this.selectedArrivalDate) : null,
                    passengers: this.passengerCounts,
                    budget: budget ? budget.value : null
                };

                // Also store in hidden inputs for backwards compatibility
                const departureInput = document.getElementById('v2DepartureDate');
                const arrivalInput = document.getElementById('v2ArrivalDate');
                
                if (departureInput && window.tourFormData.departureDate) {
                    departureInput.value = window.tourFormData.departureDate;
                }
                if (arrivalInput && window.tourFormData.arrivalDate) {
                    arrivalInput.value = window.tourFormData.arrivalDate;
                }

                // Show flight booking section
                this.showFlightBookingSection();
                console.log('Form Data stored:', window.tourFormData);
            }

            // Flight Booking Methods
            initializeFlightBookingListeners() {
                // Collapse buttons for departure and return flights
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.collapse-list-flight')) {
                        const button = e.target.closest('.collapse-list-flight');
                        const isDeparture = button.querySelector('.departure-chevron');
                        const isReturn = button.querySelector('.return-chevron');
                        
                        if (isDeparture) {
                            this.toggleFlightsList('departure');
                        } else if (isReturn) {
                            this.toggleFlightsList('return');
                        }
                    }
                });

                // Summary collapse button
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.collapse-preview__header')) {
                        this.toggleSummaryCollapse();
                    }
                });
            }

            showFlightBookingSection() {
                const flightSection = document.getElementById('flightBookingSection');
                if (flightSection) {
                    flightSection.classList.remove('hidden');
                    
                    // Update flight routes
                    this.updateFlightRoutes();
                    
                    // Generate flight data
                    this.generateFlightData();
                    
                    // Scroll to flight section
                    flightSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }

            updateFlightRoutes() {
                const departureRoute = document.getElementById('departureFlightRoute');
                const returnRoute = document.getElementById('returnFlightRoute');
                
                if (departureRoute && this.selectedDepartureCity && this.selectedDestinationCity) {
                    departureRoute.textContent = `${this.selectedDepartureCity.name} (${this.getAirportCode(this.selectedDepartureCity.name)}) > ${this.selectedDestinationCity.name} (${this.getAirportCode(this.selectedDestinationCity.name)})`;
                }
                
                if (returnRoute && this.selectedDepartureCity && this.selectedDestinationCity) {
                    returnRoute.textContent = `${this.selectedDestinationCity.name} (${this.getAirportCode(this.selectedDestinationCity.name)}) > ${this.selectedDepartureCity.name} (${this.getAirportCode(this.selectedDepartureCity.name)})`;
                }
            }

            getAirportCode(cityName) {
                const airportCodes = {
                    'Ho Chi Minh': 'SGN',
                    'Hanoi': 'HAN',
                    'Da Nang': 'DAD',
                    'Tokyo': 'NRT',
                    'Singapore': 'SIN',
                    'Bangkok': 'BKK',
                    'Seoul': 'ICN',
                    'New York': 'JFK',
                    'Paris': 'CDG'
                };
                return airportCodes[cityName] || cityName.substring(0, 3).toUpperCase();
            }

            generateFlightData() {
                const airlines = ['Vietnam Airlines', 'Vietjet Air', 'Bamboo Airways'];
                
                // Generate departure flights (3-5 flights)
                const departureCount = Math.floor(Math.random() * 3) + 3;
                this.flightData.departure = [];
                for (let i = 0; i < departureCount; i++) {
                    this.flightData.departure.push(this.generateRandomFlight('departure', airlines[i % airlines.length]));
                }
                
                // Generate return flights (3-5 flights)
                const returnCount = Math.floor(Math.random() * 3) + 3;
                this.flightData.return = [];
                for (let i = 0; i < returnCount; i++) {
                    this.flightData.return.push(this.generateRandomFlight('return', airlines[i % airlines.length]));
                }
                
                this.renderFlightCards();
            }

            generateRandomFlight(type, airline) {
                // Generate random time between 6:00 and 18:00
                const startHour = Math.floor(Math.random() * 12) + 6;
                const startMinute = Math.floor(Math.random() * 4) * 15; // 0, 15, 30, 45
                const departureTime = `${startHour.toString().padStart(2, '0')}:${startMinute.toString().padStart(2, '0')}`;
                
                // Add 2h15m for arrival time
                const arrivalDate = new Date();
                arrivalDate.setHours(startHour);
                arrivalDate.setMinutes(startMinute + 135); // 2h15m
                const arrivalTime = `${arrivalDate.getHours().toString().padStart(2, '0')}:${arrivalDate.getMinutes().toString().padStart(2, '0')}`;
                
                // Generate random price between $70-150
                const priceUSD = Math.floor(Math.random() * 80) + 70;
                const priceVND = priceUSD * 24500; // Approximate VND conversion
                
                return {
                    id: `flight_${type}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    airline: airline,
                    logo: this.airlineLogos[airline] || '',
                    departureTime: departureTime,
                    arrivalTime: arrivalTime,
                    duration: '2h15m',
                    direct: true,
                    priceUSD: priceUSD,
                    priceVND: priceVND,
                    type: type
                };
            }

            renderFlightCards() {
                this.renderFlightList('departure');
                this.renderFlightList('return');
            }

            renderFlightList(type) {
                const container = document.getElementById(`${type}FlightsList`);
                if (!container) return;
                
                const flights = this.flightData[type];
                container.innerHTML = '';
                
                flights.forEach(flight => {
                    const flightCard = this.createFlightCard(flight);
                    container.appendChild(flightCard);
                });
            }

            createFlightCard(flight) {
                const card = document.createElement('div');
                card.className = 'flight-card--wrapper normal-flight bg-gradient-to-br from-white to-blue-50/30 rounded-xl shadow-lg border border-blue-100/50 hover:shadow-xl hover:scale-[1.02] transition-all duration-300';
                card.innerHTML = `
                    <div class="flight-card__content p-4">
                        <div class="flight-card__content--left flex-1">
                            <div class="flight-card__content--left--flight-brand flex items-center mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl flex items-center justify-center mr-3 shadow-md">
                                    <img src="${flight.logo}" alt="${flight.airline}" class="w-10 h-10 object-contain rounded-lg airline-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                                    <span class="text-xs font-bold text-blue-600 hidden">${flight.airline.charAt(0)}</span>
                                </div>
                                <p class="font-semibold text-gray-800">${flight.airline}</p>
                            </div>
                            <div class="flight-card__content--left--content">
                                <div class="flight-card__content--left--info">
                                    <div class="flight-info flex items-center justify-between">
                                        <div class="flight-info--col flight-info--col__left text-center">
                                            <p class="col-time text-xl font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent">${flight.departureTime}</p>
                                            <p class="col-airport text-sm text-blue-600 font-medium">${this.getAirportCode(this.selectedDepartureCity.name)}</p>
                                        </div>
                                        <div class="flight-info--mid mid-line-wrapper flex-1 mx-6">
                                            <span class="col-place col-place--time text-sm text-blue-600 font-medium block text-center">${flight.duration}</span>
                                            <div class="flight-info--row preview relative">
                                                <div class="row--transport">
                                                    <div class="h-1 bg-gradient-to-r from-blue-400 to-indigo-400 relative rounded-full">
                                                        <div class="absolute left-0 w-3 h-3 bg-blue-500 rounded-full -top-1 shadow-md"></div>
                                                        <div class="absolute right-0 w-3 h-3 bg-indigo-500 rounded-full -top-1 shadow-md"></div>
                                                        <i class="fas fa-plane absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-sm bg-blue-500 rounded-full p-1 shadow-lg"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <span class="col-place col-place--stop text-sm text-blue-600 font-medium block text-center mt-1" data-en="Direct" data-vi="Bay thẳng">Direct</span>
                                        </div>
                                        <div class="flight-info--col flight-info--col__right text-center">
                                            <p class="col-time text-xl font-bold bg-gradient-to-r from-indigo-700 to-purple-700 bg-clip-text text-transparent">${flight.arrivalTime}</p>
                                            <p class="col-airport text-sm text-indigo-600 font-medium">${this.getAirportCode(this.selectedDestinationCity.name)}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="flight-card__content--left--options flex space-x-2 mt-4">
                                    <button class="details-btn bg-blue-50 text-blue-700 px-4 py-2 rounded-lg text-sm hover:bg-blue-100 transition-colors border border-blue-200" data-flight-id="${flight.id}">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        <span data-en="Details" data-vi="Chi tiết">Details</span>
                                    </button>
                                    <button class="fare-btn bg-green-50 text-green-700 px-4 py-2 rounded-lg text-sm hover:bg-green-100 transition-colors border border-green-200">
                                        <i class="fas fa-dollar-sign mr-1"></i>
                                        <span data-en="Fare" data-vi="Giá vé">Fare</span>
                                    </button>
                                    <button class="baggage-btn bg-orange-50 text-orange-700 px-4 py-2 rounded-lg text-sm hover:bg-orange-100 transition-colors border border-orange-200">
                                        <i class="fas fa-suitcase-rolling mr-1"></i>
                                        <span data-en="Baggage" data-vi="Hành lý">Baggage</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="flight-card--dot-line w-px bg-gradient-to-b from-blue-200 via-blue-300 to-blue-200 mx-4"></div>
                        <div class="flight-card__content--right">
                            <div class="flight-card__content--right--price text-center bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100">
                                <p class="mb-3">
                                    <span class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">$${Math.round(flight.priceVND / 25000)}</span>
                                    <span class="text-sm text-blue-600 block font-medium" data-en="/ Guest" data-vi="/ Khách">/ Guest</span>
                                </p>
                                <button class="select-flight-btn bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 font-medium shadow-lg hover:shadow-xl transform hover:scale-105" 
                                        data-flight-id="${flight.id}" data-flight-type="${flight.type}">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    <span data-en="Select" data-vi="Chọn">Select</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Details Modal (Hidden initially) -->
                    <div class="flight-details-modal hidden mt-4 p-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-t border-blue-200 rounded-b-xl">
                        <h5 class="font-bold mb-3 text-blue-800 flex items-center" data-en="Flight Details" data-vi="Chi tiết chuyến bay">
                            <i class="fas fa-plane mr-2 text-blue-600"></i>
                            Flight Details
                        </h5>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-gray-300">
                                        <th class="text-left py-2 font-semibold" data-en="Passenger Type" data-vi="Hành khách">Passenger Type</th>
                                        <th class="text-left py-2 font-semibold" data-en="Base Price" data-vi="Giá cơ bản">Base Price</th>
                                        <th class="text-left py-2 font-semibold" data-en="Surcharge" data-vi="Phụ thu">Surcharge</th>
                                        <th class="text-left py-2 font-semibold" data-en="Total" data-vi="Thành tiền">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b border-gray-200">
                                        <td class="py-2" data-en="Adult" data-vi="Người lớn">Adult</td>
                                        <td class="py-2">$${Math.round(flight.priceVND * 0.75 / 25000)}</td>
                                        <td class="py-2">$${Math.round(flight.priceVND * 0.25 / 25000)}</td>
                                        <td class="py-2 font-semibold">$${Math.round(flight.priceVND / 25000)}</td>
                                    </tr>
                                    <tr class="border-b border-gray-200">
                                        <td class="py-2" data-en="Child" data-vi="Trẻ em">Trẻ em</td>
                                        <td class="py-2">$${Math.round(flight.priceVND * 0.65 / 25000)}</td>
                                        <td class="py-2">$${Math.round(flight.priceVND * 0.25 / 25000)}</td>
                                        <td class="py-2 font-semibold">$${Math.round(flight.priceVND * 0.9 / 25000)}</td>
                                    </tr>
                                    <tr>
                                        <td class="py-2" data-en="Infant" data-vi="Em bé">Em bé</td>
                                        <td class="py-2">$0</td>
                                        <td class="py-2">$${Math.round(flight.priceVND * 0.1 / 25000)}</td>
                                        <td class="py-2 font-semibold">$${Math.round(flight.priceVND * 0.1 / 25000)}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                this.addFlightCardListeners(card, flight);
                
                return card;
            }

            addFlightCardListeners(card, flight) {
                // Details button
                const detailsBtn = card.querySelector('.details-btn');
                const detailsModal = card.querySelector('.flight-details-modal');
                detailsBtn.addEventListener('click', () => {
                    detailsModal.classList.toggle('hidden');
                });
                
                // Select flight button
                const selectBtn = card.querySelector('.select-flight-btn');
                selectBtn.addEventListener('click', () => {
                    this.selectFlight(flight);
                });
            }

            selectFlight(flight) {
                if (flight.type === 'departure') {
                    this.selectedDepartureFlight = flight;
                    this.updateSelectedFlightDisplay('departure', flight);
                } else {
                    this.selectedReturnFlight = flight;
                    this.updateSelectedFlightDisplay('return', flight);
                }
                
                this.updateOrderSummary();
                this.updateConfirmButton();
            }

            updateSelectedFlightDisplay(type, flight) {
                const container = document.getElementById(`selected${type.charAt(0).toUpperCase() + type.slice(1)}Flight`);
                if (container) {
                    container.classList.remove('hidden');
                    
                    const airlineElement = container.querySelector(`#${type}FlightAirline`);
                    const timeElement = container.querySelector(`#${type}FlightTime`);
                    
                    if (airlineElement) airlineElement.textContent = flight.airline;
                    if (timeElement) timeElement.textContent = `${flight.departureTime} - ${flight.arrivalTime}`;
                }
            }

            updateOrderSummary() {
                let totalPrice = 0;
                
                if (this.selectedDepartureFlight) {
                    totalPrice += this.selectedDepartureFlight.priceVND;
                }
                
                if (this.selectedReturnFlight) {
                    totalPrice += this.selectedReturnFlight.priceVND;
                }
                
                const totalElement = document.getElementById('totalFlightPrice');
                if (totalElement) {
                    totalElement.textContent = totalPrice > 0 ? `$${Math.round(totalPrice / 25000)}` : '$0';
                }
            }

            updateConfirmButton() {
                const confirmBtn = document.getElementById('confirmFlightBookingBtn');
                if (confirmBtn) {
                    if (this.selectedDepartureFlight && this.selectedReturnFlight) {
                        confirmBtn.disabled = false;
                        confirmBtn.className = 'btn-confirm-pick btn-primary w-full py-3 bg-blue-600 text-white rounded-lg font-medium transition-colors hover:bg-blue-700 cursor-pointer';
                        confirmBtn.innerHTML = '<span data-en="Confirm Booking" data-vi="Xác nhận đặt vé">Confirm Booking</span>';
                        
                        confirmBtn.addEventListener('click', () => {
                            this.confirmBooking();
                        });
                    } else {
                        confirmBtn.disabled = true;
                        confirmBtn.className = 'btn-confirm-pick btn-primary w-full py-3 bg-gray-400 text-white rounded-lg font-medium transition-colors cursor-not-allowed';
                        confirmBtn.innerHTML = '<span data-en="Select Flights" data-vi="Chọn vé">Select Flights</span>';
                    }
                }
            }

            confirmBooking() {
                if (this.selectedDepartureFlight && this.selectedReturnFlight) {
                    // Log booking details
                    console.log('Confirmed Booking:', {
                        departure: this.selectedDepartureFlight,
                        return: this.selectedReturnFlight,
                        totalPrice: this.selectedDepartureFlight.priceVND + this.selectedReturnFlight.priceVND
                    });
                    
                    // Initialize daily preferences forms
                    this.initializeDailyPreferenceForms();
                }
            }

            initializeDailyPreferenceForms() {
                // First try to get dates from the stored form data (if available)
                let departureDate, arrivalDate;
                
                // Check if we have the stored form data from previous steps
                if (window.tourFormData && window.tourFormData.departureDate && window.tourFormData.arrivalDate) {
                    departureDate = window.tourFormData.departureDate;
                    arrivalDate = window.tourFormData.arrivalDate;
                    console.log('Using dates from tourFormData:', { departureDate, arrivalDate });
                } else {
                    // Fallback to hidden input values
                    const departureInput = document.getElementById('v2DepartureDate');
                    const arrivalInput = document.getElementById('v2ArrivalDate');
                    
                    departureDate = departureInput ? departureInput.value : '';
                    arrivalDate = arrivalInput ? arrivalInput.value : '';
                    console.log('Using dates from hidden inputs:', { departureDate, arrivalDate });
                }
                
                if (!departureDate || !arrivalDate) {
                    console.error('Missing departure or arrival dates:', { departureDate, arrivalDate });
                    alert('Please select departure and arrival dates first. Go back and fill in the date range.');
                    return;
                }
                
                // Calculate number of days
                const startDate = new Date(departureDate);
                const endDate = new Date(arrivalDate);
                const timeDiff = endDate.getTime() - startDate.getTime();
                const dayCount = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1; // +1 to include both dates
                
                // Get destination city for data loading
                let destinationCountry;
                
                // First try to get from stored form data
                if (window.tourFormData && window.tourFormData.destination && window.tourFormData.destination.country) {
                    destinationCountry = window.tourFormData.destination.country;
                    console.log('Using destination country from tourFormData:', destinationCountry);
                } else {
                    // Fallback to DOM element
                    const destinationBtn = document.getElementById('destinationSelected');
                    destinationCountry = destinationBtn ? destinationBtn.getAttribute('data-country') : null;
                    console.log('Using destination country from DOM:', destinationCountry);
                }
                
                if (!destinationCountry) {
                    console.error('Missing destination country');
                    alert('Please select a destination city first. Go back and choose your destination.');
                    return;
                }
                
                console.log('✅ Initializing daily forms for', dayCount, 'days in', destinationCountry);
                
                // Hide flight booking section and show daily preferences forms
                const flightBookingSection = document.getElementById('flightBookingSection');
                if (flightBookingSection) {
                    flightBookingSection.style.display = 'none';
                }
                
                // Create daily preferences section
                this.createDailyPreferencesSection(dayCount, destinationCountry);
            }

            createDailyPreferencesSection(dayCount, destinationCountry) {
                // Create the main daily preferences container
                let dailyPreferencesSection = document.getElementById('dailyPreferencesSection');
                if (!dailyPreferencesSection) {
                    dailyPreferencesSection = document.createElement('div');
                    dailyPreferencesSection.id = 'dailyPreferencesSection';
                    dailyPreferencesSection.className = 'mt-12';
                    
                    // Find the package-tab container and append
                    const packageTab = document.getElementById('package-tab');
                    if (packageTab) {
                        packageTab.appendChild(dailyPreferencesSection);
                    }
                }
                
                // Create header
                const headerHTML = `
                    <div class="bg-gradient-to-r from-purple-50 via-pink-50 to-indigo-50 rounded-2xl p-8 mb-8 border border-purple-100 shadow-sm">
                        <div class="flex items-center mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 via-pink-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg mr-6">
                                <i class="fas fa-heart text-white text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="text-4xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-indigo-600 bg-clip-text text-transparent mb-2" 
                                    data-en="Daily Preferences" data-vi="Sở Thích Từng Ngày">Daily Preferences</h3>
                                <p class="text-gray-600 text-lg" data-en="Tell us what you like for each day of your journey" 
                                    data-vi="Cho chúng tôi biết sở thích của bạn cho từng ngày">Tell us what you like for each day of your journey</p>
                            </div>
                        </div>
                        
                        <!-- Progress Steps -->
                        <div class="flex items-center justify-between bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex items-center cursor-pointer hover:opacity-80 transition duration-200" id="backToBasicInfoStep">
                                <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">
                                    <i class="fas fa-check text-xs"></i>
                                </div>
                                <span class="text-green-600 font-medium" data-en="Basic Information" data-vi="Thông Tin Cơ Bản">Basic Information</span>
                            </div>
                            <div class="flex-1 h-0.5 bg-purple-200 mx-4"></div>
                            <div class="flex items-center cursor-pointer hover:opacity-80 transition duration-200" id="backToFlightBookingStep">
                                <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">
                                    <i class="fas fa-check text-xs"></i>
                                </div>
                                <span class="text-green-600 font-medium" data-en="Flight Booking" data-vi="Đặt Vé Máy Bay">Flight Booking</span>
                            </div>
                            <div class="flex-1 h-0.5 bg-purple-200 mx-4"></div>
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">3</div>
                                <span class="text-purple-600 font-medium" data-en="Daily Preferences" data-vi="Sở Thích Từng Ngày">Daily Preferences</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Initialize daily forms data
                this.dailyFormsData = {
                    currentDay: 1,
                    totalDays: dayCount,
                    destinationCountry: destinationCountry,
                    preferences: {}
                };
                
                dailyPreferencesSection.innerHTML = headerHTML + `
                    <div id="dailyFormContainer" class="space-y-8">
                        <!-- Daily forms will be generated here -->
                    </div>
                `;
                
                // Generate the first day form
                this.generateDayForm(1, dayCount, destinationCountry);
            }

            generateDayForm(dayNumber, totalDays, destinationCountry) {
                const formContainer = document.getElementById('dailyFormContainer');
                if (!formContainer) return;
                
                const isLastDay = dayNumber === totalDays;
                const currentDate = new Date(document.getElementById('v2DepartureDate').value);
                currentDate.setDate(currentDate.getDate() + dayNumber - 1);
                const dateString = currentDate.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                const formHTML = `
                    <div id="dayForm${dayNumber}" class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8">
                        <div class="mb-8">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg mr-4">
                                        <span class="text-white font-bold text-lg">${dayNumber}</span>
                                    </div>
                                    <div>
                                        <h4 class="text-2xl font-bold text-gray-800" data-en="Day ${dayNumber}" data-vi="Ngày ${dayNumber}">Day ${dayNumber}</h4>
                                        <p class="text-gray-600" data-en="${dateString}" data-vi="${dateString}">${dateString}</p>
                                    </div>
                                </div>
                                <div class="text-sm text-gray-500">
                                    <span data-en="${dayNumber} of ${totalDays} days" data-vi="${dayNumber} / ${totalDays} ngày">${dayNumber} of ${totalDays} days</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 4 Preference Boxes -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <!-- Restaurants Box -->
                            <div class="bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-6 border border-red-100">
                                <div class="flex items-center mb-4">
                                    <div class="w-10 h-10 bg-gradient-to-br from-red-500 to-orange-600 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-utensils text-white"></i>
                                    </div>
                                    <h5 class="text-xl font-bold text-gray-800" data-en="Restaurants" data-vi="Nhà Hàng">Restaurants</h5>
                                </div>
                                <div id="restaurantsDay${dayNumber}" class="space-y-3 min-h-32 max-h-64 overflow-y-auto">
                                    <div class="text-center text-gray-500 py-8">
                                        <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                                        <p data-en="Loading restaurants..." data-vi="Đang tải nhà hàng...">Loading restaurants...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Hotels Box -->
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100">
                                <div class="flex items-center mb-4">
                                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-bed text-white"></i>
                                    </div>
                                    <h5 class="text-xl font-bold text-gray-800" data-en="Hotels" data-vi="Khách Sạn">Hotels</h5>
                                </div>
                                <div id="hotelsDay${dayNumber}" class="space-y-3 min-h-32 max-h-64 overflow-y-auto">
                                    <div class="text-center text-gray-500 py-8">
                                        <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                                        <p data-en="Loading hotels..." data-vi="Đang tải khách sạn...">Loading hotels...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recreation Places Box -->
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-100">
                                <div class="flex items-center mb-4">
                                    <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-map-marker-alt text-white"></i>
                                    </div>
                                    <h5 class="text-xl font-bold text-gray-800" data-en="Recreation Places" data-vi="Địa Điểm Giải Trí">Recreation Places</h5>
                                </div>
                                <div id="activitiesDay${dayNumber}" class="space-y-3 min-h-32 max-h-64 overflow-y-auto">
                                    <div class="text-center text-gray-500 py-8">
                                        <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                                        <p data-en="Loading activities..." data-vi="Đang tải hoạt động...">Loading activities...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Local Transport Box -->
                            <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-6 border border-yellow-100">
                                <div class="flex items-center mb-4">
                                    <div class="w-10 h-10 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-car text-white"></i>
                                    </div>
                                    <h5 class="text-xl font-bold text-gray-800" data-en="Local Transport" data-vi="Phương Tiện Địa Phương">Local Transport</h5>
                                </div>
                                <div id="transportsDay${dayNumber}" class="space-y-3 min-h-32 max-h-64 overflow-y-auto">
                                    <div class="text-center text-gray-500 py-8">
                                        <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                                        <p data-en="Loading transport..." data-vi="Đang tải phương tiện...">Loading transport...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Navigation Buttons -->
                        <div class="flex justify-between items-center pt-6 border-t border-gray-100">
                            <div class="flex space-x-3">
                                <button type="button" id="backToFlightBtn${dayNumber}" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition duration-300 font-medium" ${dayNumber > 1 ? 'style="display: none;"' : ''}>
                                    <i class="fas fa-arrow-left mr-2"></i>
                                    <span data-en="Back to Flight Booking" data-vi="Quay lại Đặt vé">Back to Flight Booking</span>
                                </button>
                                <button type="button" id="previousDay${dayNumber}" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition duration-300 font-medium" ${dayNumber === 1 ? 'style="display: none;"' : ''}>
                                    <i class="fas fa-chevron-left mr-2"></i>
                                    <span data-en="Previous Day" data-vi="Ngày trước">Previous Day</span>
                                </button>
                            </div>
                            
                            <div class="flex-1"></div>
                            
                            <button type="button" id="continueDay${dayNumber}" class="px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:from-purple-700 hover:to-indigo-700 transition duration-300 font-bold shadow-lg">
                                <span data-en="${isLastDay ? 'Generate Tour' : 'Continue'}" data-vi="${isLastDay ? 'Tạo Tour' : 'Tiếp tục'}">${isLastDay ? 'Generate Tour' : 'Continue'}</span>
                                <i class="fas fa-${isLastDay ? 'magic' : 'arrow-right'} ml-2"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                formContainer.innerHTML = formHTML;
                
                // Load data for this day
                this.loadDayPreferences(dayNumber, destinationCountry);
                
                // Setup navigation
                this.setupDayNavigation(dayNumber, totalDays);
            }

            loadDayPreferences(dayNumber, destinationCountry) {
                // Load restaurants, hotels, activities, and transports for the destination country
                Promise.all([
                    this.loadRestaurants(dayNumber, destinationCountry),
                    this.loadHotels(dayNumber, destinationCountry),
                    this.loadActivities(dayNumber, destinationCountry),
                    this.loadTransports(dayNumber, destinationCountry)
                ]).catch(error => {
                    console.error('Error loading day preferences:', error);
                });
            }

            async loadRestaurants(dayNumber, destinationCountry) {
                try {
                    const response = await fetch(`/api/restaurants?country=${encodeURIComponent(destinationCountry)}&limit=20`);
                    const data = await response.json();
                    
                    const container = document.getElementById(`restaurantsDay${dayNumber}`);
                    if (container && data.restaurants && data.restaurants.length > 0) {
                        container.innerHTML = data.restaurants.map(restaurant => `
                            <div class="restaurant-item p-3 bg-white rounded-lg border border-red-100 hover:border-red-300 transition duration-200">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <h6 class="font-semibold text-gray-800 text-sm">${restaurant.name}</h6>
                                        <p class="text-xs text-gray-600">${restaurant.cuisine_type || 'Restaurant'}</p>
                                        <div class="flex items-center mt-1">
                                            <span class="text-xs text-yellow-600">★ ${restaurant.rating || 'N/A'}</span>
                                            <span class="text-xs text-gray-500 ml-2">$${restaurant.price_avg || 'N/A'}</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2 ml-3">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="like-checkbox hidden" data-type="restaurant" data-id="${restaurant.restaurant_id}" data-day="${dayNumber}">
                                            <div class="like-btn w-8 h-8 rounded-full border-2 border-green-300 flex items-center justify-center hover:bg-green-50 transition duration-200">
                                                <i class="fas fa-thumbs-up text-green-500 text-xs"></i>
                                            </div>
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="dislike-checkbox hidden" data-type="restaurant" data-id="${restaurant.restaurant_id}" data-day="${dayNumber}">
                                            <div class="dislike-btn w-8 h-8 rounded-full border-2 border-red-300 flex items-center justify-center hover:bg-red-50 transition duration-200">
                                                <i class="fas fa-thumbs-down text-red-500 text-xs"></i>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                        
                        this.setupLikeDislikeHandlers(container);
                    } else {
                        container.innerHTML = `<div class="text-center text-gray-500 py-4">
                            <p data-en="No restaurants found" data-vi="Không tìm thấy nhà hàng">No restaurants found</p>
                        </div>`;
                    }
                } catch (error) {
                    console.error('Error loading restaurants:', error);
                    const container = document.getElementById(`restaurantsDay${dayNumber}`);
                    if (container) {
                        container.innerHTML = `<div class="text-center text-red-500 py-4">
                            <p data-en="Error loading restaurants" data-vi="Lỗi tải nhà hàng">Error loading restaurants</p>
                        </div>`;
                    }
                }
            }

            async loadHotels(dayNumber, destinationCountry) {
                try {
                    const response = await fetch(`/api/hotels?country=${encodeURIComponent(destinationCountry)}&limit=20`);
                    const data = await response.json();
                    
                    const container = document.getElementById(`hotelsDay${dayNumber}`);
                    if (container && data.hotels && data.hotels.length > 0) {
                        container.innerHTML = data.hotels.map(hotel => `
                            <div class="hotel-item p-3 bg-white rounded-lg border border-blue-100 hover:border-blue-300 transition duration-200">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <h6 class="font-semibold text-gray-800 text-sm">${hotel.name}</h6>
                                        <div class="flex items-center mt-1">
                                            <span class="text-xs text-yellow-600">★ ${hotel.rating || 'N/A'}</span>
                                            <span class="text-xs text-blue-600 ml-2">${hotel.stars || 0}⭐</span>
                                            <span class="text-xs text-gray-500 ml-2">$${hotel.price_per_night || 'N/A'}/night</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2 ml-3">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="like-checkbox hidden" data-type="hotel" data-id="${hotel.hotel_id}" data-day="${dayNumber}">
                                            <div class="like-btn w-8 h-8 rounded-full border-2 border-green-300 flex items-center justify-center hover:bg-green-50 transition duration-200">
                                                <i class="fas fa-thumbs-up text-green-500 text-xs"></i>
                                            </div>
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="dislike-checkbox hidden" data-type="hotel" data-id="${hotel.hotel_id}" data-day="${dayNumber}">
                                            <div class="dislike-btn w-8 h-8 rounded-full border-2 border-red-300 flex items-center justify-center hover:bg-red-50 transition duration-200">
                                                <i class="fas fa-thumbs-down text-red-500 text-xs"></i>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                        
                        this.setupLikeDislikeHandlers(container);
                    } else {
                        container.innerHTML = `<div class="text-center text-gray-500 py-4">
                            <p data-en="No hotels found" data-vi="Không tìm thấy khách sạn">No hotels found</p>
                        </div>`;
                    }
                } catch (error) {
                    console.error('Error loading hotels:', error);
                    const container = document.getElementById(`hotelsDay${dayNumber}`);
                    if (container) {
                        container.innerHTML = `<div class="text-center text-red-500 py-4">
                            <p data-en="Error loading hotels" data-vi="Lỗi tải khách sạn">Error loading hotels</p>
                        </div>`;
                    }
                }
            }

            async loadActivities(dayNumber, destinationCountry) {
                try {
                    const response = await fetch(`/api/activities?country=${encodeURIComponent(destinationCountry)}&limit=20`);
                    const data = await response.json();
                    
                    const container = document.getElementById(`activitiesDay${dayNumber}`);
                    if (container && data.activities && data.activities.length > 0) {
                        container.innerHTML = data.activities.map(activity => `
                            <div class="activity-item p-3 bg-white rounded-lg border border-green-100 hover:border-green-300 transition duration-200">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <h6 class="font-semibold text-gray-800 text-sm">${activity.name}</h6>
                                        <p class="text-xs text-gray-600">${activity.type || 'Activity'}</p>
                                        <div class="flex items-center mt-1">
                                            <span class="text-xs text-yellow-600">★ ${activity.rating || 'N/A'}</span>
                                            <span class="text-xs text-gray-500 ml-2">$${activity.price || 'Free'}</span>
                                            <span class="text-xs text-gray-500 ml-2">${activity.duration_hr || 'N/A'}h</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2 ml-3">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="like-checkbox hidden" data-type="activity" data-id="${activity.activity_id}" data-day="${dayNumber}">
                                            <div class="like-btn w-8 h-8 rounded-full border-2 border-green-300 flex items-center justify-center hover:bg-green-50 transition duration-200">
                                                <i class="fas fa-thumbs-up text-green-500 text-xs"></i>
                                            </div>
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="dislike-checkbox hidden" data-type="activity" data-id="${activity.activity_id}" data-day="${dayNumber}">
                                            <div class="dislike-btn w-8 h-8 rounded-full border-2 border-red-300 flex items-center justify-center hover:bg-red-50 transition duration-200">
                                                <i class="fas fa-thumbs-down text-red-500 text-xs"></i>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                        
                        this.setupLikeDislikeHandlers(container);
                    } else {
                        container.innerHTML = `<div class="text-center text-gray-500 py-4">
                            <p data-en="No activities found" data-vi="Không tìm thấy hoạt động">No activities found</p>
                        </div>`;
                    }
                } catch (error) {
                    console.error('Error loading activities:', error);
                    const container = document.getElementById(`activitiesDay${dayNumber}`);
                    if (container) {
                        container.innerHTML = `<div class="text-center text-red-500 py-4">
                            <p data-en="Error loading activities" data-vi="Lỗi tải hoạt động">Error loading activities</p>
                        </div>`;
                    }
                }
            }

            async loadTransports(dayNumber, destinationCountry) {
                try {
                    const response = await fetch(`/api/transports?country=${encodeURIComponent(destinationCountry)}&limit=20`);
                    const data = await response.json();
                    
                    const container = document.getElementById(`transportsDay${dayNumber}`);
                    if (container && data.transports && data.transports.length > 0) {
                        container.innerHTML = data.transports.map(transport => `
                            <div class="transport-item p-3 bg-white rounded-lg border border-yellow-100 hover:border-yellow-300 transition duration-200">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <h6 class="font-semibold text-gray-800 text-sm">${transport.type}</h6>
                                        <div class="flex items-center mt-1">
                                            <span class="text-xs text-yellow-600">★ ${transport.rating || 'N/A'}</span>
                                            <span class="text-xs text-gray-500 ml-2">$${transport.avg_price_per_km || 'N/A'}/km</span>
                                            <span class="text-xs text-gray-500 ml-2">${transport.operating_hours || '24/7'}</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2 ml-3">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="like-checkbox hidden" data-type="transport" data-id="${transport.transport_id}" data-day="${dayNumber}">
                                            <div class="like-btn w-8 h-8 rounded-full border-2 border-green-300 flex items-center justify-center hover:bg-green-50 transition duration-200">
                                                <i class="fas fa-thumbs-up text-green-500 text-xs"></i>
                                            </div>
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" class="dislike-checkbox hidden" data-type="transport" data-id="${transport.transport_id}" data-day="${dayNumber}">
                                            <div class="dislike-btn w-8 h-8 rounded-full border-2 border-red-300 flex items-center justify-center hover:bg-red-50 transition duration-200">
                                                <i class="fas fa-thumbs-down text-red-500 text-xs"></i>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                        
                        this.setupLikeDislikeHandlers(container);
                    } else {
                        container.innerHTML = `<div class="text-center text-gray-500 py-4">
                            <p data-en="No transport found" data-vi="Không tìm thấy phương tiện">No transport found</p>
                        </div>`;
                    }
                } catch (error) {
                    console.error('Error loading transports:', error);
                    const container = document.getElementById(`transportsDay${dayNumber}`);
                    if (container) {
                        container.innerHTML = `<div class="text-center text-red-500 py-4">
                            <p data-en="Error loading transport" data-vi="Lỗi tải phương tiện">Error loading transport</p>
                        </div>`;
                    }
                }
            }

            setupLikeDislikeHandlers(container) {
                const likeCheckboxes = container.querySelectorAll('.like-checkbox');
                const dislikeCheckboxes = container.querySelectorAll('.dislike-checkbox');
                
                likeCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const likeBtn = e.target.nextElementSibling;
                        const dislikeCheckbox = container.querySelector(`[data-type="${e.target.dataset.type}"][data-id="${e.target.dataset.id}"].dislike-checkbox`);
                        const dislikeBtn = dislikeCheckbox.nextElementSibling;
                        
                        if (e.target.checked) {
                            likeBtn.classList.add('bg-green-100', 'border-green-500');
                            // Uncheck dislike if it was checked
                            if (dislikeCheckbox.checked) {
                                dislikeCheckbox.checked = false;
                                dislikeBtn.classList.remove('bg-red-100', 'border-red-500');
                            }
                            // Store preference
                            this.storePreference(e.target.dataset.type, e.target.dataset.id, e.target.dataset.day, 'like');
                        } else {
                            likeBtn.classList.remove('bg-green-100', 'border-green-500');
                            this.removePreference(e.target.dataset.type, e.target.dataset.id, e.target.dataset.day);
                        }
                    });
                });
                
                dislikeCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const dislikeBtn = e.target.nextElementSibling;
                        const likeCheckbox = container.querySelector(`[data-type="${e.target.dataset.type}"][data-id="${e.target.dataset.id}"].like-checkbox`);
                        const likeBtn = likeCheckbox.nextElementSibling;
                        
                        if (e.target.checked) {
                            dislikeBtn.classList.add('bg-red-100', 'border-red-500');
                            // Uncheck like if it was checked
                            if (likeCheckbox.checked) {
                                likeCheckbox.checked = false;
                                likeBtn.classList.remove('bg-green-100', 'border-green-500');
                            }
                            // Store preference
                            this.storePreference(e.target.dataset.type, e.target.dataset.id, e.target.dataset.day, 'dislike');
                        } else {
                            dislikeBtn.classList.remove('bg-red-100', 'border-red-500');
                            this.removePreference(e.target.dataset.type, e.target.dataset.id, e.target.dataset.day);
                        }
                    });
                });
            }

            storePreference(type, id, day, preference) {
                if (!this.dailyFormsData.preferences[day]) {
                    this.dailyFormsData.preferences[day] = {};
                }
                if (!this.dailyFormsData.preferences[day][type]) {
                    this.dailyFormsData.preferences[day][type] = {};
                }
                this.dailyFormsData.preferences[day][type][id] = preference;
                
                console.log(`Day ${day} ${type} ${id}: ${preference}`, this.dailyFormsData.preferences);
            }

            removePreference(type, id, day) {
                if (this.dailyFormsData.preferences[day] && 
                    this.dailyFormsData.preferences[day][type] && 
                    this.dailyFormsData.preferences[day][type][id]) {
                    delete this.dailyFormsData.preferences[day][type][id];
                }
            }

            setupDayNavigation(dayNumber, totalDays) {
                const continueBtn = document.getElementById(`continueDay${dayNumber}`);
                const backBtn = document.getElementById(`backToFlightBtn${dayNumber}`);
                const previousDayBtn = document.getElementById(`previousDay${dayNumber}`);
                
                // Update daily forms data current day
                this.dailyFormsData.currentDay = dayNumber;
                
                if (continueBtn) {
                    continueBtn.addEventListener('click', async () => {
                        // Save current day preferences before moving
                        this.saveCurrentDayPreferences(dayNumber);
                        
                        // Show loading state
                        continueBtn.disabled = true;
                        continueBtn.innerHTML = `
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            <span data-en="Generating Schedule..." data-vi="Đang tạo lịch trình...">Generating Schedule...</span>
                        `;
                        
                        try {
                            // Generate recommendation for current day
                            await this.generateDayRecommendation(dayNumber);
                            
                            // Note: displayDaySchedule now handles the transition to schedule view
                            // No need to manually move to next day here
                            
                        } catch (error) {
                            console.error('Error generating day recommendation:', error);
                            // Restore button state
                            continueBtn.disabled = false;
                            const isLastDay = dayNumber === totalDays;
                            continueBtn.innerHTML = `
                                <span data-en="${isLastDay ? 'Generate Tour' : 'Continue'}" data-vi="${isLastDay ? 'Tạo Tour' : 'Tiếp tục'}">${isLastDay ? 'Generate Tour' : 'Continue'}</span>
                                <i class="fas fa-${isLastDay ? 'magic' : 'arrow-right'} ml-2"></i>
                            `;
                            
                            // Show error message
                            this.showErrorMessage('Failed to generate day schedule. Please try again.');
                        }
                    });
                }
                
                if (backBtn && dayNumber === 1) {
                    backBtn.addEventListener('click', () => {
                        // Save current preferences before going back
                        this.saveCurrentDayPreferences(dayNumber);
                        
                        // Show flight booking section again
                        const flightBookingSection = document.getElementById('flightBookingSection');
                        const dailyPreferencesSection = document.getElementById('dailyPreferencesSection');
                        
                        if (flightBookingSection) {
                            flightBookingSection.style.display = 'block';
                        }
                        if (dailyPreferencesSection) {
                            dailyPreferencesSection.style.display = 'none';
                        }
                    });
                }
                
                // Handle Previous Day button
                if (previousDayBtn && dayNumber > 1) {
                    previousDayBtn.addEventListener('click', () => {
                        // Save current day preferences before going back
                        this.saveCurrentDayPreferences(dayNumber);
                        
                        // Go back to previous day form while preserving data
                        this.generateDayForm(dayNumber - 1, totalDays, this.dailyFormsData.destinationCountry);
                    });
                }
                
                // Setup clickable progress steps navigation
                this.setupProgressStepsNavigation();
                
                // Restore preferences for current day
                setTimeout(() => {
                    this.restoreDayPreferences(dayNumber);
                }, 500);
            }
            
            setupProgressStepsNavigation() {
                // Make Basic Information step clickable
                const basicInfoStep = document.getElementById('backToBasicInfoStep');
                if (basicInfoStep) {
                    basicInfoStep.addEventListener('click', () => {
                        // Save current preferences
                        this.saveCurrentDayPreferences(this.dailyFormsData.currentDay);
                        
                        // Go back to package tab (Basic Information)
                        this.showPackageForm();
                    });
                }
                
                // Make Flight Booking step clickable  
                const flightBookingStep = document.getElementById('backToFlightBookingStep');
                if (flightBookingStep) {
                    flightBookingStep.addEventListener('click', () => {
                        // Save current preferences
                        this.saveCurrentDayPreferences(this.dailyFormsData.currentDay);
                        
                        // Show flight booking section
                        const flightBookingSection = document.getElementById('flightBookingSection');
                        const dailyPreferencesSection = document.getElementById('dailyPreferencesSection');
                        
                        if (flightBookingSection) {
                            flightBookingSection.style.display = 'block';
                        }
                        if (dailyPreferencesSection) {
                            dailyPreferencesSection.style.display = 'none';
                        }
                    });
                }
            }
            
            showPackageForm() {
                // Hide daily preferences section
                const dailyPreferencesSection = document.getElementById('dailyPreferencesSection');
                if (dailyPreferencesSection) {
                    dailyPreferencesSection.style.display = 'none';
                }
                
                // Hide flight booking section  
                const flightBookingSection = document.getElementById('flightBookingSection');
                if (flightBookingSection) {
                    flightBookingSection.style.display = 'none';
                }
                
                // Show package form
                const packageForm = document.getElementById('packageForm');
                if (packageForm) {
                    packageForm.style.display = 'block';
                }
                
                // Switch to package tab
                const packageTab = document.querySelector('[data-tab="package"]');
                const packageTabContent = document.getElementById('package-tab');
                
                if (packageTab && packageTabContent) {
                    // Remove active class from all tabs
                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Activate package tab
                    packageTab.classList.add('active');
                    packageTabContent.classList.remove('hidden');
                }
            }
            
            saveCurrentDayPreferences(dayNumber) {
                // Save like/dislike selections for current day
                const dayContainer = document.getElementById(`dayForm${dayNumber}`);
                if (!dayContainer) return;
                
                // Get all like/dislike checkboxes
                const likeCheckboxes = dayContainer.querySelectorAll('.like-checkbox:checked');
                const dislikeCheckboxes = dayContainer.querySelectorAll('.dislike-checkbox:checked');
                
                // Initialize preferences for this day if not exists
                if (!this.dailyFormsData.preferences[dayNumber]) {
                    this.dailyFormsData.preferences[dayNumber] = {};
                }
                
                // Save liked items
                likeCheckboxes.forEach(checkbox => {
                    const type = checkbox.dataset.type;
                    const id = checkbox.dataset.id;
                    
                    if (!this.dailyFormsData.preferences[dayNumber][type]) {
                        this.dailyFormsData.preferences[dayNumber][type] = {};
                    }
                    this.dailyFormsData.preferences[dayNumber][type][id] = 'like';
                });
                
                // Save disliked items
                dislikeCheckboxes.forEach(checkbox => {
                    const type = checkbox.dataset.type;
                    const id = checkbox.dataset.id;
                    
                    if (!this.dailyFormsData.preferences[dayNumber][type]) {
                        this.dailyFormsData.preferences[dayNumber][type] = {};
                    }
                    this.dailyFormsData.preferences[dayNumber][type][id] = 'dislike';
                });
            }
            
            restoreDayPreferences(dayNumber) {
                // Restore like/dislike selections for current day
                const dayPrefs = this.dailyFormsData.preferences[dayNumber];
                if (!dayPrefs) return;
                
                const dayContainer = document.getElementById(`dayForm${dayNumber}`);
                if (!dayContainer) return;
                
                // Restore preferences for each type
                Object.keys(dayPrefs).forEach(type => {
                    Object.keys(dayPrefs[type]).forEach(id => {
                        const preference = dayPrefs[type][id];
                        
                        if (preference === 'like') {
                            const likeCheckbox = dayContainer.querySelector(`[data-type="${type}"][data-id="${id}"].like-checkbox`);
                            if (likeCheckbox) {
                                likeCheckbox.checked = true;
                                likeCheckbox.parentNode.querySelector('.like-btn').classList.add('bg-green-100', 'border-green-400');
                            }
                        } else if (preference === 'dislike') {
                            const dislikeCheckbox = dayContainer.querySelector(`[data-type="${type}"][data-id="${id}"].dislike-checkbox`);
                            if (dislikeCheckbox) {
                                dislikeCheckbox.checked = true;
                                dislikeCheckbox.parentNode.querySelector('.dislike-btn').classList.add('bg-red-100', 'border-red-400');
                            }
                        }
                    });
                });
            }

            async generateDayRecommendation(dayNumber) {
                console.log(`🎯 Generating recommendation for Day ${dayNumber}`);
                
                // Collect all liked IDs from current day
                const currentDayPrefs = this.dailyFormsData.preferences[dayNumber] || {};
                
                const likedIds = {
                    activity_ids: [],
                    hotel_ids: [],
                    restaurant_ids: [],
                    transport_ids: []
                };
                
                // Extract liked IDs from preferences
                Object.keys(currentDayPrefs).forEach(type => {
                    Object.keys(currentDayPrefs[type]).forEach(id => {
                        if (currentDayPrefs[type][id] === 'like') {
                            if (type === 'activity') {
                                likedIds.activity_ids.push(id);
                            } else if (type === 'hotel') {
                                likedIds.hotel_ids.push(id);
                            } else if (type === 'restaurant') {
                                likedIds.restaurant_ids.push(id);
                            } else if (type === 'transport') {
                                likedIds.transport_ids.push(id);
                            }
                        }
                    });
                });
                
                // Chuẩn bị user preferences từ daily preferences data
                const userPreferences = {
                    liked_hotels: likedIds.hotel_ids,
                    liked_activities: likedIds.activity_ids,
                    liked_restaurants: likedIds.restaurant_ids,
                    liked_transport_modes: likedIds.transport_ids,
                    disliked_hotels: [],
                    disliked_activities: [],
                    disliked_restaurants: [],
                    disliked_transport_modes: []
                };
                
                // Thu thập disliked items từ preferences
                Object.keys(currentDayPrefs).forEach(type => {
                    Object.keys(currentDayPrefs[type]).forEach(id => {
                        if (currentDayPrefs[type][id] === 'dislike') {
                            if (type === 'activity') {
                                userPreferences.disliked_activities.push(id);
                            } else if (type === 'hotel') {
                                userPreferences.disliked_hotels.push(id);
                            } else if (type === 'restaurant') {
                                userPreferences.disliked_restaurants.push(id);
                            } else if (type === 'transport') {
                                userPreferences.disliked_transport_modes.push(id);
                            }
                        }
                    });
                });

                // Prepare request payload - CHỈ SỬ DỤNG GEMINI AI
                const requestPayload = {
                    user_id: null,
                    start_city_id: this.selectedDepartureCity?.city_id || 1704413791,
                    destination_city_id: this.selectedDestinationCity?.city_id || 1704774326,
                    hotel_ids: likedIds.hotel_ids,
                    activity_ids: likedIds.activity_ids,
                    restaurant_ids: likedIds.restaurant_ids,
                    transport_ids: likedIds.transport_ids,
                    guest_count: this.passengerCounts.adults + this.passengerCounts.children,
                    duration_days: 1, // Single day recommendation
                    target_budget: 1111, // Default budget, could be made configurable
                    user_preferences: userPreferences // ⭐ User preferences cho Gemini AI
                };
                
                console.log('🔍 Request payload:', requestPayload);
                
                // Call recommendation API using the existing generate-tour endpoint
                try {
                    const response = await fetch('/api/generate-tour', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestPayload)
                    });
                    
                    const result = await response.json();
                    console.log('📅 Day recommendation result:', result);
                    
                    // Check if API returned success
                    if (!result.success) {
                        throw new Error(result.error || 'API call failed');
                    }
                    
                    // Display schedule result using the data field
                    this.displayDaySchedule(dayNumber, result.data);
                } catch (error) {
                    console.error('Error calling recommendation API:', error);
                    throw error;
                }
            }

            displayDaySchedule(dayNumber, tourResult) {
                if (!tourResult.schedule || tourResult.schedule.length === 0) {
                    console.error('No schedule data received');
                    return;
                }
                
                // Find the correct day from schedule array based on day property
                const daySchedule = tourResult.schedule.find(day => day.day === 1) || tourResult.schedule[0];
                const activities = daySchedule.activities || [];
                
                console.log(`📅 Displaying schedule for Day ${dayNumber} (showing day ${daySchedule.day} from API response)`);
                
                const isLastDay = dayNumber === this.dailyFormsData.totalDays;
                const currentDate = new Date(document.getElementById('v2DepartureDate').value);
                currentDate.setDate(currentDate.getDate() + dayNumber - 1);
                const dateString = currentDate.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Create complete schedule view that replaces the form
                const scheduleViewHtml = `
                    <div id="dayScheduleView${dayNumber}" class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8">
                        <!-- Day Header -->
                        <div class="mb-8">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg mr-4">
                                        <span class="text-white font-bold text-lg">${dayNumber}</span>
                                    </div>
                                    <div>
                                        <h4 class="text-2xl font-bold text-gray-800" data-en="Day ${dayNumber} - Schedule" data-vi="Ngày ${dayNumber} - Lịch Trình">Day ${dayNumber} - Schedule</h4>
                                        <p class="text-gray-600" data-en="${dateString}" data-vi="${dateString}">${dateString}</p>
                                    </div>
                                </div>
                                <div class="text-sm text-gray-500">
                                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full font-medium">
                                        <i class="fas fa-check-circle mr-1"></i>
                                        <span data-en="Completed" data-vi="Hoàn thành">Completed</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Generated Schedule -->
                        <div class="mb-8 p-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl border border-green-200">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-calendar-check text-white"></i>
                                </div>
                                <h5 class="text-xl font-bold text-gray-800">
                                    <span data-en="Your Personalized Schedule" data-vi="Lịch Trình Cá Nhân Của Bạn">Your Personalized Schedule</span>
                                </h5>
                            </div>
                            
                            <div class="space-y-3">
                                ${activities.map((activity, index) => `
                                    <div class="flex items-center p-3 bg-white rounded-lg shadow-sm border border-gray-100">
                                        <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-purple-500 rounded-lg flex items-center justify-center mr-4">
                                            <i class="fas fa-${activity.type === 'transfer' ? this.getTransportIcon(activity.transport_mode) : this.getActivityIcon(activity.type)} text-white"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center mb-1">
                                                <span class="text-sm font-medium text-blue-600 mr-2">${activity.start_time} - ${activity.end_time}</span>
                                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">${activity.type}</span>
                                                ${activity.type === 'transfer' && activity.distance_km ? `<span class="px-2 py-1 bg-gray-100 text-gray-600 rounded-full text-xs ml-1">${activity.distance_km}km</span>` : ''}
                                            </div>
                                            <h6 class="font-semibold text-gray-800">
                                                ${activity.type === 'transfer' ? 
                                                    `${this.getTransportName(activity.transport_mode)} - ${activity.place_name || activity.description || 'Di chuyển đến địa điểm tiếp theo'}` : 
                                                    (activity.type === 'meal' ? `Ăn ở ${activity.place_name}` : activity.place_name)
                                                }
                                            </h6>
                                            <p class="text-sm text-gray-600">Cost: $${activity.cost}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="mt-4 p-3 bg-blue-100 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="font-medium text-blue-800">
                                        <span data-en="Total Day Cost:" data-vi="Tổng Chi Phí Ngày:">Total Day Cost:</span>
                                    </span>
                                    <span class="font-bold text-blue-900">$${activities.reduce((sum, activity) => sum + (activity.cost || 0), 0).toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Navigation Buttons -->
                        <div class="flex justify-between items-center pt-6 border-t border-gray-100">
                            <div class="flex space-x-3">
                                <button type="button" id="editDay${dayNumber}" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition duration-300 font-medium">
                                    <i class="fas fa-edit mr-2"></i>
                                    <span data-en="Edit Preferences" data-vi="Sửa Sở Thích">Edit Preferences</span>
                                </button>
                                ${dayNumber > 1 ? `
                                    <button type="button" id="previousSchedule${dayNumber}" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition duration-300 font-medium">
                                        <i class="fas fa-chevron-left mr-2"></i>
                                        <span data-en="Previous Day" data-vi="Ngày trước">Previous Day</span>
                                    </button>
                                ` : ''}
                            </div>
                            
                            <div class="flex-1"></div>
                            
                            <button type="button" id="proceedDay${dayNumber}" class="px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:from-purple-700 hover:to-indigo-700 transition duration-300 font-bold shadow-lg">
                                <span data-en="${isLastDay ? 'Generate Final Tour' : 'Continue to Next Day'}" data-vi="${isLastDay ? 'Tạo Tour Cuối Cùng' : 'Tiếp tục Ngày Tiếp Theo'}">${isLastDay ? 'Generate Final Tour' : 'Continue to Next Day'}</span>
                                <i class="fas fa-${isLastDay ? 'magic' : 'arrow-right'} ml-2"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                // Replace the current day form with schedule view
                const formContainer = document.getElementById('dailyFormContainer');
                if (formContainer) {
                    formContainer.innerHTML = scheduleViewHtml;
                    console.log(`✅ Day ${dayNumber} form replaced with schedule view`);
                    
                    // Setup navigation for schedule view
                    this.setupScheduleNavigation(dayNumber);
                } else {
                    console.error(`❌ Daily form container not found`);
                }
                
                // Store schedule data for later use
                if (!this.dailyFormsData.generatedSchedules) {
                    this.dailyFormsData.generatedSchedules = {};
                }
                this.dailyFormsData.generatedSchedules[dayNumber] = tourResult;
            }

            setupScheduleNavigation(dayNumber) {
                const editBtn = document.getElementById(`editDay${dayNumber}`);
                const proceedBtn = document.getElementById(`proceedDay${dayNumber}`);
                const previousScheduleBtn = document.getElementById(`previousSchedule${dayNumber}`);
                
                // Edit preferences button
                if (editBtn) {
                    editBtn.addEventListener('click', () => {
                        // Go back to form view for this day
                        this.generateDayForm(dayNumber, this.dailyFormsData.totalDays, this.dailyFormsData.destinationCountry);
                    });
                }
                
                // Proceed button (Continue to next day or Generate Final Tour)
                if (proceedBtn) {
                    proceedBtn.addEventListener('click', () => {
                        if (dayNumber === this.dailyFormsData.totalDays) {
                            // Last day - Generate Final Tour
                            this.generateFinalTour();
                        } else {
                            // Continue to next day
                            this.generateDayForm(dayNumber + 1, this.dailyFormsData.totalDays, this.dailyFormsData.destinationCountry);
                        }
                    });
                }
                
                // Previous schedule button
                if (previousScheduleBtn) {
                    previousScheduleBtn.addEventListener('click', () => {
                        // Show previous day's schedule if it exists
                        if (this.dailyFormsData.generatedSchedules[dayNumber - 1]) {
                            this.showDaySchedule(dayNumber - 1);
                        } else {
                            // Go back to previous day form
                            this.generateDayForm(dayNumber - 1, this.dailyFormsData.totalDays, this.dailyFormsData.destinationCountry);
                        }
                    });
                }
            }
            
            showDaySchedule(dayNumber) {
                // Show an existing schedule for a specific day
                const scheduleData = this.dailyFormsData.generatedSchedules[dayNumber];
                if (scheduleData) {
                    this.displayDaySchedule(dayNumber, scheduleData);
                }
            }
            
            generateFinalTour() {
                console.log('🎉 Generating final tour with all daily schedules...');
                
                // Collect all generated schedules
                const allSchedules = this.dailyFormsData.generatedSchedules;
                const totalDays = Object.keys(allSchedules).length;
                
                if (totalDays !== this.dailyFormsData.totalDays) {
                    console.error('Not all days have been completed');
                    this.showErrorMessage('Please complete all days before generating final tour');
                    return;
                }
                
                // Show final tour generation loading
                const formContainer = document.getElementById('dailyFormContainer');
                if (formContainer) {
                    formContainer.innerHTML = `
                        <div class="text-center py-16">
                            <div class="loading-spinner mx-auto mb-4"></div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">
                                <span data-en="Generating Your Complete Tour..." data-vi="Đang Tạo Tour Hoàn Chỉnh...">Generating Your Complete Tour...</span>
                            </h3>
                            <p class="text-gray-600">
                                <span data-en="Combining all your daily preferences into the perfect itinerary" data-vi="Kết hợp tất cả sở thích hàng ngày thành lịch trình hoàn hảo">Combining all your daily preferences into the perfect itinerary</span>
                            </p>
                        </div>
                    `;
                }
                
                // Simulate final tour generation (replace with actual API call)
                setTimeout(() => {
                    this.displayFinalTour(allSchedules);
                }, 3000);
            }
            
            displayFinalTour(allSchedules) {
                console.log('🎊 Displaying final complete tour');
                
                const totalCost = Object.values(allSchedules).reduce((sum, schedule) => {
                    return sum + (schedule.total_estimated_cost || 0);
                }, 0);
                
                const formContainer = document.getElementById('dailyFormContainer');
                if (formContainer) {
                    let scheduleHtml = '';
                    
                    Object.keys(allSchedules).sort((a, b) => parseInt(a) - parseInt(b)).forEach(day => {
                        const schedule = allSchedules[day];
                        const daySchedule = schedule.schedule?.[0] || {};
                        const activities = daySchedule.activities || [];
                        
                        scheduleHtml += `
                            <div class="mb-6 p-6 bg-white rounded-xl border border-gray-200 shadow-sm">
                                <h4 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                    <span class="w-8 h-8 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-sm mr-3">${day}</span>
                                    Day ${day}
                                </h4>
                                <div class="space-y-2">
                                    ${activities.map(activity => `
                                        <div class="flex items-center p-2 bg-gray-50 rounded-lg">
                                            <span class="text-sm font-medium text-blue-600 mr-3 w-20">${activity.start_time} - ${activity.end_time}</span>
                                            <span class="flex-1 text-gray-800">${activity.place_name}</span>
                                            <span class="text-sm text-gray-600">$${activity.cost}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    });
                    
                    formContainer.innerHTML = `
                        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8">
                            <div class="text-center mb-8">
                                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-magic text-white text-2xl"></i>
                                </div>
                                <h3 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent mb-2">
                                    <span data-en="Your Complete Tour Itinerary" data-vi="Lịch Trình Tour Hoàn Chỉnh">Your Complete Tour Itinerary</span>
                                </h3>
                                <p class="text-gray-600">
                                    <span data-en="A personalized ${this.dailyFormsData.totalDays}-day journey crafted just for you" data-vi="Hành trình ${this.dailyFormsData.totalDays} ngày được thiết kế riêng cho bạn">A personalized ${this.dailyFormsData.totalDays}-day journey crafted just for you</span>
                                </p>
                            </div>
                            
                            ${scheduleHtml}
                            
                            <div class="mt-8 p-6 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl border border-purple-200">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-xl font-bold text-gray-800">
                                        <span data-en="Tour Summary" data-vi="Tóm Tắt Tour">Tour Summary</span>
                                    </h4>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-purple-600">${this.dailyFormsData.totalDays}</div>
                                        <div class="text-sm text-gray-600">
                                            <span data-en="Days" data-vi="Ngày">Days</span>
                                        </div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-purple-600">$${totalCost.toFixed(2)}</div>
                                        <div class="text-sm text-gray-600">
                                            <span data-en="Total Cost" data-vi="Tổng Chi Phí">Total Cost</span>
                                        </div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-purple-600">${Object.values(allSchedules).reduce((sum, schedule) => sum + (schedule.schedule?.[0]?.activities?.length || 0), 0)}</div>
                                        <div class="text-sm text-gray-600">
                                            <span data-en="Activities" data-vi="Hoạt Động">Activities</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-center space-x-4 mt-8">
                                <button class="px-8 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition duration-300 font-medium">
                                    <i class="fas fa-download mr-2"></i>
                                    <span data-en="Download PDF" data-vi="Tải PDF">Download PDF</span>
                                </button>
                                <button class="px-8 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition duration-300 font-medium">
                                    <i class="fas fa-share mr-2"></i>
                                    <span data-en="Share Tour" data-vi="Chia Sẻ Tour">Share Tour</span>
                                </button>
                                <button class="px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:from-purple-700 hover:to-indigo-700 transition duration-300 font-bold shadow-lg">
                                    <i class="fas fa-check mr-2"></i>
                                    <span data-en="Book This Tour" data-vi="Đặt Tour Này">Book This Tour</span>
                                </button>
                            </div>
                        </div>
                    `;
                }
            }

            getActivityIcon(type) {
                const iconMap = {
                    'activity': 'map-marker-alt',
                    'restaurant': 'utensils',
                    'hotel': 'bed',
                    'transport': 'car',
                    'transfer': 'route',
                    'meal': 'utensils',
                    'rest': 'bed'
                };
                return iconMap[type] || 'map-marker-alt';
            }

            getTransportIcon(transportMode) {
                if (!transportMode) return 'route';
                
                // Map database transport names to appropriate icons
                const mode = transportMode.toLowerCase();
                
                if (mode.includes('taxi') || mode.includes('grab') || mode.includes('uber') || mode.includes('didi')) {
                    return 'taxi';
                } else if (mode.includes('bus') || mode.includes('brt') || mode.includes('transjakarta') || mode.includes('jeepney') || mode.includes('matatu')) {
                    return 'bus';
                } else if (mode.includes('metro') || mode.includes('train') || mode.includes('subway') || mode.includes('lrt') || mode.includes('mrt') || mode.includes('skytrain') || mode.includes('tram')) {
                    return 'subway';
                } else if (mode.includes('bike') || mode.includes('bicycle')) {
                    return 'bicycle';
                } else if (mode.includes('scooter') || mode.includes('motorcycle') || mode.includes('ojek') || mode.includes('grabbike') || mode.includes('motorbike')) {
                    return 'motorcycle';
                } else if (mode.includes('walk') || mode.includes('foot')) {
                    return 'walking';
                } else if (mode.includes('ferry') || mode.includes('boat')) {
                    return 'ship';
                } else if (mode.includes('rickshaw') || mode.includes('cyclo') || mode.includes('tricycle')) {
                    return 'taxi';  // Use taxi icon for unique transport
                } else {
                    return 'route';  // Default fallback
                }
            }

            getTransportName(transportMode) {
                // Sử dụng trực tiếp tên từ database, không cần mapping
                return transportMode || 'Di chuyển';
            }

            showErrorMessage(message) {
                // Simple error display - could be enhanced with a proper notification system
                const errorDiv = document.createElement('div');
                errorDiv.className = 'mt-4 p-4 bg-red-100 border border-red-300 rounded-lg text-red-700';
                errorDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                // Insert error message
                const currentDay = this.dailyFormsData?.currentDay || 1;
                const dayContainer = document.getElementById(`dayForm${currentDay}`);
                if (dayContainer) {
                    const continueBtn = document.getElementById(`continueDay${currentDay}`);
                    if (continueBtn) {
                        continueBtn.parentNode.insertBefore(errorDiv, continueBtn);
                        
                        // Auto-remove after 5 seconds
                        setTimeout(() => {
                            errorDiv.remove();
                        }, 5000);
                    }
                }
            }

            generateTour() {
                console.log('Generating complete tour with preferences:', this.dailyFormsData.preferences);
                console.log('Generated schedules for each day:', this.dailyFormsData.generatedSchedules);
                
                // Display final tour summary with all generated schedules
                this.displayFinalTourSummary();
            }

            displayFinalTourSummary() {
                const summaryHtml = `
                    <div class="mt-8 p-6 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl border border-purple-200">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center mr-4">
                                <i class="fas fa-magic text-white text-xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800">
                                <span data-en="Complete Tour Generated!" data-vi="Tour Hoàn Chỉnh Đã Được Tạo!">Complete Tour Generated!</span>
                            </h3>
                        </div>
                        
                        <div class="bg-white rounded-lg p-4 mb-4">
                            <h4 class="font-semibold text-gray-800 mb-2">
                                <span data-en="Tour Summary" data-vi="Tóm Tắt Tour">Tour Summary</span>
                            </h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-600">From:</span> 
                                    <span class="font-medium">${this.selectedDepartureCity?.name || 'Unknown'}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">To:</span> 
                                    <span class="font-medium">${this.selectedDestinationCity?.name || 'Unknown'}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Duration:</span> 
                                    <span class="font-medium">${this.dailyFormsData?.totalDays || 0} days</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Guests:</span> 
                                    <span class="font-medium">${this.passengerCounts.adults + this.passengerCounts.children} people</span>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-600 text-center">
                            <span data-en="Your personalized tour has been generated based on your preferences for each day." data-vi="Tour cá nhân của bạn đã được tạo dựa trên sở thích của bạn cho từng ngày.">
                                Your personalized tour has been generated based on your preferences for each day.
                            </span>
                        </p>
                    </div>
                `;
                
                const dailyPreferencesSection = document.getElementById('dailyPreferencesSection');
                if (dailyPreferencesSection) {
                    const summaryDiv = document.createElement('div');
                    summaryDiv.innerHTML = summaryHtml;
                    dailyPreferencesSection.appendChild(summaryDiv);
                }
            }

            toggleFlightsList(type) {
                const listContainer = document.getElementById(`${type}FlightsList`);
                const chevron = document.querySelector(`.${type}-chevron`);
                
                if (listContainer && chevron) {
                    listContainer.classList.toggle('hidden');
                    chevron.style.transform = listContainer.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
                }
            }

            toggleSummaryCollapse() {
                const content = document.querySelector('.collapse-preview__content');
                const chevron = document.querySelector('.summary-chevron');
                
                if (content && chevron) {
                    content.classList.toggle('hidden');
                    chevron.style.transform = content.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
                }
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            if (document.getElementById('package-tab')) {
                new PersonalizedTourV2();
                
                // Add budget suggestion handlers
                setTimeout(() => {
                    document.querySelectorAll('.budget-suggestion').forEach(button => {
                        button.addEventListener('click', function() {
                            const amount = this.dataset.amount;
                            document.getElementById('v2Budget').value = amount;
                            
                            // Add visual feedback
                            document.querySelectorAll('.budget-suggestion').forEach(btn => {
                                btn.classList.remove('bg-pink-300', 'text-pink-800');
                                btn.classList.add('bg-pink-100', 'text-pink-700');
                            });
                            this.classList.remove('bg-pink-100', 'text-pink-700');
                            this.classList.add('bg-pink-300', 'text-pink-800');
                        });
                    });
                }, 100);
            }
        });
        </script>

        <script src="assets/js/script.js"></script>
        <script src="assets/js/tour-search.js"></script>
        <script src="assets/js/components/tour-history.js"></script>
        <!-- Thêm xử lý lỗi cho Maps API -->
        <script>
            window.handleMapsError = function() {
                console.error("Google Maps API không thể tải - vui lòng kiểm tra quyền truy cập API trong Google Cloud Console");
            }
        </script>
        <script src="assets/js/restaurant-manager.js"></script>
        <script src="assets/js/hotel-form.js"></script>
        <script src="assets/js/hotel-manager.js"></script>
        
        <script>
            // Initialize edit and delete restaurant modals
            document.addEventListener('DOMContentLoaded', function() {
                // Edit restaurant modal
                const editRestaurantModal = document.getElementById('editRestaurantModal');
                const closeEditRestaurantModalBtn = document.getElementById('closeEditRestaurantModal');
                const cancelEditRestaurantBtn = document.getElementById('cancelEditBtn');
                const editRestaurantForm = document.getElementById('editRestaurantForm');
                
                if (closeEditRestaurantModalBtn) {
                    closeEditRestaurantModalBtn.addEventListener('click', closeEditRestaurantModal);
                }
                
                if (cancelEditRestaurantBtn) {
                    cancelEditRestaurantBtn.addEventListener('click', closeEditRestaurantModal);
                }
                
                if (editRestaurantModal) {
                    editRestaurantModal.addEventListener('click', function(e) {
                        if (e.target === editRestaurantModal) {
                            closeEditRestaurantModal();
                        }
                    });
                }
                
                if (editRestaurantForm) {
                    editRestaurantForm.addEventListener('submit', handleEditRestaurantFormSubmit);
                }
                
                // Edit hotel modal
                const editHotelModal = document.getElementById('editHotelModal');
                const closeEditHotelModalBtn = document.getElementById('closeEditHotelModal');
                const cancelEditHotelBtn = document.getElementById('cancelEditHotelBtn');
                const editHotelForm = document.getElementById('editHotelForm');
                
                if (closeEditHotelModalBtn) {
                    closeEditHotelModalBtn.addEventListener('click', closeEditHotelModal);
                }
                
                if (cancelEditHotelBtn) {
                    cancelEditHotelBtn.addEventListener('click', closeEditHotelModal);
                }
                
                if (editHotelModal) {
                    editHotelModal.addEventListener('click', function(e) {
                        if (e.target === editHotelModal) {
                            closeEditHotelModal();
                        }
                    });
                }
                
                if (editHotelForm) {
                    editHotelForm.addEventListener('submit', handleEditHotelFormSubmit);
                }
                
                // Delete confirmation modal
                const deleteModal = document.getElementById('deleteConfirmModal');
                const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
                const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
                
                if (cancelDeleteBtn) {
                    cancelDeleteBtn.addEventListener('click', closeDeleteConfirmModal);
                }
                
                if (confirmDeleteBtn) {
                    confirmDeleteBtn.addEventListener('click', handleDeleteItem);
                }
                
                if (deleteModal) {
                    deleteModal.addEventListener('click', function(e) {
                        if (e.target === deleteModal) {
                            closeDeleteConfirmModal();
                        }
                    });
                }
                
                // Utility functions for modals and forms
                window.closeEditRestaurantModal = function() {
                    const modal = document.getElementById('editRestaurantModal');
                    if (modal) modal.classList.add('hidden');
                };
                
                window.closeEditHotelModal = function() {
                    const modal = document.getElementById('editHotelModal');
                    if (modal) modal.classList.add('hidden');
                };
                
                window.closeDeleteConfirmModal = function() {
                    const modal = document.getElementById('deleteConfirmModal');
                    if (modal) modal.classList.add('hidden');
                };
                
                window.handleEditRestaurantFormSubmit = function(e) {
                    e.preventDefault();
                    // Form submission logic for restaurant editing
                    console.log('Edit restaurant form submitted');
                    // Actual implementation would send data to server
                    closeEditRestaurantModal();
                };
                
                window.handleEditHotelFormSubmit = function(e) {
                    e.preventDefault();
                    // Form submission logic for hotel editing
                    console.log('Edit hotel form submitted');
                    // Actual implementation would send data to server
                    closeEditHotelModal();
                };
                
                window.handleDeleteItem = function() {
                    const itemType = document.getElementById('deleteItemType').value;
                    const itemId = document.getElementById('deleteItemId').value;
                    
                    if (itemType === 'restaurant') {
                        // Delete restaurant logic
                        console.log('Deleting restaurant with ID:', itemId);
                    } else if (itemType === 'hotel') {
                        // Delete hotel logic
                        console.log('Deleting hotel with ID:', itemId);
                    }
                    
                    closeDeleteConfirmModal();
                };
                
                
                // Add Hotel Button Functionality
                const addHotelBtn = document.getElementById('addHotelBtn');
                const addHotelModal = document.getElementById('addHotelModal');
                const closeAddHotelModalBtn = document.getElementById('closeAddHotelModal');
                const manualAddHotelOption = document.getElementById('manualAddHotelOption');
                const hotelExcelUploadOption = document.getElementById('hotelExcelUploadOption');
                const hotelManualFormContainer = document.getElementById('hotelManualFormContainer');
                const hotelExcelUploadContainer = document.getElementById('hotelExcelUploadContainer');
                const backToHotelChoice = document.getElementById('backToHotelChoice');
                const backToHotelChoiceFromExcel = document.getElementById('backToHotelChoiceFromExcel');
                const addHotelChoice = document.getElementById('addHotelChoice');
                const addHotelForm = document.getElementById('addHotelForm');
                
                if (addHotelBtn) {
                    addHotelBtn.addEventListener('click', function() {
                        if (addHotelModal) {
                            addHotelModal.classList.remove('hidden');
                            // Reset to choice view when opening modal
                            if (addHotelChoice) addHotelChoice.classList.remove('hidden');
                            if (hotelManualFormContainer) hotelManualFormContainer.classList.add('hidden');
                            if (hotelExcelUploadContainer) hotelExcelUploadContainer.classList.add('hidden');
                        }
                    });
                }
                
                if (closeAddHotelModalBtn) {
                    closeAddHotelModalBtn.addEventListener('click', function() {
                        if (addHotelModal) {
                            addHotelModal.classList.add('hidden');
                        }
                    });
                }
                
                if (manualAddHotelOption) {
                    manualAddHotelOption.addEventListener('click', function() {
                        if (addHotelChoice) addHotelChoice.classList.add('hidden');
                        if (hotelManualFormContainer) hotelManualFormContainer.classList.remove('hidden');
                    });
                }
                
                if (hotelExcelUploadOption) {
                    hotelExcelUploadOption.addEventListener('click', function() {
                        if (addHotelChoice) addHotelChoice.classList.add('hidden');
                        if (hotelExcelUploadContainer) hotelExcelUploadContainer.classList.remove('hidden');
                    });
                }
                
                if (backToHotelChoice) {
                    backToHotelChoice.addEventListener('click', function() {
                        if (addHotelChoice) addHotelChoice.classList.remove('hidden');
                        if (hotelManualFormContainer) hotelManualFormContainer.classList.add('hidden');
                    });
                }
                
                if (backToHotelChoiceFromExcel) {
                    backToHotelChoiceFromExcel.addEventListener('click', function() {
                        if (addHotelChoice) addHotelChoice.classList.remove('hidden');
                        if (hotelExcelUploadContainer) hotelExcelUploadContainer.classList.add('hidden');
                    });
                }
                
                if (addHotelForm) {
                    addHotelForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        const formData = new FormData(addHotelForm);
                        console.log('Add hotel form submitted');
                        
                        // Simulate successful submission
                        setTimeout(() => {
                            alert('Hotel added successfully!');
                            addHotelForm.reset();
                            addHotelModal.classList.add('hidden');
                        }, 1000);
                    });
                }
            });
        </script>
        <script>
            // Global getUserConfig function - accessible from anywhere
            const getUserConfig = () => {
                try {
                    // Check cookie first for user's preference from welcome-setup
                    const cookies = document.cookie.split(';');
                    const configCookie = cookies.find(cookie => 
                        cookie.trim().startsWith('vietnam_travel_ui_config=')
                    );
                    
                    if (configCookie) {
                        const configValue = decodeURIComponent(configCookie.split('=')[1]);
                        const config = JSON.parse(configValue);
                        console.log(`🔄 Loading config from user cookie:`, config);
                        return config;
                    }
                    
                    // No localStorage fallback - server only
                } catch (error) {
                    console.log('⚠️ Error loading config from storage:', error);
                }
                
                // Fallback to site_config.json
                try {
                    // Try to access the global config if it was loaded
                    if (window.globalConfig) {
                        const config = {};
                        if (window.globalConfig.theme && window.globalConfig.theme.name) {
                            config.theme = window.globalConfig.theme.name;
                        }
                        if (window.globalConfig.language && window.globalConfig.language.default) {
                            config.language = window.globalConfig.language.default;
                        }
                        if (window.globalConfig.currency && window.globalConfig.currency.default) {
                            config.currency = window.globalConfig.currency.default;
                        }
                        return config;
                    }
                } catch (e) {
                    console.log('⚠️ Error accessing global config');
                }
                
                return {
                    theme: 'sunset',
                    language: 'en',
                    currency: 'USD'
                }; // Default config
            };

            // Enhanced Dashboard functionality
            document.addEventListener('DOMContentLoaded', function () {
                // Check and apply user configuration (theme and language) before anything else
                // Apply user configuration directly to avoid flashing
                const userConfig = getUserConfig();
                if (userConfig) {
                    // Apply theme
                    if (userConfig.theme) {
                        console.log(`🔄 Setting initial theme: ${userConfig.theme}`);
                        document.documentElement.setAttribute('data-theme', userConfig.theme);
                        document.body.className = document.body.className.replace(/theme-\w+/g, '');
                        document.body.classList.add(`theme-${userConfig.theme}`);
                    }
                    
                    // Apply language
                    if (userConfig.language) {
                        console.log(`🔄 Setting initial language: ${userConfig.language}`);
                        window.currentLanguage = userConfig.language;
                        const currentLanguageSpan = document.getElementById('currentLanguage');
                        if (currentLanguageSpan) {
                            currentLanguageSpan.textContent = userConfig.language.toUpperCase();
                        }
                        
                        // Apply language to ALL text elements thoroughly
                        document.querySelectorAll('[data-en][data-vi]').forEach(el => {
                            const key = userConfig.language === 'vi' ? 'data-vi' : 'data-en';
                            if (el.getAttribute(key)) {
                                el.textContent = el.getAttribute(key);
                            }
                        });
                        
                        // Update input placeholders with localized text
                        document.querySelectorAll('input[data-en-placeholder][data-vi-placeholder]').forEach(input => {
                            const placeholderKey = userConfig.language === 'vi' ? 'data-vi-placeholder' : 'data-en-placeholder';
                            input.placeholder = input.getAttribute(placeholderKey);
                        });
                        
                        // Update language indicators in dropdown
                        document.querySelectorAll('.language-option span:last-child').forEach(span => {
                            span.classList.add('hidden');
                        });
                        const selectedLangOption = document.querySelector(`.language-option[data-lang="${userConfig.language}"] span:last-child`);
                        if (selectedLangOption) {
                            selectedLangOption.classList.remove('hidden');
                        }
                        
                        // Update language display if function exists
                        if (typeof updateLanguageDisplay === 'function') {
                            updateLanguageDisplay();
                        }
                    }
                    
                    // Apply currency
                    if (userConfig.currency) {
                        console.log(`🔄 Setting initial currency: ${userConfig.currency}`);
                        window.currentCurrency = userConfig.currency;
                        const currentCurrencySpan = document.getElementById('currentCurrency');
                        if (currentCurrencySpan) {
                            currentCurrencySpan.textContent = userConfig.currency;
                        }
                        // Update currency display if function exists
                        if (typeof updateCurrencyDisplay === 'function') {
                            updateCurrencyDisplay();
                        }
                    }
                }
                
                // Check admin status and show admin button if user is admin
                checkAdminStatus();
                
                // Enhanced logout functionality
                document.getElementById('logoutBtn').addEventListener('click', function () {
                    const message = currentLanguage === 'vi' ?
                        'Bạn có chắc muốn đăng xuất?' :
                        'Are you sure you want to logout?';

                    if (confirm(message)) {
                        // Add fade out animation
                        document.body.style.opacity = '0';
                        document.body.style.transition = 'opacity 0.3s ease';

                        // Call logout API to clear server session
                        fetch('/api/logout', {
                            method: 'POST',
                            credentials: 'include'
                        }).then(response => response.json())
                        .then(data => {
                            console.log('🔓 Server session cleared');
                            
                            // Clear session data but preserve user config for next login
                            // Don't clear vietnam_travel_ui_config cookie as it contains user preferences
                            sessionStorage.clear();
                            
                            setTimeout(() => {
                                window.location.href = 'index.html';
                            }, 300);
                        }).catch(error => {
                            console.error('Error during logout:', error);
                            // Still redirect even if logout API fails
                            sessionStorage.clear();
                            setTimeout(() => {
                                window.location.href = 'index.html';
                            }, 300);
                        });
                    }
                });

                // Admin Panel Button Click Handler
                const adminPanelBtn = document.getElementById('adminPanelBtn');
                if (adminPanelBtn) {
                    adminPanelBtn.addEventListener('click', function() {
                        // Sử dụng đường dẫn tuyệt đối thay vì tương đối
                        window.location.href = '/admin';
                    });
                }

                // Enhanced search history interactions
                document.querySelectorAll('.history-item button').forEach(button => {
                    button.addEventListener('click', function (e) {
                        e.preventDefault();

                        if (this.textContent.includes('Search Again') || this.textContent.includes('Tìm Lại')) {
                            const message = currentLanguage === 'vi' ?
                                'Đang tải lại tìm kiếm...' :
                                'Loading search again...';

                            // Add loading state
                            const originalText = this.innerHTML;
                            this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Loading...';
                            this.disabled = true;

                            setTimeout(() => {
                                this.innerHTML = originalText;
                                this.disabled = false;
                                alert(message);
                            }, 1500);
                        }
                    });
                });

                // Enhanced minimize functionality for search results
                document.addEventListener('click', function(e) {
                    if (e.target.closest('#minimizeHotelResults')) {
                        const resultsContainer = document.getElementById('hotelResults');
                        const hotelList = document.getElementById('hotelList');
                        const minimizeBtn = document.getElementById('minimizeHotelResults');
                        const icon = minimizeBtn.querySelector('i');
                        
                        if (hotelList.style.display === 'none') {
                            // Expand
                            hotelList.style.display = 'grid';
                            resultsContainer.classList.remove('minimized');
                            icon.className = 'fas fa-minus text-gray-600';
                            minimizeBtn.title = 'Minimize results';
                        } else {
                            // Minimize
                            hotelList.style.display = 'none';
                            resultsContainer.classList.add('minimized');
                            icon.className = 'fas fa-plus text-gray-600';
                            minimizeBtn.title = 'Expand results';
                        }
                    }
                    
                    if (e.target.closest('#minimizeRestaurantResults')) {
                        const resultsContainer = document.getElementById('restaurantResults');
                        const restaurantList = document.getElementById('restaurantList');
                        const minimizeBtn = document.getElementById('minimizeRestaurantResults');
                        const icon = minimizeBtn.querySelector('i');
                        
                        if (restaurantList.style.display === 'none') {
                            // Expand
                            restaurantList.style.display = 'grid';
                            resultsContainer.classList.remove('minimized');
                            icon.className = 'fas fa-minus text-gray-600';
                            minimizeBtn.title = 'Minimize results';
                        } else {
                            // Minimize
                            restaurantList.style.display = 'none';
                            resultsContainer.classList.add('minimized');
                            icon.className = 'fas fa-plus text-gray-600';
                            minimizeBtn.title = 'Expand results';
                        }
                    }
                });

                // Enhanced Currency/Language/Theme handlers with UI Config integration
                document.querySelectorAll('.currency-option').forEach(button => {
                    button.addEventListener('click', function() {
                        const currency = this.getAttribute('data-currency');
                        if (currency) {
                            // Get the current complete config first
                            const currentConfig = getUserConfig();
                            
                            // Update only the currency property, keeping other properties intact
                            if (window.uiConfig) {
                                window.uiConfig.updateConfig('currency', currency);
                            } else {
                                // Fallback if uiConfig not available - update cookie directly
                                currentConfig.currency = currency;
                                
                                // Save updated config to cookie
                                const expiryDate = new Date();
                                expiryDate.setFullYear(expiryDate.getFullYear() + 1);
                                document.cookie = `vietnam_travel_ui_config=${encodeURIComponent(JSON.stringify(currentConfig))}; expires=${expiryDate.toUTCString()}; path=/; SameSite=Strict`;
                                
                                console.log('✅ Updated currency while preserving other settings');
                            }
                        }
                        hideDropdown();
                    });
                });

                // Add Restaurant Modal Functionality
                initializeAddRestaurantModal();
                
                // Updated language option click handlers to preserve all cookie properties
                document.querySelectorAll('.language-option').forEach(button => {
                    button.addEventListener('click', function() {
                        const language = this.getAttribute('data-lang');
                        if (language) {
                            // Get the current complete config first
                            const currentConfig = getUserConfig();
                            
                            // Update only the language property, keeping other properties intact
                            if (window.uiConfig) {
                                window.uiConfig.updateConfig('language', language);
                            } else {
                                // Fallback if uiConfig not available - update cookie directly
                                currentConfig.language = language;
                                
                                // Save updated config to cookie
                                const expiryDate = new Date();
                                expiryDate.setFullYear(expiryDate.getFullYear() + 1);
                                document.cookie = `vietnam_travel_ui_config=${encodeURIComponent(JSON.stringify(currentConfig))}; expires=${expiryDate.toUTCString()}; path=/; SameSite=Strict`;
                                
                                console.log('✅ Updated language while preserving other settings');
                            }
                        }
                        hideDropdown();
                    });
                });
                
                // Theme buttons click handlers
                document.querySelectorAll('.theme-option').forEach(button => {
                    button.addEventListener('click', function() {
                        const theme = this.getAttribute('data-theme');
                        if (theme && window.uiConfig) {
                            // Update theme using UI Config
                            window.uiConfig.updateConfig('theme', theme);
                            
                            // Apply theme immediately without reloading
                            document.documentElement.setAttribute('data-theme', theme);
                            document.body.className = document.body.className.replace(/theme-\w+/g, '');
                            document.body.classList.add(`theme-${theme}`);
                            
                            // Update user config storage
                            try {
                                // Update cookie storage
                                const cookies = document.cookie.split(';');
                                const configCookie = cookies.find(cookie => 
                                    cookie.trim().startsWith('vietnam_travel_ui_config=')
                                );
                                
                                if (configCookie) {
                                    const configValue = decodeURIComponent(configCookie.split('=')[1]);
                                    const config = JSON.parse(configValue);
                                    config.theme = theme;
                                    
                                    // Set updated cookie
                                    const expiryDate = new Date();
                                    expiryDate.setFullYear(expiryDate.getFullYear() + 1);
                                    document.cookie = `vietnam_travel_ui_config=${encodeURIComponent(JSON.stringify(config))}; expires=${expiryDate.toUTCString()}; path=/; SameSite=Strict`;
                                    
                                    console.log(`✅ Updated theme in cookie storage: ${theme}`);
                                }
                                
                                // No localStorage update needed - server manages state
                            } catch (error) {
                                console.log('⚠️ Error updating theme in storage:', error);
                            }
                        }
                        hideDropdown();
                    });
                });
                
                // Custom Interface button
                const customizeBtn = document.getElementById('customizeInterface');
                if (customizeBtn && window.uiConfig) {
                    customizeBtn.addEventListener('click', function() {
                        // Show interface settings modal
                        window.uiConfig.showInterfaceSettings();
                        hideDropdown();
                    });
                }
                
                function hideDropdown() {
                    const dropdown = document.getElementById('currencyLanguageDropdown');
                    if (dropdown) dropdown.classList.add('hidden');
                }
            });
            
            // Function to check admin status
            function checkAdminStatus() {
                // ALWAYS require proper admin check - NO LOCAL MODE BYPASS
                console.log('🔐 Checking admin privileges...');
                
                // Try to load user data from session storage first
                loadUserDataFromSession();
                
                try {
                    fetch('/api/check-admin', {
                        credentials: 'include' // Include session cookies
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`API call failed: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log('🔍 Admin check response:', data);
                            
                            const adminPanelBtn = document.getElementById('adminPanelBtn');
                            const addRestaurantBtn = document.getElementById('addRestaurantBtn');
                            const addHotelBtn = document.getElementById('addHotelBtn');
                            
                            if (data.is_admin === true) {
                                // Show admin panel button ONLY for real admins
                                if (adminPanelBtn) {
                                    adminPanelBtn.classList.remove('hidden');
                                    adminPanelBtn.style.display = 'flex';
                                }
                                // Show add restaurant button for admins
                                if (addRestaurantBtn) {
                                    addRestaurantBtn.classList.remove('hidden');
                                    addRestaurantBtn.style.display = 'flex';
                                }
                                // Show add hotel button for admins
                                if (addHotelBtn) {
                                    addHotelBtn.classList.remove('hidden');
                                    addHotelBtn.style.display = 'flex';
                                }
                                console.log('✅ Admin access granted - is_admin = true');
                            } else {
                                console.log('👤 Regular user - no admin access (is_admin = false or undefined)');
                                // Ensure admin buttons stay hidden
                                if (adminPanelBtn) {
                                    adminPanelBtn.classList.add('hidden');
                                    adminPanelBtn.style.display = 'none';
                                }
                                if (addRestaurantBtn) {
                                    addRestaurantBtn.classList.add('hidden');
                                    addRestaurantBtn.style.display = 'none';
                                }
                                if (addHotelBtn) {
                                    addHotelBtn.classList.add('hidden');
                                    addHotelBtn.style.display = 'none';
                                }
                            }
                            
                            // Update user display information and save to session
                            if (data.user_name && data.email) {
                                updateUserDisplay(data.user_name, data.email);
                                // Save to session storage for future use
                                sessionStorage.setItem('user_session_data', JSON.stringify({
                                    name: data.user_name,
                                    email: data.email,
                                    is_admin: data.is_admin
                                }));
                            }
                        })
                        .catch(error => {
                            console.log('❌ Error checking admin status:', error);
                            console.log('🚫 Admin panel will remain hidden due to error');
                            
                            // NO FALLBACK - Keep admin buttons hidden on error
                            const adminPanelBtn = document.getElementById('adminPanelBtn');
                            const addRestaurantBtn = document.getElementById('addRestaurantBtn');
                            const addHotelBtn = document.getElementById('addHotelBtn');
                            if (adminPanelBtn) {
                                adminPanelBtn.classList.add('hidden');
                                adminPanelBtn.style.display = 'none';
                            }
                            if (addRestaurantBtn) {
                                addRestaurantBtn.classList.add('hidden');
                                addRestaurantBtn.style.display = 'none';
                            }
                            if (addHotelBtn) {
                                addHotelBtn.classList.add('hidden');
                                addHotelBtn.style.display = 'none';
                            }
                        });
                } catch (e) {
                    console.log('❌ General error in admin check:', e);
                    console.log('🚫 Admin panel will remain hidden due to exception');
                    
                    // NO FALLBACK - Keep admin buttons hidden on exception
                    const adminPanelBtn = document.getElementById('adminPanelBtn');
                    const addRestaurantBtn = document.getElementById('addRestaurantBtn');
                    const addHotelBtn = document.getElementById('addHotelBtn');
                    if (adminPanelBtn) {
                        adminPanelBtn.classList.add('hidden');
                        adminPanelBtn.style.display = 'none';
                    }
                    if (addRestaurantBtn) {
                        addRestaurantBtn.classList.add('hidden');
                        addRestaurantBtn.style.display = 'none';
                    }
                    if (addHotelBtn) {
                        addHotelBtn.classList.add('hidden');
                        addHotelBtn.style.display = 'none';
                    }
                }
            }
            
            // Function to load user data from session storage
            function loadUserDataFromSession() {
                try {
                    const sessionData = sessionStorage.getItem('user_session_data');
                    if (sessionData) {
                        const userData = JSON.parse(sessionData);
                        console.log('📱 Loading user data from session:', userData);
                        if (userData.name && userData.email) {
                            updateUserDisplay(userData.name, userData.email);
                        }
                    }
                } catch (error) {
                    console.log('⚠️ Error loading session data:', error);
                }
            }
            
            // Function to update user display information from real data
            function updateUserDisplay(userName, userEmail) {
                console.log('������ Updating user display with:', {userName, userEmail});
                if (!userName || !userEmail) {
                    console.log('⚠️ Missing userName or userEmail, skipping update');
                    return;
                }
                
                // Update user name display
                const userNameElement = document.getElementById('currentUserName');
                if (userNameElement) {
                    userNameElement.textContent = userName;
                    userNameElement.setAttribute('data-en', userName);
                    userNameElement.setAttribute('data-vi', userName);
                    console.log('✅ Updated user name element');
                }
                
                // Update user email display
                const userEmailElement = document.getElementById('currentUserEmail');
                if (userEmailElement) {
                    userEmailElement.textContent = userEmail;
                    console.log('✅ Updated user email element');
                }
                
                // Update welcome message
                const welcomeElement = document.getElementById('welcomeMessage');
                if (welcomeElement) {
                    const currentLang = window.currentLanguage || 'en';
                    if (currentLang === 'vi') {
                        welcomeElement.textContent = `Chào mừng trở lại, ${userName}!`;
                    } else {
                        welcomeElement.textContent = `Welcome back, ${userName}!`;
                    }
                    welcomeElement.setAttribute('data-en', `Welcome back, ${userName}!`);
                    welcomeElement.setAttribute('data-vi', `Chào mừng trở lại, ${userName}!`);
                    console.log('✅ Updated welcome message');
                }
                
                // Update avatar initial
                const avatarElement = document.querySelector('.w-8.h-8.bg-gradient-to-r.from-blue-500.to-purple-600.rounded-full');
                if (avatarElement && userName) {
                    avatarElement.textContent = userName.charAt(0).toUpperCase();
                    console.log('✅ Updated avatar initial');
                }
            }

            // Website Setup Dropdown Functionality - Initialize after slight delay
            setTimeout(() => {
                console.log('🔧 Initializing Website Setup Dropdown...');
                const websiteSetupBtn = document.getElementById('websiteSetupBtn');
                const websiteSetupDropdown = document.getElementById('websiteSetupDropdown');
                
                console.log('������ Website Setup Button:', websiteSetupBtn);
                console.log('🎯 Website Setup Dropdown:', websiteSetupDropdown);
                
                if (websiteSetupBtn && websiteSetupDropdown) {
                    console.log('✅ Both setup elements found, attaching events...');
                    
                    // Store current selections for comparison
                    // First get the complete config from cookie to ensure all properties are preserved
                    const completeConfig = getUserConfig();
                    let currentSelections = {
                        language: window.currentLanguage || completeConfig.language || 'en',
                        currency: window.currentCurrency || completeConfig.currency || 'USD',
                        theme: completeConfig.theme || getCurrentTheme()
                    };
                    
                    // Initial setup of indicators based on cookie values
                    // Read from cookie directly for maximum reliability
                    try {
                        const cookies = document.cookie.split(';');
                        const configCookie = cookies.find(cookie => 
                            cookie.trim().startsWith('vietnam_travel_ui_config=')
                        );
                        
                        if (configCookie) {
                            const configValue = decodeURIComponent(configCookie.split('=')[1]);
                            const config = JSON.parse(configValue);
                            console.log(`🍪 Reading initial selections from cookie:`, config);
                            
                            // Override with cookie values
                            if (config.language) currentSelections.language = config.language;
                            if (config.currency) currentSelections.currency = config.currency;
                            if (config.theme) currentSelections.theme = config.theme;
                        }
                    } catch (error) {
                        console.log('⚠️ Error reading initial selections from cookie:', error);
                    }
                    
                    // Update indicator displays on dropdown open
                    function updateIndicators() {
                        console.log('🔄 Updating indicators with current selections:', currentSelections);
                        
                        // Update language indicators
                        document.querySelectorAll('.language-option span:last-child').forEach(span => span.classList.add('hidden'));
                        const currentLangBtn = document.querySelector(`.language-option[data-lang="${currentSelections.language}"] span:last-child`);
                        if (currentLangBtn) currentLangBtn.classList.remove('hidden');
                        
                        // Update currency indicators
                        document.querySelectorAll('.currency-option span:last-child').forEach(span => span.classList.add('hidden'));
                        const currentCurrBtn = document.querySelector(`.currency-option[data-currency="${currentSelections.currency}"] span:last-child`);
                        if (currentCurrBtn) currentCurrBtn.classList.remove('hidden');
                        
                        // Update theme indicators
                        document.querySelectorAll('.theme-option span:last-child').forEach(span => span.classList.add('hidden'));
                        const currentThemeBtn = document.querySelector(`.theme-option[data-theme="${currentSelections.theme}"] span:last-child`);
                        if (currentThemeBtn) currentThemeBtn.classList.remove('hidden');
                    }
                    
                    // Toggle dropdown
                    websiteSetupBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('🖱️ Setup button clicked');
                        websiteSetupDropdown.classList.toggle('hidden');
                        if (!websiteSetupDropdown.classList.contains('hidden')) {
                            updateIndicators();
                        }
                    });
                    
                    // Close dropdown when clicking outside
                    document.addEventListener('click', function(e) {
                        if (!websiteSetupBtn.contains(e.target) && !websiteSetupDropdown.contains(e.target)) {
                            websiteSetupDropdown.classList.add('hidden');
                        }
                    });
                    
                    // Language option handlers - update selection without immediate apply
                    document.querySelectorAll('.language-option').forEach(button => {
                        button.addEventListener('click', function(e) {
                            e.preventDefault();
                            const lang = this.getAttribute('data-lang');
                            console.log('🌐 Language selected:', lang);
                            currentSelections.language = lang;
                            updateIndicators();
                        });
                    });
                    
                    // Currency option handlers - update selection without immediate apply
                    document.querySelectorAll('.currency-option').forEach(button => {
                        button.addEventListener('click', function(e) {
                            e.preventDefault();
                            const currency = this.getAttribute('data-currency');
                            console.log('💰 Currency selected:', currency);
                            currentSelections.currency = currency;
                            updateIndicators();
                        });
                    });
                    
                    // Theme option handlers - update selection without immediate apply
                    document.querySelectorAll('.theme-option').forEach(button => {
                        button.addEventListener('click', function(e) {
                            e.preventDefault();
                            const theme = this.getAttribute('data-theme');
                            console.log('🎨 Theme selected:', theme);
                            currentSelections.theme = theme;
                            updateIndicators();
                        });
                    });
                    
                    // Apply Changes Button
                    const applyChangesBtn = document.getElementById('applyChangesBtn');
                    if (applyChangesBtn) {
                        applyChangesBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            console.log('✅ Applying changes:', currentSelections);
                            
                            // Get the complete current config to preserve all settings
                            const currentConfig = getUserConfig();
                            
                            let needsRefresh = false;
                            let changesApplied = [];
                            
                            // Apply language changes (immediate) - PRESERVE ALL COOKIE PROPERTIES
                            console.log('🔍 DEBUG: Checking language change -', 'currentSelections.language:', currentSelections.language, 'window.currentLanguage:', window.currentLanguage || 'en');
                            
                            // ALWAYS save to cookie to ensure sync, regardless of current language
                            console.log('🍪 FORCE SAVING LANGUAGE TO COOKIE TO SYNC...');
                            saveUserPreference('language', currentSelections.language);
                            
                            if (currentSelections.language !== (window.currentLanguage || 'en')) {
                                console.log('🌐 Applying language change:', currentSelections.language);
                                window.currentLanguage = currentSelections.language;
                                
                                // Then use unified preferences system
                                if (typeof updateLanguage === 'function') {
                                    console.log('🔄 Calling updateLanguage function');
                                    updateLanguage(currentSelections.language);
                                }
                                if (typeof updateLanguageDisplay === 'function') {
                                    console.log('🔄 Calling updateLanguageDisplay function');
                                    updateLanguageDisplay();
                                }
                                
                                changesApplied.push('Language');
                            } else {
                                console.log('🔄 Language same as current but cookie synced:', currentSelections.language);
                                // Still call updateLanguage to ensure UI consistency  
                                if (typeof updateLanguage === 'function') {
                                    console.log('🔄 Calling updateLanguage for UI sync');
                                    updateLanguage(currentSelections.language);
                                }
                                if (typeof updateLanguageDisplay === 'function') {
                                    console.log('🔄 Calling updateLanguageDisplay for UI sync');
                                    updateLanguageDisplay();
                                }
                                changesApplied.push('Language (synced)');
                            }
                            
                            // Apply currency changes (immediate)
                            if (currentSelections.currency !== (window.currentCurrency || 'USD')) {
                                console.log('💰 Applying currency change:', currentSelections.currency);
                                window.currentCurrency = currentSelections.currency;
                                // Use unified preferences system
                                if (typeof updateCurrency === 'function') {
                                    updateCurrency(currentSelections.currency);
                                }
                                if (typeof updateCurrencyDisplay === 'function') {
                                    updateCurrencyDisplay();
                                }
                                saveUserPreference('currency', currentSelections.currency);
                                changesApplied.push('Currency');
                            }
                            
                            // Apply theme changes (requires refresh)
                            const currentTheme = getCurrentTheme();
                            if (currentSelections.theme !== currentTheme) {
                                console.log('🎨 Applying theme change:', currentSelections.theme);
                                // Save theme preference
                                saveUserPreference('theme', currentSelections.theme);
                                needsRefresh = true;
                                changesApplied.push('Theme');
                            }
                            
                            // Show confirmation and refresh if needed
                            if (changesApplied.length > 0) {
                                const currentLang = window.currentLanguage || 'en';
                                const messages = {
                                    en: {
                                        success: `${changesApplied.join(', ')} updated successfully!`,
                                        refreshing: 'Refreshing page to apply theme changes...'
                                    },
                                    vi: {
                                        success: `Đã cập nhật ${changesApplied.join(', ')} thành công!`,
                                        refreshing: 'Đang tải lại trang để áp dụng thay đổi theme...'
                                    }
                                };
                                
                                alert(messages[currentLang].success);
                                
                                if (needsRefresh) {
                                    alert(messages[currentLang].refreshing);
                                    setTimeout(() => {
                                        window.location.reload();
                                    }, 1000);
                                }
                            }
                            
                            websiteSetupDropdown.classList.add('hidden');
                        });
                    }
                    
                    // Cancel Changes Button
                    const cancelChangesBtn = document.getElementById('cancelChangesBtn');
                    if (cancelChangesBtn) {
                        cancelChangesBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            console.log('❌ Cancelling changes');
                            // Reset selections to current values
                            // Get complete config from cookie to ensure all properties are preserved
                            const completeConfig = getUserConfig();
                            currentSelections = {
                                language: window.currentLanguage || completeConfig.language || 'en',
                                currency: window.currentCurrency || completeConfig.currency || 'USD',
                                theme: completeConfig.theme || getCurrentTheme()
                            };
                            updateIndicators();
                            websiteSetupDropdown.classList.add('hidden');
                        });
                    }
                    
                } else {
                    console.log('❌ Could not find setup dropdown elements');
                    console.log('🔍 Available elements with setup in ID:', document.querySelectorAll('[id*="setup"]'));
                }
            }, 500); // Wait 500ms for DOM to be fully ready
            
            // Helper function to get current theme
            function getCurrentTheme() {
                const theme = document.documentElement.getAttribute('data-theme');
                console.log('🔍 Current theme detected:', theme);
                return theme || 'sunset';
            }
            
            // Helper function to save user preferences - UNIFIED with main script.js system
            function saveUserPreference(key, value) {
                try {
                    // Use vietnam_travel_ui_config for all pages
                    let currentConfig = {};
                    try {
                        const cookies = document.cookie.split(';');
                        const configCookie = cookies.find(cookie => 
                            cookie.trim().startsWith('vietnam_travel_ui_config=')
                        );
                        if (configCookie) {
                            const configValue = decodeURIComponent(configCookie.split('=')[1]);
                            currentConfig = JSON.parse(configValue);
                        }
                    } catch (e) {
                        console.log('🍪 Creating new unified preferences config for:', key);
                        // Default preferences to match script.js - include theme and keep all standard properties
                        currentConfig = { language: 'en', currency: 'USD', theme: 'sunset', setupCompleted: true };
                    }
                    
                    // Update preference in unified config
                    currentConfig[key] = value;
                    
                    // Save to unified preferences cookie (same as script.js)
                    const cookieValue = JSON.stringify(currentConfig);
                    const expiryDate = new Date();
                    expiryDate.setFullYear(expiryDate.getFullYear() + 1);
                    document.cookie = `vietnam_travel_ui_config=${encodeURIComponent(cookieValue)}; expires=${expiryDate.toUTCString()}; path=/; SameSite=Strict`;
                    
                    console.log(`🍪 UNIFIED: ${key.charAt(0).toUpperCase() + key.slice(1)} preference saved to vietnam_travel_ui_config: ${value}`);
                    console.log(`🍪 Full unified preferences:`, currentConfig);
                    
                    // Show confirmation
                    const messages = {
                        theme: { en: 'Theme saved successfully!', vi: 'Đã lưu giao diện thành công!' },
                        language: { en: 'Language saved successfully!', vi: 'Đã lưu ngôn ngữ thành công!' },
                        currency: { en: 'Currency saved successfully!', vi: 'Đã lưu tiền tệ thành công!' }
                    };
                    
                    const currentLang = window.currentLanguage || 'en';
                    const message = messages[key] ? messages[key][currentLang] : `${key} saved successfully!`;
                    
                    if (typeof showNotification === 'function') {
                        showNotification(message, 'success');
                    } else {
                        console.log(`✅ ${message}`);
                    }
                    
                } catch (error) {
                    console.error(`❌ Error saving ${key} preference:`, error);
                }
            }

            // Add Restaurant Modal Functions
            function initializeAddRestaurantModal() {
                const addRestaurantBtn = document.getElementById('addRestaurantBtn');
                const modal = document.getElementById('addRestaurantModal');
                const closeModalBtn = document.getElementById('closeAddRestaurantModal');
                const manualAddOption = document.getElementById('manualAddOption');
                const excelUploadOption = document.getElementById('excelUploadOption');
                const addRestaurantChoice = document.getElementById('addRestaurantChoice');
                const manualFormContainer = document.getElementById('manualFormContainer');
                const excelUploadContainer = document.getElementById('excelUploadContainer');
                const backToChoice = document.getElementById('backToChoice');
                const backToChoiceFromExcel = document.getElementById('backToChoiceFromExcel');
                const addRestaurantForm = document.getElementById('addRestaurantForm');
                const excelDropZone = document.getElementById('excelDropZone');
                const excelFileInput = document.getElementById('excelFileInput');
                const uploadExcelBtn = document.getElementById('uploadExcelBtn');

                // Open modal
                if (addRestaurantBtn) {
                    addRestaurantBtn.addEventListener('click', function() {
                        modal.classList.remove('hidden');
                        resetModal();
                    });
                }

                // Close modal
                if (closeModalBtn) {
                    closeModalBtn.addEventListener('click', function() {
                        modal.classList.add('hidden');
                        resetModal();
                    });
                }

                // Close modal when clicking outside
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                        resetModal();
                    }
                });

                // Manual add option
                if (manualAddOption) {
                    manualAddOption.addEventListener('click', function() {
                        addRestaurantChoice.classList.add('hidden');
                        manualFormContainer.classList.remove('hidden');
                    });
                }

                // Excel upload option
                if (excelUploadOption) {
                    excelUploadOption.addEventListener('click', function() {
                        addRestaurantChoice.classList.add('hidden');
                        excelUploadContainer.classList.remove('hidden');
                    });
                }

                // Back to choice buttons
                if (backToChoice) {
                    backToChoice.addEventListener('click', function() {
                        manualFormContainer.classList.add('hidden');
                        addRestaurantChoice.classList.remove('hidden');
                    });
                }

                if (backToChoiceFromExcel) {
                    backToChoiceFromExcel.addEventListener('click', function() {
                        excelUploadContainer.classList.add('hidden');
                        addRestaurantChoice.classList.remove('hidden');
                        resetExcelUpload();
                    });
                }

                // Manual form submission
                if (addRestaurantForm) {
                    addRestaurantForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        handleManualAddRestaurant(this);
                    });
                }

                // Excel drag & drop
                if (excelDropZone && excelFileInput) {
                    excelDropZone.addEventListener('click', function() {
                        excelFileInput.click();
                    });

                    excelDropZone.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        this.classList.add('border-blue-400', 'bg-blue-50');
                    });

                    excelDropZone.addEventListener('dragleave', function(e) {
                        e.preventDefault();
                        this.classList.remove('border-blue-400', 'bg-blue-50');
                    });

                    excelDropZone.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.classList.remove('border-blue-400', 'bg-blue-50');
                        const files = e.dataTransfer.files;
                        if (files.length > 0) {
                            handleExcelFileSelect(files[0]);
                        }
                    });

                    excelFileInput.addEventListener('change', function(e) {
                        if (e.target.files.length > 0) {
                            handleExcelFileSelect(e.target.files[0]);
                        }
                    });
                }

                // Excel upload button
                if (uploadExcelBtn) {
                    uploadExcelBtn.addEventListener('click', function() {
                        handleExcelUpload();
                    });
                }

                function resetModal() {
                    addRestaurantChoice.classList.remove('hidden');
                    manualFormContainer.classList.add('hidden');
                    excelUploadContainer.classList.add('hidden');
                    if (addRestaurantForm) addRestaurantForm.reset();
                    resetExcelUpload();
                }

                function resetExcelUpload() {
                    if (excelFileInput) excelFileInput.value = '';
                    if (uploadExcelBtn) {
                        uploadExcelBtn.disabled = true;
                        uploadExcelBtn.innerHTML = '<i class="fas fa-upload mr-2"></i><span data-en="Upload Excel" data-vi="Upload Excel">Upload Excel</span>';
                    }
                    const uploadProgress = document.getElementById('uploadProgress');
                    if (uploadProgress) uploadProgress.classList.add('hidden');
                }

                function handleExcelFileSelect(file) {
                    const allowedTypes = [
                        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                        'application/vnd.ms-excel'
                    ];

                    if (!allowedTypes.includes(file.type)) {
                        alert(window.currentLanguage === 'vi' ? 
                            'Vui lòng chọn file Excel (.xlsx hoặc .xls)' : 
                            'Please select an Excel file (.xlsx or .xls)');
                        return;
                    }

                    if (uploadExcelBtn) {
                        uploadExcelBtn.disabled = false;
                        uploadExcelBtn.innerHTML = `<i class="fas fa-upload mr-2"></i><span data-en="Upload ${file.name}" data-vi="Upload ${file.name}">Upload ${file.name}</span>`;
                    }
                }

                async function handleManualAddRestaurant(form) {
                    const formData = new FormData(form);
                    const restaurantData = {};
                    
                    for (let [key, value] of formData.entries()) {
                        restaurantData[key] = value || null;
                    }

                    try {
                        const response = await fetch('/api/admin/restaurants/add', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            credentials: 'include',
                            body: JSON.stringify(restaurantData)
                        });

                        const result = await response.json();

                        if (response.ok) {
                            alert(window.currentLanguage === 'vi' ? 
                                'Thêm nhà hàng thành công!' : 
                                'Restaurant added successfully!');
                            modal.classList.add('hidden');
                            resetModal();
                        } else {
                            alert(result.message || (window.currentLanguage === 'vi' ? 
                                'Có lỗi xảy ra khi thêm nhà hàng' : 
                                'Error adding restaurant'));
                        }
                    } catch (error) {
                        console.error('Error adding restaurant:', error);
                        alert(window.currentLanguage === 'vi' ? 
                            'Có lỗi xảy ra khi thêm nhà hàng' : 
                            'Error adding restaurant');
                    }
                }

                async function handleExcelUpload() {
                    const fileInput = document.getElementById('excelFileInput');
                    const file = fileInput.files[0];

                    if (!file) {
                        alert(window.currentLanguage === 'vi' ? 
                            'Vui lòng chọn file Excel' : 
                            'Please select an Excel file');
                        return;
                    }

                    const formData = new FormData();
                    formData.append('excel_file', file);

                    const uploadProgress = document.getElementById('uploadProgress');
                    const uploadProgressBar = document.getElementById('uploadProgressBar');
                    const uploadProgressText = document.getElementById('uploadProgressText');

                    try {
                        uploadProgress.classList.remove('hidden');
                        uploadProgressBar.style.width = '0%';
                        uploadProgressText.textContent = window.currentLanguage === 'vi' ? 'Đang upload...' : 'Uploading...';

                        const response = await fetch('/api/admin/restaurants/upload-excel', {
                            method: 'POST',
                            credentials: 'include',
                            body: formData
                        });

                        uploadProgressBar.style.width = '100%';

                        const result = await response.json();

                        if (response.ok) {
                            uploadProgressText.textContent = window.currentLanguage === 'vi' ? 
                                `Thành công! Đã thêm ${result.added_count || 0} nhà hàng` : 
                                `Success! Added ${result.added_count || 0} restaurants`;
                            
                            setTimeout(() => {
                                modal.classList.add('hidden');
                                resetModal();
                            }, 2000);
                        } else {
                            uploadProgressText.textContent = result.message || (window.currentLanguage === 'vi' ? 
                                'Có lỗi xảy ra' : 'Error occurred');
                        }
                    } catch (error) {
                        console.error('Error uploading Excel:', error);
                        uploadProgressText.textContent = window.currentLanguage === 'vi' ? 
                            'Có lỗi xảy ra khi upload' : 
                            'Error uploading file';
                    }
                }
            }
        </script>
        
        <!-- Date and Time Pickers and Ghost Text -->
        <script src="assets/js/pickers/datepicker.js"></script>
        <script src="assets/js/pickers/ghost-text.js"></script>
        <script src="assets/js/tour-form.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Initialize date and time pickers
                initializeDateTimePickers();
                
                // Initialize ghost text functionality
                initializeAllGhostText();
            });
        </script>
    </body>

    </html>